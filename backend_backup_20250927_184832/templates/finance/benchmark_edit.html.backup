{% extends 'common/base.html' %}
{% load static %}

{% block title %}–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–µ–Ω—á–º–∞—Ä–∫–∞{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/finance.css' %}">
<style>
.edit-form-container {
    background: var(--color-surface);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-lg);
    padding: var(--space-24);
    margin-bottom: var(--space-16);
}

.form-section {
    background: var(--color-background);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-base);
    padding: var(--space-20);
    margin-bottom: var(--space-16);
}

.section-title {
    font-size: 1.125rem;
    font-weight: 600;
    margin-bottom: var(--space-16);
    color: var(--color-text);
    display: flex;
    align-items: center;
    gap: var(--space-8);
}

.benchmark-preview {
    background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-secondary) 100%);
    color: white;
    border-radius: var(--radius-lg);
    padding: var(--space-20);
    margin-bottom: var(--space-20);
    text-align: center;
}

.benchmark-preview .preview-amount {
    font-size: 2.5rem;
    font-weight: 700;
    margin-bottom: var(--space-8);
}

.benchmark-preview .preview-details {
    opacity: 0.9;
    font-size: 1.125rem;
}

[data-theme="dark"] .edit-form-container {
    background: rgba(255, 255, 255, 0.05);
    border-color: rgba(255, 255, 255, 0.1);
}

[data-theme="dark"] .form-section {
    background: rgba(255, 255, 255, 0.03);
    border-color: rgba(255, 255, 255, 0.1);
}
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <!-- –•–ª–µ–±–Ω—ã–µ –∫—Ä–æ—à–∫–∏ -->
            <nav aria-label="breadcrumb" class="mb-4">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="{% url 'finance:dashboard' %}">–§–∏–Ω–∞–Ω—Å—ã</a></li>
                    <li class="breadcrumb-item"><a href="{% url 'finance:benchmarks_dashboard' %}">–ë–µ–Ω—á–º–∞—Ä–∫–∏</a></li>
                    <li class="breadcrumb-item"><a href="{% url 'finance:benchmarks_list' %}">–°–ø–∏—Å–æ–∫</a></li>
                    <li class="breadcrumb-item"><a href="{% url 'finance:benchmark_detail' benchmark.pk %}">{{ benchmark.vacancy.name }}</a></li>
                    <li class="breadcrumb-item active" aria-current="page">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</li>
                </ol>
            </nav>

            <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
            <div class="d-flex justify-content-between align-items-center mb-4">
                <div>
                    <h1 class="h3 mb-1">
                        <i class="fas fa-edit me-2"></i>
                        –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–µ–Ω—á–º–∞—Ä–∫–∞
                    </h1>
                    <p class="text-muted mb-0">{{ benchmark.vacancy.name }} - {{ benchmark.grade.name }}</p>
                </div>
                <div class="btn-group">
                    <a href="{% url 'finance:benchmark_detail' benchmark.pk %}" class="btn btn-outline-secondary">
                        <i class="fas fa-eye me-2"></i>–ü—Ä–æ—Å–º–æ—Ç—Ä
                    </a>
                    <a href="{% url 'finance:benchmarks_list' %}" class="btn btn-secondary">
                        <i class="fas fa-arrow-left me-2"></i>–ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É
                    </a>
                </div>
            </div>

            <!-- –ü—Ä–µ–≤—å—é –±–µ–Ω—á–º–∞—Ä–∫–∞ -->
            <div class="benchmark-preview">
                <div class="preview-amount" id="previewAmount">{{ benchmark.get_salary_display }}</div>
                <div class="preview-details">
                    <span id="previewType">{{ benchmark.get_type_display }}</span> ‚Ä¢ 
                    <span id="previewVacancy">{{ benchmark.vacancy.name }}</span> ‚Ä¢ 
                    <span id="previewGrade">{{ benchmark.grade.name }}</span>
                </div>
                <div class="preview-details mt-2">
                    <i class="fas fa-map-marker-alt me-1"></i><span id="previewLocation">{{ benchmark.location }}</span>
                </div>
            </div>

            <!-- –§–æ—Ä–º–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è -->
            <div class="edit-form-container">
                <form method="post" id="editBenchmarkForm">
                    {% csrf_token %}
                    
                    <!-- –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
                    <div class="form-section">
                        <h5 class="section-title">
                            <i class="fas fa-info-circle"></i>
                            –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
                        </h5>
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label for="type" class="form-label">–¢–∏–ø –±–µ–Ω—á–º–∞—Ä–∫–∞ *</label>
                                <select class="form-select" id="type" name="type" required>
                                    {% for value, label in benchmark_types %}
                                        <option value="{{ value }}" {% if benchmark.type == value %}selected{% endif %}>{{ label }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="salary_from" class="form-label">–ó–∞—Ä–ø–ª–∞—Ç–∞ –æ—Ç (USD) *</label>
                                <input type="number" class="form-control" id="salary_from" name="salary_from" 
                                       step="0.01" min="0" required value="{{ benchmark.salary_from }}"
                                       placeholder="3000.00">
                            </div>
                            <div class="col-md-6">
                                <label for="salary_to" class="form-label">–ó–∞—Ä–ø–ª–∞—Ç–∞ –¥–æ (USD)</label>
                                <input type="number" class="form-control" id="salary_to" name="salary_to" 
                                       step="0.01" min="0" value="{% if benchmark.salary_to %}{{ benchmark.salary_to }}{% endif %}"
                                       placeholder="5000.00">
                                <div class="form-text">–û—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º –¥–ª—è –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤ –∏–ª–∏ –µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω–∞ —Ç–æ–ª—å–∫–æ –æ–¥–Ω–∞ —Å—É–º–º–∞</div>
                            </div>
                        </div>
                    </div>

                    <!-- –°–≤—è–∑–∞–Ω–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã -->
                    <div class="form-section">
                        <h5 class="section-title">
                            <i class="fas fa-link"></i>
                            –°–≤—è–∑–∞–Ω–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã
                        </h5>
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label for="vacancy_id" class="form-label">–í–∞–∫–∞–Ω—Å–∏—è *</label>
                                <select class="form-select" id="vacancy_id" name="vacancy_id" required>
                                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –≤–∞–∫–∞–Ω—Å–∏—é</option>
                                    {% for vacancy in vacancies %}
                                        <option value="{{ vacancy.id }}" {% if benchmark.vacancy.id == vacancy.id %}selected{% endif %}>{{ vacancy.name }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="grade_id" class="form-label">–ì—Ä–µ–π–¥ *</label>
                                <select class="form-select" id="grade_id" name="grade_id" required>
                                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –≥—Ä–µ–π–¥</option>
                                    {% for grade in grades %}
                                        <option value="{{ grade.id }}" {% if benchmark.grade.id == grade.id %}selected{% endif %}>{{ grade.name }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
                    <div class="form-section">
                        <h5 class="section-title">
                            <i class="fas fa-map-marker-alt"></i>
                            –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
                        </h5>
                        <div class="row g-3">
                            <div class="col-12">
                                <label for="location" class="form-label">–õ–æ–∫–∞—Ü–∏—è *</label>
                                <input type="text" class="form-control" id="location" name="location" 
                                       required value="{{ benchmark.location }}"
                                       placeholder="–ú–∏–Ω—Å–∫, –ë–µ–ª–∞—Ä—É—Å—å">
                            </div>
                            <div class="col-12">
                                <label for="notes" class="form-label">–ü—Ä–∏–º–µ—á–∞–Ω–∏—è</label>
                                <textarea class="form-control" id="notes" name="notes" rows="4" 
                                          placeholder="–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±–µ–Ω—á–º–∞—Ä–∫–µ...">{{ benchmark.notes }}</textarea>
                            </div>
                            <div class="col-12">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="is_active" name="is_active" 
                                           {% if benchmark.is_active %}checked{% endif %}>
                                    <label class="form-check-label" for="is_active">
                                        –ê–∫—Ç–∏–≤–µ–Ω
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è –≤–∞–∫–∞–Ω—Å–∏–∏ -->
                    <div class="form-section">
                        <h5 class="section-title">
                            <i class="fas fa-info-circle"></i>
                            –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è –≤–∞–∫–∞–Ω—Å–∏–∏
                        </h5>
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label for="work_format" class="form-label">–§–æ—Ä–º–∞—Ç —Ä–∞–±–æ—Ç—ã</label>
                                <select class="form-select" id="work_format" name="work_format">
                                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–æ—Ä–º–∞—Ç —Ä–∞–±–æ—Ç—ã</option>
                                    <option value="–æ—Ñ–∏—Å" {% if benchmark.work_format == '–æ—Ñ–∏—Å' %}selected{% endif %}>–û—Ñ–∏—Å</option>
                                    <option value="–≥–∏–±—Ä–∏–¥" {% if benchmark.work_format == '–≥–∏–±—Ä–∏–¥' %}selected{% endif %}>–ì–∏–±—Ä–∏–¥</option>
                                    <option value="—É–¥–∞–ª–µ–Ω–∫–∞" {% if benchmark.work_format == '—É–¥–∞–ª–µ–Ω–∫–∞' %}selected{% endif %}>–£–¥–∞–ª–µ–Ω–∫–∞</option>
                                    <option value="all world" {% if benchmark.work_format == 'all world' %}selected{% endif %}>All World</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="domain" class="form-label">–î–æ–º–µ–Ω</label>
                                <input type="text" class="form-control" id="domain" name="domain" 
                                       value="{{ benchmark.domain|default:'' }}"
                                       placeholder="IT, —Ñ–∏–Ω–∞–Ω—Å—ã, –º–µ–¥–∏—Ü–∏–Ω–∞...">
                            </div>
                            <div class="col-12">
                                <label for="technologies" class="form-label">–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏</label>
                                <textarea class="form-control" id="technologies" name="technologies" rows="3" 
                                          placeholder="Python, Django, React, PostgreSQL...">{{ benchmark.technologies|default:'' }}</textarea>
                            </div>
                            <div class="col-12">
                                <label for="compensation" class="form-label">–ö–æ–º–ø–µ–Ω—Å–∞—Ü–∏–∏</label>
                                <textarea class="form-control" id="compensation" name="compensation" rows="3" 
                                          placeholder="–ë–æ–Ω—É—Å—ã, –ø—Ä–µ–º–∏–∏, –∫–æ–º–∏—Å—Å–∏–∏...">{{ benchmark.compensation|default:'' }}</textarea>
                            </div>
                            <div class="col-12">
                                <label for="benefits" class="form-label">–ë–µ–Ω–µ—Ñ–∏—Ç—ã</label>
                                <textarea class="form-control" id="benefits" name="benefits" rows="3" 
                                          placeholder="–ú–µ–¥–∏—Ü–∏–Ω—Å–∫–∞—è —Å—Ç—Ä–∞—Ö–æ–≤–∫–∞, –æ—Ç–ø—É—Å–∫, –æ–±—É—á–µ–Ω–∏–µ...">{{ benchmark.benefits|default:'' }}</textarea>
                            </div>
                            <div class="col-12">
                                <label for="development" class="form-label">–†–∞–∑–≤–∏—Ç–∏–µ/–æ–±—É—á–µ–Ω–∏–µ</label>
                                <textarea class="form-control" id="development" name="development" rows="3" 
                                          placeholder="–ö—É—Ä—Å—ã, –∫–æ–Ω—Ñ–µ—Ä–µ–Ω—Ü–∏–∏, –º–µ–Ω—Ç–æ—Ä—Å—Ç–≤–æ...">{{ benchmark.development|default:'' }}</textarea>
                            </div>
                        </div>
                    </div>

                    <!-- –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π -->
                    <div class="d-flex justify-content-between align-items-center">
                        <div class="text-muted">
                            <small>
                                <i class="fas fa-calendar me-1"></i>
                                –°–æ–∑–¥–∞–Ω: {{ benchmark.date_added|date:"d.m.Y H:i" }} ‚Ä¢ 
                                <i class="fas fa-clock me-1"></i>
                                –û–±–Ω–æ–≤–ª–µ–Ω: {{ benchmark.updated_at|date:"d.m.Y H:i" }}
                            </small>
                        </div>
                        <div class="btn-group">
                            <button type="button" class="btn btn-outline-secondary" onclick="history.back()">
                                <i class="fas fa-times me-2"></i>–û—Ç–º–µ–Ω–∞
                            </button>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save me-2"></i>–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–µ–≤—å—é –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
function updatePreview() {
    const type = document.getElementById('type');
    const salaryFrom = document.getElementById('salary_from');
    const salaryTo = document.getElementById('salary_to');
    const vacancy = document.getElementById('vacancy_id');
    const grade = document.getElementById('grade_id');
    const location = document.getElementById('location');
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞—Ä–ø–ª–∞—Ç—É
    const fromValue = salaryFrom.value ? parseFloat(salaryFrom.value) : 0;
    const toValue = salaryTo.value ? parseFloat(salaryTo.value) : null;
    
    let salaryDisplay;
    if (toValue && toValue > fromValue) {
        salaryDisplay = `$${fromValue.toFixed(0)}‚Äì$${toValue.toFixed(0)}`;
    } else {
        salaryDisplay = `$${fromValue.toFixed(0)}`;
    }
    document.getElementById('previewAmount').textContent = salaryDisplay;
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–∏–ø
    const typeText = type.options[type.selectedIndex].text;
    document.getElementById('previewType').textContent = typeText;
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –≤–∞–∫–∞–Ω—Å–∏—é
    const vacancyText = vacancy.options[vacancy.selectedIndex].text;
    document.getElementById('previewVacancy').textContent = vacancyText;
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –≥—Ä–µ–π–¥
    const gradeText = grade.options[grade.selectedIndex].text;
    document.getElementById('previewGrade').textContent = gradeText;
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –ª–æ–∫–∞—Ü–∏—é
    document.getElementById('previewLocation').textContent = location.value || '–ù–µ —É–∫–∞–∑–∞–Ω–∞';
}

// –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
document.addEventListener('DOMContentLoaded', function() {
    const inputs = ['type', 'salary_from', 'salary_to', 'vacancy_id', 'grade_id', 'location'];
    inputs.forEach(id => {
        const element = document.getElementById(id);
        if (element) {
            element.addEventListener('input', updatePreview);
            element.addEventListener('change', updatePreview);
        }
    });
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ø—Ä–µ–≤—å—é
    updatePreview();
});

// –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º—ã
document.getElementById('editBenchmarkForm').addEventListener('submit', function(e) {
    const salaryFrom = document.getElementById('salary_from').value;
    const salaryTo = document.getElementById('salary_to').value;
    const vacancy = document.getElementById('vacancy_id').value;
    const grade = document.getElementById('grade_id').value;
    const location = document.getElementById('location').value;
    
    if (!salaryFrom || parseFloat(salaryFrom) <= 0) {
        e.preventDefault();
        alert('–ó–∞—Ä–ø–ª–∞—Ç–∞ "–æ—Ç" –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ–π');
        return;
    }
    
    if (salaryTo && parseFloat(salaryTo) <= 0) {
        e.preventDefault();
        alert('–ó–∞—Ä–ø–ª–∞—Ç–∞ "–¥–æ" –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ–π');
        return;
    }
    
    if (salaryTo && parseFloat(salaryTo) <= parseFloat(salaryFrom)) {
        e.preventDefault();
        alert('–ó–∞—Ä–ø–ª–∞—Ç–∞ "–¥–æ" –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –±–æ–ª—å—à–µ –∑–∞—Ä–ø–ª–∞—Ç—ã "–æ—Ç"');
        return;
    }
    
    if (!vacancy) {
        e.preventDefault();
        alert('–í—ã–±–µ—Ä–∏—Ç–µ –≤–∞–∫–∞–Ω—Å–∏—é');
        return;
    }
    
    if (!grade) {
        e.preventDefault();
        alert('–í—ã–±–µ—Ä–∏—Ç–µ –≥—Ä–µ–π–¥');
        return;
    }
    
    if (!location.trim()) {
        e.preventDefault();
        alert('–£–∫–∞–∂–∏—Ç–µ –ª–æ–∫–∞—Ü–∏—é');
        return;
    }
});
// –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Ç–µ–º—ã –¥–ª—è Huntflow
// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ç–µ–º—ã
function toggleTheme() {
    console.log('üîÑ Huntflow: –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç–µ–º—ã...');
    const html = document.documentElement;
    const currentTheme = html.getAttribute('data-theme');
    const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
    
    console.log('üìä Huntflow: –¢–µ–∫—É—â–∞—è —Ç–µ–º–∞:', currentTheme);
    console.log('üéØ Huntflow: –ù–æ–≤–∞—è —Ç–µ–º–∞:', newTheme);
    
    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–æ–≤—É—é —Ç–µ–º—É
    html.setAttribute('data-theme', newTheme);
    console.log('‚úÖ Huntflow: –ê—Ç—Ä–∏–±—É—Ç data-theme —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω:', html.getAttribute('data-theme'));
    
    // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ–º CSS –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
    const root = document.documentElement;
    if (newTheme === 'dark') {
        root.style.setProperty('--color-background', '#0d1117');
        root.style.setProperty('--color-surface', '#161b22');
        root.style.setProperty('--color-text', 'var(--color-luna-400)');
        root.style.setProperty('--color-primary', 'var(--color-pink-400)');
        console.log('üåô Huntflow: –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã —Ç–µ–º–Ω—ã–µ —Ü–≤–µ—Ç–∞');
    } else {
        root.style.setProperty('--color-background', '#ffffff');
        root.style.setProperty('--color-surface', '#ffffff');
        root.style.setProperty('--color-text', '#13343b');
        root.style.setProperty('--color-primary', 'var(--color-lime-500)');
        console.log('‚òÄÔ∏è Huntflow: –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã —Å–≤–µ—Ç–ª—ã–µ —Ü–≤–µ—Ç–∞');
    }
    
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage
    localStorage.setItem('theme', newTheme);
    console.log('üíæ Huntflow: –¢–µ–º–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –≤ localStorage:', localStorage.getItem('theme'));
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –∏–∫–æ–Ω–∫—É
    updateThemeIcon(newTheme);
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
    showThemeNotification(newTheme);
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–∫–æ–Ω–∫–∏ —Ç–µ–º—ã
function updateThemeIcon(theme) {
    const themeIcon = document.getElementById('themeIcon');
    if (themeIcon) {
        if (theme === 'dark') {
            themeIcon.className = 'fas fa-moon';
        } else {
            themeIcon.className = 'fas fa-sun';
        }
        console.log('üé® Huntflow: –ò–∫–æ–Ω–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–ª—è —Ç–µ–º—ã:', theme);
    }
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫–∞–∑–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Å–º–µ–Ω–µ —Ç–µ–º—ã
function showThemeNotification(theme) {
    const themeName = theme === 'dark' ? '–¢—ë–º–Ω–∞—è' : '–°–≤–µ—Ç–ª–∞—è';
    
    // –°–æ–∑–¥–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
    const notification = document.createElement('div');
    notification.className = 'alert alert-info alert-dismissible fade show position-fixed';
    notification.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 200px;';
    
    notification.innerHTML = `
        <i class="fas fa-${theme === 'dark' ? 'moon' : 'sun'} me-2"></i>
        –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–æ –Ω–∞ ${themeName} —Ç–µ–º—É
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    `;
    
    // –î–æ–±–∞–≤–ª—è–µ–º –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É
    document.body.appendChild(notification);
    
    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è–µ–º —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
    setTimeout(function() {
        if (notification.parentNode) {
            notification.parentNode.removeChild(notification);
        }
    }, 3000);
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ç–µ–º—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
document.addEventListener('DOMContentLoaded', function() {
    console.log('üöÄ Huntflow: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—è —Ç–µ–º—ã...');
    
    // –ü–æ–ª—É—á–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—É—é —Ç–µ–º—É –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å–∏—Å—Ç–µ–º–Ω—É—é
    const savedTheme = localStorage.getItem('theme');
    const systemTheme = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
    const theme = savedTheme || systemTheme;
    
    console.log('üíæ Huntflow: –°–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–∞—è —Ç–µ–º–∞:', savedTheme);
    console.log('üñ•Ô∏è Huntflow: –°–∏—Å—Ç–µ–º–Ω–∞—è —Ç–µ–º–∞:', systemTheme);
    console.log('üéØ Huntflow: –í—ã–±—Ä–∞–Ω–Ω–∞—è —Ç–µ–º–∞:', theme);
    
    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ–º—É
    document.documentElement.setAttribute('data-theme', theme);
    console.log('‚úÖ Huntflow: –ê—Ç—Ä–∏–±—É—Ç data-theme —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ:', document.documentElement.getAttribute('data-theme'));
    
    // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ–º CSS –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    const root = document.documentElement;
    if (theme === 'dark') {
        root.style.setProperty('--color-background', '#0d1117');
        root.style.setProperty('--color-surface', '#161b22');
        root.style.setProperty('--color-text', 'var(--color-luna-400)');
        root.style.setProperty('--color-primary', 'var(--color-pink-400)');
        console.log('üåô Huntflow: –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã —Ç–µ–º–Ω—ã–µ —Ü–≤–µ—Ç–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ');
    } else {
        root.style.setProperty('--color-background', '#ffffff');
        root.style.setProperty('--color-surface', '#ffffff');
        root.style.setProperty('--color-text', '#13343b');
        root.style.setProperty('--color-primary', 'var(--color-lime-500)');
        console.log('‚òÄÔ∏è Huntflow: –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã —Å–≤–µ—Ç–ª—ã–µ —Ü–≤–µ—Ç–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ');
    }
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –∏–∫–æ–Ω–∫—É
    updateThemeIcon(theme);
    
    // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –Ω–∞ –∫–Ω–æ–ø–∫—É –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ç–µ–º—ã
    const themeToggle = document.getElementById('themeToggle');
    console.log('üîò Huntflow: –ö–Ω–æ–ø–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ç–µ–º—ã –Ω–∞–π–¥–µ–Ω–∞:', themeToggle);
    if (themeToggle) {
        // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏, –µ—Å–ª–∏ –æ–Ω–∏ –µ—Å—Ç—å
        themeToggle.removeEventListener('click', toggleTheme);
        // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫
        themeToggle.addEventListener('click', toggleTheme);
        console.log('‚úÖ Huntflow: –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω');
    } else {
        console.error('‚ùå Huntflow: –ö–Ω–æ–ø–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ç–µ–º—ã –Ω–µ –Ω–∞–π–¥–µ–Ω–∞!');
    }
    
    // –°–ª—É—à–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–∏—Å—Ç–µ–º–Ω–æ–π —Ç–µ–º—ã
    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', function(e) {
        if (!localStorage.getItem('theme')) {
            const newTheme = e.matches ? 'dark' : 'light';
            document.documentElement.setAttribute('data-theme', newTheme);
            updateThemeIcon(newTheme);
        }
    });
    
    console.log('‚úÖ Huntflow: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—è —Ç–µ–º—ã –∑–∞–≤–µ—Ä—à–µ–Ω–∞');
    
    // –ì–ª–æ–±–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
    window.testThemeToggle = function() {
        console.log('üß™ Huntflow: –¢–µ—Å—Ç–∏—Ä—É–µ–º –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç–µ–º—ã...');
        toggleTheme();
    };
});
</script>
{% endblock %}

