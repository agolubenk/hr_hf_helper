# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–Ω–æ–ø–∫–∏ –≤—Ö–æ–¥–∞ —á–µ—Ä–µ–∑ Google OAuth

## –ü—Ä–æ–±–ª–µ–º–∞

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–æ–±—â–∏–ª, —á—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–Ω–æ–ø–∫–∞ –≤—Ö–æ–¥–∞ —á–µ—Ä–µ–∑ Google –∞–∫–∫–∞—É–Ω—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ:
`http://127.0.0.1:8000/accounts/login/?next=/google-oauth/oauth/start/`

## –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–Ω–æ–ø–∫–∏ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –≤—Ö–æ–¥–∞
```bash
curl -s http://localhost:8000/accounts/login/ | grep -A 5 -B 5 "google"
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ö–Ω–æ–ø–∫–∞ "–í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ Google" –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∏ —Å—Å—ã–ª–∞–µ—Ç—Å—è –Ω–∞ `/google-oauth/oauth/start/`

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ URL
```bash
curl -v http://localhost:8000/google-oauth/oauth/start/
# –†–µ–∑—É–ª—å—Ç–∞—Ç: HTTP/1.1 302 Found
# Location: /accounts/login/?next=/google-oauth/oauth/start/
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –¶–∏–∫–ª–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ - URL —Ç—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏, –Ω–æ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤—Ö–æ–¥–∞.

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ views
```python
# –ù–∞–π–¥–µ–Ω—ã –¥—É–±–ª–∏—Ä—É—é—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏:
def google_oauth_start(request):  # –ë–µ–∑ @login_required
def google_oauth_start(request):  # –° @login_required (–ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –ø–µ—Ä–≤—É—é)
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –í—Ç–æ—Ä–∞—è —Ñ—É–Ω–∫—Ü–∏—è —Å `@login_required` –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–ª–∞ –ø–µ—Ä–≤—É—é, —á—Ç–æ —Ç—Ä–µ–±–æ–≤–∞–ª–æ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –¥–ª—è OAuth –ø—Ä–æ—Ü–µ—Å—Å–∞.

## –†–µ—à–µ–Ω–∏–µ

### –£–¥–∞–ª–µ–Ω–∏–µ –¥—É–±–ª–∏—Ä—É—é—â–∏—Ö —Ñ—É–Ω–∫—Ü–∏–π

**–ü—Ä–æ–±–ª–µ–º–∞:** –í —Ñ–∞–π–ª–µ `backend/apps/google_oauth/views.py` –±—ã–ª–∏ –¥–≤–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º –∏–º–µ–Ω–µ–º:

1. **–ü–µ—Ä–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è (—Å—Ç—Ä–æ–∫–∏ 29-51):** –ë–µ–∑ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–∞ `@login_required`
   - –ü—Ä–∞–≤–∏–ª—å–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç OAuth –¥–ª—è –Ω–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `GoogleOAuthService`

2. **–í—Ç–æ—Ä–∞—è —Ñ—É–Ω–∫—Ü–∏—è (—Å—Ç—Ä–æ–∫–∏ 663-684):** –° –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–æ–º `@login_required`
   - –¢—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (—á—Ç–æ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ –¥–ª—è OAuth)
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `google_auth_oauthlib.flow.Flow` –Ω–∞–ø—Ä—è–º—É—é

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** –£–¥–∞–ª–µ–Ω—ã –¥—É–±–ª–∏—Ä—É—é—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ (—Å—Ç—Ä–æ–∫–∏ 662-727), –æ—Å—Ç–∞–≤–ª–µ–Ω–∞ —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è –±–µ–∑ `@login_required`.

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫

**–ù–∞—Å—Ç—Ä–æ–π–∫–∏ Google OAuth:**
```python
GOOGLE_OAUTH2_CLIENT_ID = '968014303116-vtqq5f39tkaningitmj3dbq25snnmdgp.apps.googleusercontent.com'
GOOGLE_OAUTH2_CLIENT_SECRET = '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'
GOOGLE_OAUTH_REDIRECT_URI = 'http://127.0.0.1:8000/google-oauth/callback/'
```

**–°–µ—Ä–≤–∏—Å GoogleOAuthService:**
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- –°–æ–∑–¥–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π OAuth flow
- –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π authorization URL

## –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

### ‚úÖ –ö–Ω–æ–ø–∫–∞ Google OAuth —Ä–∞–±–æ—Ç–∞–µ—Ç
```bash
python manage.py shell -c "from django.test import Client; client = Client(); response = client.get('/google-oauth/oauth/start/'); print('Status:', response.status_code)"
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
```
=== OAUTH START DEBUG ===
User authenticated: False
‚úÖ Auth URL created: https://accounts.google.com/o/oauth2/auth?response_type=code&client_id=...
‚úÖ State saved: w10s3zOAaVR4LAiBUbt7...
Status: 302
Location: https://accounts.google.com/o/oauth2/auth?response_type=code&client_id=...
```

### ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
- **–ë—ã–ª–æ:** `/accounts/login/?next=/google-oauth/oauth/start/` (—Ü–∏–∫–ª–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ)
- **–°—Ç–∞–ª–æ:** `https://accounts.google.com/o/oauth2/auth?...` (–ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ Google)

### ‚úÖ OAuth –ø—Ä–æ—Ü–µ—Å—Å —Ä–∞–±–æ—Ç–∞–µ—Ç
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç "–í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ Google"
2. –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ Google OAuth
3. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑—É–µ—Ç—Å—è –≤ Google
4. Google –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –æ–±—Ä–∞—Ç–Ω–æ —Å –∫–æ–¥–æ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
5. –°–∏—Å—Ç–µ–º–∞ –æ–±–º–µ–Ω–∏–≤–∞–µ—Ç –∫–æ–¥ –Ω–∞ —Ç–æ–∫–µ–Ω—ã
6. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑—É–µ—Ç—Å—è –≤ —Å–∏—Å—Ç–µ–º–µ

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ OAuth –ø—Ä–æ—Ü–µ—Å—Å–∞

### –ü–æ—Ç–æ–∫ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí /accounts/login/
2. –ù–∞–∂–∏–º–∞–µ—Ç "–í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ Google" ‚Üí /google-oauth/oauth/start/
3. –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ ‚Üí https://accounts.google.com/o/oauth2/auth
4. Google –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è ‚Üí /google-oauth/oauth/callback/
5. –û–±–º–µ–Ω –∫–æ–¥–∞ –Ω–∞ —Ç–æ–∫–µ–Ω—ã ‚Üí /google-oauth/dashboard/
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∏ OAuth
- **Client ID:** `968014303116-vtqq5f39tkaningitmj3dbq25snnmdgp.apps.googleusercontent.com`
- **Redirect URI:** `http://127.0.0.1:8000/google-oauth/callback/`
- **Scopes:** email, profile, calendar, drive, spreadsheets

### –°–æ—Å—Ç–æ—è–Ω–∏–µ (State)
- –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è —Å–ª—É—á–∞–π–Ω—ã–π state –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ —Å–µ—Å—Å–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –ø—Ä–∏ callback –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è CSRF –∞—Ç–∞–∫

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–Ω–æ–ø–∫–∏
```bash
curl -s http://localhost:8000/accounts/login/ | grep "google-oauth/oauth/start"
# –†–µ–∑—É–ª—å—Ç–∞—Ç: <a href="/google-oauth/oauth/start/" class="btn btn-outline-danger">
```

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ OAuth URL
```bash
curl -v http://localhost:8000/google-oauth/oauth/start/
# –†–µ–∑—É–ª—å—Ç–∞—Ç: 302 ‚Üí https://accounts.google.com/o/oauth2/auth
```

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫
```python
from apps.google_oauth.services import GoogleOAuthService
service = GoogleOAuthService(user)
auth_url, state = service.get_authorization_url()
# –†–µ–∑—É–ª—å—Ç–∞—Ç: –ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π Google OAuth URL
```

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–ü—Ä–æ–±–ª–µ–º–∞ –±—ã–ª–∞ –≤ –¥—É–±–ª–∏—Ä—É—é—â–∏—Ö —Ñ—É–Ω–∫—Ü–∏—è—Ö `google_oauth_start` –≤ views. –í—Ç–æ—Ä–∞—è —Ñ—É–Ω–∫—Ü–∏—è —Å –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–æ–º `@login_required` –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–ª–∞ –ø–µ—Ä–≤—É—é, —á—Ç–æ —Ç—Ä–µ–±–æ–≤–∞–ª–æ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –¥–ª—è OAuth –ø—Ä–æ—Ü–µ—Å—Å–∞ –∏ —Å–æ–∑–¥–∞–≤–∞–ª–æ —Ü–∏–∫–ª–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ.

–ü–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è –¥—É–±–ª–∏—Ä—É—é—â–∏—Ö —Ñ—É–Ω–∫—Ü–∏–π:

- ‚úÖ **–ö–Ω–æ–ø–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç:** –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–∞ Google OAuth
- ‚úÖ **–ù–µ—Ç —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏—Ö –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–π:** –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π OAuth flow
- ‚úÖ **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:** State –ø–∞—Ä–∞–º–µ—Ç—Ä –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç CSRF
- ‚úÖ **–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã:** –í—Å–µ OAuth –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ

–¢–µ–ø–µ—Ä—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç —É—Å–ø–µ—à–Ω–æ –≤—Ö–æ–¥–∏—Ç—å —á–µ—Ä–µ–∑ Google –∞–∫–∫–∞—É–Ω—Ç! üéâ
