{% extends 'huntflow/base.html' %}
{% load huntflow_filters %}

{% block huntflow_title %}–ö–∞–Ω–¥–∏–¥–∞—Ç: {{ applicant.first_name|default:"" }} {{ applicant.last_name|default:"" }}{% endblock %}
{% block huntflow_page_title %}–ö–∞–Ω–¥–∏–¥–∞—Ç: {{ applicant.first_name|default:"" }} {{ applicant.last_name|default:"" }}{% endblock %}


{% block content %}
<div class="row">
    <!-- –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
    <div class="col-md-8">
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="fas fa-user me-2"></i>
                    –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
                </h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-12">
                        <!-- –ü–µ—Ä–≤–∞—è —Å—Ç—Ä–æ–∫–∞: –í–∞–∫–∞–Ω—Å–∏—è | –°—Ç–∞—Ç—É—Å -->
                        <div class="row mb-3">
                            <div class="col-4">
                                {% if applicant.vacancy_info %}
                                <strong>–í–∞–∫–∞–Ω—Å–∏—è:</strong> 
                                <span class="badge bg-primary">{{ applicant.vacancy_info.position }}</span>
                                {% endif %}
                            </div>
                            <div class="col-8">
                                {% if applicant.status_info %}
                                <strong>–°—Ç–∞—Ç—É—Å:</strong> 
                                <span class="badge bg-info">{{ applicant.status_info.name }}</span>
                                {% endif %}
                            </div>
                        </div>
                        
                        <!-- –í—Ç–æ—Ä–∞—è —Å—Ç—Ä–æ–∫–∞: ID | –§–ò–û -->
                        <div class="row mb-3">
                            <div class="col-4">
                                <strong>ID:</strong> {{ applicant.id }}
                            </div>
                            <div class="col-8">
                                <strong>–§–ò–û:</strong> 
                                {% if applicant.first_name or applicant.last_name %}
                                    {{ applicant.first_name|default:"" }} {{ applicant.last_name|default:"" }}{% if applicant.middle_name %} {{ applicant.middle_name }}{% endif %}
                                {% else %}
                                    –ù–µ —É–∫–∞–∑–∞–Ω–æ
                                {% endif %}
                            </div>
                        </div>
                        
                        <!-- –¢—Ä–µ—Ç—å—è —Å—Ç—Ä–æ–∫–∞: –ó–∞—Ä–ø–ª–∞—Ç–Ω—ã–µ –æ–∂–∏–¥–∞–Ω–∏—è (—Ç–µ–∫—Å—Ç–æ–º) -->
                        {% if applicant.money %}
                        <div class="mb-3">
                            <strong>–ó–∞—Ä–ø–ª–∞—Ç–Ω—ã–µ –æ–∂–∏–¥–∞–Ω–∏—è:</strong> 
                            <span data-money="{{ applicant.money }}">{{ applicant.money }}</span>
                        </div>
                        {% endif %}
                        
                        <!-- –ß–µ—Ç–≤–µ—Ä—Ç–∞—è —Å—Ç—Ä–æ–∫–∞: –ú–µ—Ç–∫–∏ -->
                        {% if applicant.enriched_tags %}
                        <div class="mb-3">
                            <strong>–ú–µ—Ç–∫–∏:</strong> 
                            {% for tag in applicant.enriched_tags %}
                                {% if tag.color %}
                                    <span class="badge m-1" style="background-color: #{{ tag.color }} !important; color: {{ tag.color|get_contrast_color }} !important;">{{ tag.name|default:tag }}</span>
                                {% else %}
                                    <span class="badge bg-secondary mt-1 mb-1 ms-0  me-0">{{ tag.name|default:tag }}</span>
                                {% endif %}
                            {% endfor %}
                        </div>
                        {% endif %}
                    </div>
                    <div class="col-md-12">
                        <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
                        {% if applicant.updated %}
                        <p><strong>–û–±–Ω–æ–≤–ª–µ–Ω:</strong> {{ applicant.updated|date:"d.m.Y H:i" }}</p>
                        {% endif %}
                    </div>
                </div>
                
                
            </div>
        </div>
        
        <!-- –ê–Ω–∫–µ—Ç–∞ –∫–∞–Ω–¥–∏–¥–∞—Ç–∞ -->
        {% if questionary %}
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="fas fa-clipboard-list me-2"></i>
                    –ê–Ω–∫–µ—Ç–∞ –∫–∞–Ω–¥–∏–¥–∞—Ç–∞
                    <span class="badge bg-primary ms-2">{{ questionary|length }} –ø–æ–ª–µ–π</span>
                </h5>
            </div>
            <div class="card-body">
                <div class="row">
                    {% for field_key, field_data in questionary.items %}
                    <div class="col-12 mb-3">
                        <div class="questionary-field d-flex align-items-start border-bottom pb-2">
                            <div class="flex-grow-1">
                                <div class="d-flex align-items-center mb-1">
                                    <strong class="questionary-title me-2">{{ field_data.title }}</strong>
                                    <span class="badge bg-secondary questionary-badge me-2">{{ field_key }}</span>
                                    {% if field_data.required %}
                                        <span class="badge bg-danger">–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ</span>
                                    {% endif %}
                                </div>
                                <div class="ms-0">
                                    {% if field_data.value %}
                                        <span class="questionary-value">{{ field_data.value }}</span>
                                    {% else %}
                                        <span class="questionary-empty">–ù–µ —É–∫–∞–∑–∞–Ω–æ</span>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
        {% endif %}
    </div>
    
    <!-- –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å -->
    <div class="col-md-4">

        
        <!-- –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è -->
        <div class="card mb-4">
            <div class="card-header">
                <h6 class="card-title mb-0">
                    <i class="fas fa-bolt me-2"></i>
                    –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è
                </h6>
            </div>
            <div class="card-body">
                <div class="d-grid gap-2">
                    <a href="{% url 'huntflow:applicant_edit' account_id applicant.id %}" class="btn btn-outline-warning">
                        <i class="fas fa-edit me-1"></i>
                        –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–∞–Ω–¥–∏–¥–∞—Ç–∞
                    </a>
                    <button class="btn btn-outline-secondary" onclick="copyApplicantInfo()">
                        <i class="fas fa-copy me-1"></i>
                        –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
                    </button>
                </div>
            </div>
        </div>
        
        <!-- –ö–æ–Ω—Ç–∞–∫—Ç—ã -->
        <div class="card mb-4">
            <div class="card-header">
                <h6 class="card-title mb-0">
                    <i class="fas fa-address-book me-2"></i>
                    –ö–æ–Ω—Ç–∞–∫—Ç—ã
                </h6>
            </div>
            <div class="card-body">
                {% if applicant.email %}
                <div class="d-grid mb-2">
                    <a href="mailto:{{ applicant.email }}" class="btn btn-outline-primary btn-sm">
                        <i class="fas fa-envelope me-1"></i>
                        –ù–∞–ø–∏—Å–∞—Ç—å email
                    </a>
                </div>
                {% endif %}
                
                {% if applicant.phone %}
                <div class="d-grid mb-2">
                    <a href="tel:{{ applicant.phone }}" class="btn btn-outline-success btn-sm">
                        <i class="fas fa-phone me-1"></i>
                        –ü–æ–∑–≤–æ–Ω–∏—Ç—å
                    </a>
                </div>
                {% endif %}
                
                {% if applicant.social %}
                    {% for social in applicant.social %}
                        {% if social.social_type == 'TELEGRAM' %}
                        <div class="d-grid mb-2">
                            <a href="https://t.me/{{ social.value }}" target="_blank" class="btn btn-outline-info btn-sm">
                                <i class="fab fa-telegram me-1"></i>
                                –ù–∞–ø–∏—Å–∞—Ç—å –≤ Telegram
                            </a>
                        </div>
                        {% endif %}
                    {% endfor %}
                {% endif %}
            </div>
        </div>
        
        <!-- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ -->
        <div class="card">
            <div class="card-header">
                <h6 class="card-title mb-0">
                    <i class="fas fa-comments me-2"></i>
                    –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
                    {% if comments_count > 0 %}
                        <span class="badge bg-primary ms-2">{{ comments_count }} –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤</span>
                    {% endif %}
                </h6>
            </div>
            <div class="card-body">
                <!-- –§–æ—Ä–º–∞ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è -->
                <div class="add-comment-section mb-4">
                    <form id="add-comment-form" class="comment-form">
                        {% csrf_token %}
                        <div class="form-group">
                            <label for="new-comment" class="form-label">
                                <i class="fas fa-plus-circle me-1"></i>
                                –î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π
                            </label>
                            <div class="comment-input-wrapper">
                                <textarea 
                                    id="new-comment" 
                                    name="comment" 
                                    class="form-control comment-textarea" 
                                    rows="1" 
                                    placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π..."
                                ></textarea>
                                <div class="comment-actions mt-2" style="display: none;">
                                    <button type="submit" class="btn btn-primary btn-sm">
                                        <i class="fas fa-paper-plane me-1"></i>
                                        –û—Ç–ø—Ä–∞–≤–∏—Ç—å
                                    </button>
                                    <button type="button" class="btn btn-outline-secondary btn-sm ms-2" id="cancel-comment">
                                        <i class="fas fa-times me-1"></i>
                                        –û—Ç–º–µ–Ω–∞
                                    </button>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                
                <hr class="my-3">
                {% if applicant_logs %}
                    {% for log in applicant_logs %}
                        {% if log.comment %}
                        <div class="comment-item">
                            <div class="d-flex justify-content-between align-items-start mb-2">
                                {% if log.status %}
                                    <h6 class="comment-title text-primary mb-0">
                                        <span class="badge bg-info comment-status-badge">{{ log.status.name }}</span>
                                    </h6>
                                {% elif log.type == 'COMMENT' %}
                                    <h6 class="comment-title text-primary mb-0">
                                        <span class="badge bg-secondary">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</span>
                                    </h6>
                                {% else %}
                                    <h6 class="comment-title text-primary mb-0">
                                        <span class="badge bg-light text-dark">{{ log.type_display|default:log.type }}</span>
                                    </h6>
                                {% endif %}
                                <div class="text-end">
                                    {% if log.created %}
                                        <div class="text-muted">
                                            <span class="date-time" data-iso="{{ log.created }}">{{ log.created }}</span>
                                            <i class="fas fa-clock text-muted ms-1"></i>
                                        </div>
                                    {% else %}
                                        <div class="text-muted">
                                            <span class="text-danger">–î–∞—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞</span>
                                            <i class="fas fa-clock text-muted ms-1"></i>
                                        </div>
                                    {% endif %}
                                </div>
                            </div>
                            
                            <div class="comment-bubble-wrapper">
                                <div class="comment-bubble">
                                    <div class="comment-content">
                                        {{ log.comment|linebreaks|safe }}
                                    </div>
                                    <div class="comment-bubble-arrow"></div>
                                </div>
                                {% if log.author %}
                                    <div class="comment-author-wrapper">
                                        <span class="badge bg-secondary comment-author-badge">
                                            <i class="fas fa-user me-1"></i>
                                            {{ log.author }}
                                        </span>
                                    </div>
                                {% endif %}
                            </div>
                            
                            
                            {% if log.files %}
                                <div class="comment-vacancy-info">
                                    <i class="fas fa-paperclip me-1"></i>
                                    –§–∞–π–ª—ã: {{ log.files|length }} —à—Ç.
                                </div>
                            {% endif %}
                            
                            {% if log.email %}
                                <div class="comment-vacancy-info">
                                    <i class="fas fa-envelope me-1"></i>
                                    Email: {{ log.email.subject|default:"–ë–µ–∑ —Ç–µ–º—ã" }}
                                </div>
                            {% endif %}
                            
                            {% if log.im %}
                                <div class="comment-vacancy-info">
                                    <i class="fab fa-telegram me-1"></i>
                                    IM: {{ log.im.body|default:"–ù–ï–¢" }}
                                </div>
                            {% endif %}
                            
                            {% if log.sms %}
                                <div class="comment-vacancy-info">
                                    <i class="fas fa-sms me-1"></i>
                                    SMS: {{ log.sms.body|default:"–ù–ï–¢" }}
                                </div>
                            {% endif %}
                        </div>
                        {% if not forloop.last %}
                            <hr class="comment-divider">
                        {% endif %}
                        {% endif %}
                    {% endfor %}
                {% endif %}
                
                {% if applicant.status_info and applicant.status_info.description %}
                    <div class="comment-section">
                        <h6 class="comment-title text-info">–û–ø–∏—Å–∞–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞:</h6>
                        <div class="comment-content">
                            {{ applicant.status_info.description }}
                        </div>
                    </div>
                {% endif %}
                
                {% if not comments_count and not applicant.status_info.description %}
                    <div class="no-comments">
                        <i class="fas fa-comment-slash fa-2x mb-2"></i>
                        <p class="mb-0">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç</p>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>


{% endblock %}

{% block extra_js %}
<!-- –°—Ç–∏–ª–∏ —É–∂–µ –ø–æ–¥–∫–ª—é—á–µ–Ω—ã –≤ base.html -->

<script>
function copyApplicantInfo() {
    let info = `–ö–∞–Ω–¥–∏–¥–∞—Ç: ${document.title}\nID: {{ applicant.id }}\n–§–ò–û: {{ applicant.first_name|default:"" }} {{ applicant.last_name|default:"" }}{% if applicant.middle_name %} {{ applicant.middle_name }}{% endif %}`;
    
    // –î–æ–±–∞–≤–ª—è–µ–º –∫–æ–Ω—Ç–∞–∫—Ç—ã –∏–∑ –∫–∞—Ä—Ç–æ—á–∫–∏ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤
    const emailElement = document.querySelector('[data-email]');
    const phoneElement = document.querySelector('[data-phone]');
    const telegramElement = document.querySelector('[data-telegram]');
    
    if (emailElement) {
        info += `\nEmail: ${emailElement.textContent}`;
    }
    if (phoneElement) {
        info += `\n–¢–µ–ª–µ—Ñ–æ–Ω: ${phoneElement.textContent}`;
    }
    if (telegramElement) {
        info += `\nTelegram: ${telegramElement.textContent}`;
    }
    
    // –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –∏ –≤–∞–∫–∞–Ω—Å–∏—é –∏–∑ DOM
    const statusElement = document.querySelector('.badge.bg-info');
    if (statusElement) {
        info += `\n–°—Ç–∞—Ç—É—Å: ${statusElement.textContent}`;
    }
    
    const vacancyElement = document.querySelector('.badge.bg-primary');
    if (vacancyElement) {
        info += `\n–í–∞–∫–∞–Ω—Å–∏—è: ${vacancyElement.textContent}`;
    }

    // –î–æ–±–∞–≤–ª—è–µ–º –∑–∞—Ä–ø–ª–∞—Ç–Ω—ã–µ –æ–∂–∏–¥–∞–Ω–∏—è –∏–∑ DOM
    const moneyElement = document.querySelector('[data-money]');
    if (moneyElement) {
        info += `\n–ó–∞—Ä–ø–ª–∞—Ç–Ω—ã–µ –æ–∂–∏–¥–∞–Ω–∏—è: ${moneyElement.textContent}`;
    }
    
    navigator.clipboard.writeText(info).then(function() {
        showAlert('success', '–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞');
    }, function() {
        showAlert('danger', '–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é');
    });
}


function showAlert(type, message) {
    const alertHtml = `
        <div class="alert alert-${type} alert-dismissible fade show" role="alert">
            ${message}
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
    `;
    
    $('.messages').append(alertHtml);
    
    setTimeout(() => {
        $('.alert').fadeOut();
    }, 3000);
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è ISO –¥–∞—Ç—ã –≤ –∫—Ä–∞—Å–∏–≤—ã–π —Ñ–æ—Ä–º–∞—Ç
function formatISODate(isoString) {
    if (!isoString) return '';
    
    try {
        // –£–±–∏—Ä–∞–µ–º —á–∞—Å–æ–≤–æ–π –ø–æ—è—Å –µ—Å–ª–∏ –µ—Å—Ç—å
        const cleanISO = isoString.replace(/[+-]\d{2}:\d{2}$/, '');
        
        // –ü–∞—Ä—Å–∏–º –¥–∞—Ç—É
        const date = new Date(cleanISO);
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –¥–∞—Ç–∞ –≤–∞–ª–∏–¥–Ω–∞
        if (isNaN(date.getTime())) {
            return isoString;
        }
        
        // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –≤ dd.mm.yy hh:mm
        const day = String(date.getDate()).padStart(2, '0');
        const month = String(date.getMonth() + 1).padStart(2, '0');
        const year = String(date.getFullYear()).slice(-2);
        const hours = String(date.getHours()).padStart(2, '0');
        const minutes = String(date.getMinutes()).padStart(2, '0');
        
        return `${day}.${month}.${year} ${hours}:${minutes}`;
    } catch (error) {
        return isoString;
    }
}

// –ü—Ä–∏–º–µ–Ω—è–µ–º —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ –≤—Å–µ–º –¥–∞—Ç–∞–º –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
document.addEventListener('DOMContentLoaded', function() {
    const dateElements = document.querySelectorAll('.date-time');
    dateElements.forEach(function(element) {
        const isoDate = element.getAttribute('data-iso');
        if (isoDate) {
            element.textContent = formatISODate(isoDate);
        }
    });
    
    // –ü—Ä–∏–º–µ–Ω—è–µ–º –∫–æ–Ω—Ç—Ä–∞—Å—Ç–Ω—ã–µ —Ü–≤–µ—Ç–∞ –∫ –º–µ—Ç–∫–∞–º
    const tagBadges = document.querySelectorAll('.badge[style*="background-color"]');
    tagBadges.forEach(function(badge) {
        const bgColor = badge.style.backgroundColor;
        if (bgColor && bgColor !== 'rgb(108, 117, 125)') { // –ù–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Å–µ—Ä—ã–µ –º–µ—Ç–∫–∏
            // –ò–∑–≤–ª–µ–∫–∞–µ–º hex —Ü–≤–µ—Ç –∏–∑ rgb() —Å—Ç—Ä–æ–∫–∏
            const rgbMatch = bgColor.match(/rgb\((\d+),\s*(\d+),\s*(\d+)\)/);
            if (rgbMatch) {
                const r = parseInt(rgbMatch[1]);
                const g = parseInt(rgbMatch[2]);
                const b = parseInt(rgbMatch[3]);
                const hexColor = '#' + 
                    r.toString(16).padStart(2, '0') + 
                    g.toString(16).padStart(2, '0') + 
                    b.toString(16).padStart(2, '0');
                
                const contrastColor = getContrastColor(hexColor);
                badge.style.color = contrastColor + ' !important';
            }
        }
    });
});

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ hex –≤ RGB
function hexToRgb(hex) {
    const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
    return result ? {
        r: parseInt(result[1], 16),
        g: parseInt(result[2], 16),
        b: parseInt(result[3], 16)
    } : null;
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –∫–æ–Ω—Ç—Ä–∞—Å—Ç–Ω–æ—Å—Ç–∏ —Ü–≤–µ—Ç–∞
function getContrastColor(hexColor) {
    if (!hexColor) {
        return '#000000';
    }
    
    // –£–±–∏—Ä–∞–µ–º # –µ—Å–ª–∏ –µ—Å—Ç—å
    hexColor = hexColor.replace('#', '');
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –≤–∞–ª–∏–¥–Ω—ã–π hex —Ü–≤–µ—Ç
    if (hexColor.length !== 6) {
        return '#000000';
    }
    
    try {
        // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º hex –≤ RGB
        const r = parseInt(hexColor.substr(0, 2), 16);
        const g = parseInt(hexColor.substr(2, 2), 16);
        const b = parseInt(hexColor.substr(4, 2), 16);
        
        // –í—ã—á–∏—Å–ª—è–µ–º —è—Ä–∫–æ—Å—Ç—å –ø–æ —Ñ–æ—Ä–º—É–ª–µ W3C
        // –ò—Å–ø–æ–ª—å–∑—É–µ–º –≤–µ—Å–∞ –¥–ª—è —É—á–µ—Ç–∞ –≤–æ—Å–ø—Ä–∏—è—Ç–∏—è —è—Ä–∫–æ—Å—Ç–∏ —á–µ–ª–æ–≤–µ—á–µ—Å–∫–∏–º –≥–ª–∞–∑–æ–º
        const brightness = (r * 299 + g * 587 + b * 114) / 1000;
        
        // –í–æ–∑–≤—Ä–∞—â–∞–µ–º —á–µ—Ä–Ω—ã–π –¥–ª—è —Å–≤–µ—Ç–ª—ã—Ö —Ü–≤–µ—Ç–æ–≤, –±–µ–ª—ã–π –¥–ª—è —Ç–µ–º–Ω—ã—Ö
        return brightness > 128 ? '#000000' : '#ffffff';
    } catch (error) {
        // –ï—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —á–µ—Ä–Ω—ã–π –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        return '#000000';
    }
}

// –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ä–º—ã –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è
document.addEventListener('DOMContentLoaded', function() {
    const commentForm = document.getElementById('add-comment-form');
    const commentTextarea = document.getElementById('new-comment');
    const commentActions = document.querySelector('.comment-actions');
    const cancelButton = document.getElementById('cancel-comment');
    
    if (commentForm && commentTextarea && commentActions) {
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ–∫—É—Å–∞ –Ω–∞ textarea
        commentTextarea.addEventListener('focus', function() {
            this.classList.add('expanded');
            commentActions.style.display = 'block';
        });
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ—Ç–µ—Ä–∏ —Ñ–æ–∫—É—Å–∞
        commentTextarea.addEventListener('blur', function() {
            if (!this.value.trim()) {
                this.classList.remove('expanded');
                commentActions.style.display = 'none';
            }
        });
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–∞ –≤–Ω–µ —Ñ–æ—Ä–º—ã
        document.addEventListener('click', function(e) {
            if (!commentForm.contains(e.target) && !commentTextarea.value.trim()) {
                commentTextarea.classList.remove('expanded');
                commentActions.style.display = 'none';
            }
        });
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–Ω–æ–ø–∫–∏ –æ—Ç–º–µ–Ω—ã
        cancelButton.addEventListener('click', function() {
            commentTextarea.value = '';
            commentTextarea.classList.remove('expanded');
            commentActions.style.display = 'none';
            commentTextarea.blur();
        });
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
        commentForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const commentText = commentTextarea.value.trim();
            if (!commentText) {
                showAlert('warning', '–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è');
                return;
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
            const submitButton = commentForm.querySelector('button[type="submit"]');
            const originalText = submitButton.innerHTML;
            submitButton.innerHTML = '<i class="fas fa-spinner fa-spin me-1"></i>–û—Ç–ø—Ä–∞–≤–∫–∞...';
            submitButton.disabled = true;
            
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º AJAX –∑–∞–ø—Ä–æ—Å
            fetch(`{% url 'huntflow:create_comment_ajax' account_id applicant.id %}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                    'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
                },
                body: `comment=${encodeURIComponent(commentText)}`
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showAlert('success', data.message);
                    // –û—á–∏—â–∞–µ–º —Ñ–æ—Ä–º—É
                    commentTextarea.value = '';
                    commentTextarea.classList.remove('expanded');
                    commentActions.style.display = 'none';
                    // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤
                    setTimeout(() => {
                        window.location.reload();
                    }, 1000);
                } else {
                    showAlert('error', data.message);
                }
            })
            .catch(error => {
                console.error('–û—à–∏–±–∫–∞:', error);
                showAlert('error', '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è');
            })
            .finally(() => {
                // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–Ω–æ–ø–∫—É
                submitButton.innerHTML = originalText;
                submitButton.disabled = false;
            });
        });
    }
});
// –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Ç–µ–º—ã –¥–ª—è Huntflow
// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ç–µ–º—ã
function toggleTheme() {
    console.log('üîÑ Huntflow: –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç–µ–º—ã...');
    const html = document.documentElement;
    const currentTheme = html.getAttribute('data-theme');
    const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
    
    console.log('üìä Huntflow: –¢–µ–∫—É—â–∞—è —Ç–µ–º–∞:', currentTheme);
    console.log('üéØ Huntflow: –ù–æ–≤–∞—è —Ç–µ–º–∞:', newTheme);
    
    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–æ–≤—É—é —Ç–µ–º—É
    html.setAttribute('data-theme', newTheme);
    console.log('‚úÖ Huntflow: –ê—Ç—Ä–∏–±—É—Ç data-theme —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω:', html.getAttribute('data-theme'));
    
    // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ–º CSS –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
    const root = document.documentElement;
    if (newTheme === 'dark') {
        root.style.setProperty('--color-background', '#0d1117');
        root.style.setProperty('--color-surface', '#161b22');
        root.style.setProperty('--color-text', 'var(--color-luna-400)');
        root.style.setProperty('--color-primary', 'var(--color-pink-400)');
        console.log('üåô Huntflow: –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã —Ç–µ–º–Ω—ã–µ —Ü–≤–µ—Ç–∞');
    } else {
        root.style.setProperty('--color-background', '#ffffff');
        root.style.setProperty('--color-surface', '#ffffff');
        root.style.setProperty('--color-text', '#13343b');
        root.style.setProperty('--color-primary', 'var(--color-lime-500)');
        console.log('‚òÄÔ∏è Huntflow: –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã —Å–≤–µ—Ç–ª—ã–µ —Ü–≤–µ—Ç–∞');
    }
    
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage
    localStorage.setItem('theme', newTheme);
    console.log('üíæ Huntflow: –¢–µ–º–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –≤ localStorage:', localStorage.getItem('theme'));
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –∏–∫–æ–Ω–∫—É
    updateThemeIcon(newTheme);
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
    showThemeNotification(newTheme);
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–∫–æ–Ω–∫–∏ —Ç–µ–º—ã
function updateThemeIcon(theme) {
    const themeIcon = document.getElementById('themeIcon');
    if (themeIcon) {
        if (theme === 'dark') {
            themeIcon.className = 'fas fa-moon';
        } else {
            themeIcon.className = 'fas fa-sun';
        }
        console.log('üé® Huntflow: –ò–∫–æ–Ω–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–ª—è —Ç–µ–º—ã:', theme);
    }
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫–∞–∑–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Å–º–µ–Ω–µ —Ç–µ–º—ã
function showThemeNotification(theme) {
    const themeName = theme === 'dark' ? '–¢—ë–º–Ω–∞—è' : '–°–≤–µ—Ç–ª–∞—è';
    
    // –°–æ–∑–¥–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
    const notification = document.createElement('div');
    notification.className = 'alert alert-info alert-dismissible fade show position-fixed';
    notification.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 200px;';
    
    notification.innerHTML = `
        <i class="fas fa-${theme === 'dark' ? 'moon' : 'sun'} me-2"></i>
        –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–æ –Ω–∞ ${themeName} —Ç–µ–º—É
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    `;
    
    // –î–æ–±–∞–≤–ª—è–µ–º –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É
    document.body.appendChild(notification);
    
    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è–µ–º —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
    setTimeout(function() {
        if (notification.parentNode) {
            notification.parentNode.removeChild(notification);
        }
    }, 3000);
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ç–µ–º—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
document.addEventListener('DOMContentLoaded', function() {
    console.log('üöÄ Huntflow: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—è —Ç–µ–º—ã...');
    
    // –ü–æ–ª—É—á–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—É—é —Ç–µ–º—É –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å–∏—Å—Ç–µ–º–Ω—É—é
    const savedTheme = localStorage.getItem('theme');
    const systemTheme = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
    const theme = savedTheme || systemTheme;
    
    console.log('üíæ Huntflow: –°–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–∞—è —Ç–µ–º–∞:', savedTheme);
    console.log('üñ•Ô∏è Huntflow: –°–∏—Å—Ç–µ–º–Ω–∞—è —Ç–µ–º–∞:', systemTheme);
    console.log('üéØ Huntflow: –í—ã–±—Ä–∞–Ω–Ω–∞—è —Ç–µ–º–∞:', theme);
    
    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ–º—É
    document.documentElement.setAttribute('data-theme', theme);
    console.log('‚úÖ Huntflow: –ê—Ç—Ä–∏–±—É—Ç data-theme —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ:', document.documentElement.getAttribute('data-theme'));
    
    // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ–º CSS –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    const root = document.documentElement;
    if (theme === 'dark') {
        root.style.setProperty('--color-background', '#0d1117');
        root.style.setProperty('--color-surface', '#161b22');
        root.style.setProperty('--color-text', 'var(--color-luna-400)');
        root.style.setProperty('--color-primary', 'var(--color-pink-400)');
        console.log('üåô Huntflow: –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã —Ç–µ–º–Ω—ã–µ —Ü–≤–µ—Ç–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ');
    } else {
        root.style.setProperty('--color-background', '#ffffff');
        root.style.setProperty('--color-surface', '#ffffff');
        root.style.setProperty('--color-text', '#13343b');
        root.style.setProperty('--color-primary', 'var(--color-lime-500)');
        console.log('‚òÄÔ∏è Huntflow: –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã —Å–≤–µ—Ç–ª—ã–µ —Ü–≤–µ—Ç–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ');
    }
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –∏–∫–æ–Ω–∫—É
    updateThemeIcon(theme);
    
    // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –Ω–∞ –∫–Ω–æ–ø–∫—É –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ç–µ–º—ã
    const themeToggle = document.getElementById('themeToggle');
    console.log('üîò Huntflow: –ö–Ω–æ–ø–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ç–µ–º—ã –Ω–∞–π–¥–µ–Ω–∞:', themeToggle);
    if (themeToggle) {
        // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏, –µ—Å–ª–∏ –æ–Ω–∏ –µ—Å—Ç—å
        themeToggle.removeEventListener('click', toggleTheme);
        // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫
        themeToggle.addEventListener('click', toggleTheme);
        console.log('‚úÖ Huntflow: –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω');
    } else {
        console.error('‚ùå Huntflow: –ö–Ω–æ–ø–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ç–µ–º—ã –Ω–µ –Ω–∞–π–¥–µ–Ω–∞!');
    }
    
    // –°–ª—É—à–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–∏—Å—Ç–µ–º–Ω–æ–π —Ç–µ–º—ã
    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', function(e) {
        if (!localStorage.getItem('theme')) {
            const newTheme = e.matches ? 'dark' : 'light';
            document.documentElement.setAttribute('data-theme', newTheme);
            updateThemeIcon(newTheme);
        }
    });
    
    console.log('‚úÖ Huntflow: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—è —Ç–µ–º—ã –∑–∞–≤–µ—Ä—à–µ–Ω–∞');
    
    // –ì–ª–æ–±–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
    window.testThemeToggle = function() {
        console.log('üß™ Huntflow: –¢–µ—Å—Ç–∏—Ä—É–µ–º –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç–µ–º—ã...');
        toggleTheme();
    };
});
</script>
{% endblock %}
