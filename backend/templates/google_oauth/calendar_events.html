{% extends 'common/base.html' %}

{% block title %}–°–æ–±—ã—Ç–∏—è –∫–∞–ª–µ–Ω–¥–∞—Ä—è - Google OAuth - HR Helper{% endblock %}
{% block page_title %}<i class="fas fa-calendar me-2"></i>–°–æ–±—ã—Ç–∏—è –∫–∞–ª–µ–Ω–¥–∞—Ä—è{% endblock %}


{% block content %}
{% load static %}
<link href="{% static 'css/google-oauth.css' %}" rel="stylesheet">

{% csrf_token %}
<div class="row">
    <div class="col-12">
        <!-- –ü–æ–∏—Å–∫ –∏ —Ñ–∏–ª—å—Ç—Ä—ã -->
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="fas fa-search me-2"></i>
                    –ü–æ–∏—Å–∫ –∏ —Ñ–∏–ª—å—Ç—Ä—ã
                </h5>
            </div>
            <div class="card-body p-4">
                <form method="get" class="row g-4 align-items-end">
                    <div class="col-md-4">
                        <label for="{{ search_form.search.id_for_label }}" class="form-label mb-2">
                            <i class="fas fa-search me-1"></i>{{ search_form.search.label }}
                        </label>
                        {{ search_form.search }}
                    </div>
                    <div class="col-md-4">
                        <label for="{{ search_form.date_from.id_for_label }}" class="form-label mb-2">
                            <i class="fas fa-calendar me-1"></i>–ü–µ—Ä–∏–æ–¥
                        </label>
                        <div class="input-group">
                            {{ search_form.date_from }}
                            <span class="input-group-text">‚Äî</span>
                            {{ search_form.date_to }}
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="d-flex gap-2 flex-wrap justify-content-md-end">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-search me-1"></i>
                                –ü–æ–∏—Å–∫
                            </button>
                            <a href="{% url 'google_oauth:calendar_events' %}" class="btn btn-outline-secondary">
                                <i class="fas fa-times me-1"></i>
                                –°–±—Ä–æ—Å–∏—Ç—å
                            </a>
                            <button type="button" class="btn btn-success" onclick="syncCalendar()" title="–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å">
                                <i class="fas fa-sync"></i>
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
        
        <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ -->
        <div class="alert alert-info mb-3">
            <i class="fas fa-info-circle me-2"></i>
            <strong>–ü–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –±–ª–∏–∂–∞–π—à–∏–µ —Å–æ–±—ã—Ç–∏—è:</strong> —Å —Å–µ–≥–æ–¥–Ω—è –∏ –Ω–∞ 100 –¥–Ω–µ–π –≤–ø–µ—Ä–µ–¥
        </div>
        
        <!-- –¢–∞–±—ã –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è -->
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <ul class="nav nav-tabs card-header-tabs" id="calendarTabs" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="list-tab" data-bs-toggle="tab" data-bs-target="#list" type="button" role="tab" aria-controls="list" aria-selected="true">
                            <i class="fas fa-list me-2"></i>
                            –°–ø–∏—Å–æ–∫ —Å–æ–±—ã—Ç–∏–π
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="calendar-tab" data-bs-toggle="tab" data-bs-target="#calendar" type="button" role="tab" aria-controls="calendar" aria-selected="false">
                            <i class="fas fa-calendar me-2"></i>
                            –ö–∞–ª–µ–Ω–¥–∞—Ä—å
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="slots-tab" data-bs-toggle="tab" data-bs-target="#slots" type="button" role="tab" aria-controls="slots" aria-selected="false">
                            <i class="fas fa-clock me-2"></i>
                            –°–ª–æ—Ç—ã
                        </button>
                    </li>
                </ul>
                <!-- –ö–Ω–æ–ø–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –¥–ª—è —Å–ª–æ—Ç–æ–≤ -->
                <button type="button" class="btn btn-outline-secondary btn-sm" id="slotsSettingsBtn" data-bs-toggle="modal" data-bs-target="#slotsSettingsModal" title="–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–ª–æ—Ç–æ–≤" style="display: none;">
                    <i class="fas fa-cog"></i>
                </button>
            </div>
            <div class="card-body m-3">
                <div class="tab-content" id="calendarTabsContent">
                    <!-- –¢–∞–±: –°–ø–∏—Å–æ–∫ —Å–æ–±—ã—Ç–∏–π -->
                    <div class="tab-pane fade show active" id="list" role="tabpanel" aria-labelledby="list-tab">
                {% if page_obj %}
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th style="width: 25%;">–ù–∞–∑–≤–∞–Ω–∏–µ –≤—Å—Ç—Ä–µ—á–∏</th>
                                    <th style="width: 20%;">–î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è</th>
                                    <th style="width: 15%;">Google Meet</th>
                                    <th style="width: 35%;">–û–ø–∏—Å–∞–Ω–∏–µ</th>
                                    <th style="width: 5%;">–°—Å—ã–ª–∫–∞</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for event in page_obj %}
                                    <tr>
                                        <td>
                                            <div class="d-flex align-items-center">
                                                <div class="me-2">
                                                    {% if event.status == 'confirmed' %}
                                                        <i class="fas fa-check-circle text-success" title="–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ"></i>
                                                    {% elif event.status == 'tentative' %}
                                                        <i class="fas fa-question-circle text-warning" title="–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ"></i>
                                                    {% elif event.status == 'cancelled' %}
                                                        <i class="fas fa-times-circle text-danger" title="–û—Ç–º–µ–Ω–µ–Ω–æ"></i>
                                                    {% else %}
                                                        <i class="fas fa-circle text-secondary" title="{{ event.status }}"></i>
                                                    {% endif %}
                                                </div>
                                                <strong>{{ event.title }}</strong>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="small">
                                                {% if event.is_all_day %}
                                                    {{ event.start_datetime|date:"d.m.Y" }} <span class="badge bg-info">–í–µ—Å—å –¥–µ–Ω—å</span>
                                                {% else %}
                                                    {{ event.start_datetime|date:"d.m.Y" }} {{ event.start_datetime|date:"H:i" }} - {{ event.end_datetime|date:"H:i" }}
                                                {% endif %}
                                            </div>
                                        </td>
                                        <td>
                                            {% if event.meet_link %}
                                                <a href="{{ event.meet_link }}" target="_blank" class="btn btn-sm btn-outline-success">
                                                    <i class="fab fa-google-meet me-1"></i>
                                                    Google Meet
                                                    {% if event.attendees %}
                                                        <span class="badge bg-light text-dark ms-1">{{ event.attendees|length }}</span>
                                                    {% endif %}
                                                </a>
                                            {% else %}
                                                <span class="text-muted">-</span>
                                            {% endif %}
                                        </td>
                                        <td>
                                            {% if event.description %}
                                                <div class="small text-muted" style="max-width: 300px;">
                                                    {{ event.description|safe }}
                                                </div>
                                            {% else %}
                                                <span class="text-muted">-</span>
                                            {% endif %}
                                        </td>
                                        <td>
                                            {% if event.html_link %}
                                                <a href="{{ event.html_link }}" target="_blank" class="btn btn-sm btn-outline-primary" title="–û—Ç–∫—Ä—ã—Ç—å –≤ Google Calendar">
                                                    <i class="fab fa-google"></i>
                                                </a>
                                            {% else %}
                                                <span class="text-muted">-</span>
                                            {% endif %}
                                        </td>
                                    </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è -->
                    {% if page_obj.has_other_pages %}
                        <nav aria-label="–ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º">
                            <ul class="pagination justify-content-center">
                                {% if page_obj.has_previous %}
                                    <li class="page-item">
                                        <a class="page-link" href="?page=1{% if search_query %}&search={{ search_query }}{% endif %}{% if date_from %}&date_from={{ date_from }}{% endif %}{% if date_to %}&date_to={{ date_to }}{% endif %}{% if status_filter %}&status={{ status_filter }}{% endif %}{% if calendar_id_filter %}&calendar_id={{ calendar_id_filter }}{% endif %}">
                                            <i class="fas fa-angle-double-left"></i>
                                        </a>
                                    </li>
                                    <li class="page-item">
                                        <a class="page-link" href="?page={{ page_obj.previous_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}{% if date_from %}&date_from={{ date_from }}{% endif %}{% if date_to %}&date_to={{ date_to }}{% endif %}{% if status_filter %}&status={{ status_filter }}{% endif %}{% if calendar_id_filter %}&calendar_id={{ calendar_id_filter }}{% endif %}">
                                            <i class="fas fa-angle-left"></i>
                                        </a>
                                    </li>
                                {% endif %}
                                
                                {% for num in page_obj.paginator.page_range %}
                                    {% if page_obj.number == num %}
                                        <li class="page-item active">
                                            <span class="page-link">{{ num }}</span>
                                        </li>
                                    {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
                                        <li class="page-item">
                                            <a class="page-link" href="?page={{ num }}{% if search_query %}&search={{ search_query }}{% endif %}{% if date_from %}&date_from={{ date_from }}{% endif %}{% if date_to %}&date_to={{ date_to }}{% endif %}{% if status_filter %}&status={{ status_filter }}{% endif %}{% if calendar_id_filter %}&calendar_id={{ calendar_id_filter }}{% endif %}">{{ num }}</a>
                                        </li>
                                    {% endif %}
                                {% endfor %}
                                
                                {% if page_obj.has_next %}
                                    <li class="page-item">
                                        <a class="page-link" href="?page={{ page_obj.next_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}{% if date_from %}&date_from={{ date_from }}{% endif %}{% if date_to %}&date_to={{ date_to }}{% endif %}{% if status_filter %}&status={{ status_filter }}{% endif %}{% if calendar_id_filter %}&calendar_id={{ calendar_id_filter }}{% endif %}">
                                            <i class="fas fa-angle-right"></i>
                                        </a>
                                    </li>
                                    <li class="page-item">
                                        <a class="page-link" href="?page={{ page_obj.paginator.num_pages }}{% if search_query %}&search={{ search_query }}{% endif %}{% if date_from %}&date_from={{ date_from }}{% endif %}{% if date_to %}&date_to={{ date_to }}{% endif %}{% if status_filter %}&status={{ status_filter }}{% endif %}{% if calendar_id_filter %}&calendar_id={{ calendar_id_filter }}{% endif %}">
                                            <i class="fas fa-angle-double-right"></i>
                                        </a>
                                    </li>
                                {% endif %}
                            </ul>
                        </nav>
                    {% endif %}
                {% else %}
                    <div class="text-center py-5">
                        <i class="fas fa-calendar-alt fa-3x text-muted mb-3"></i>
                        <h5 class="text-muted">–°–æ–±—ã—Ç–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h5>
                        <p class="text-muted">
                            {% if search_query or date_from or date_to or status_filter or calendar_id_filter %}
                                –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–∏—Å–∫–∞ –∏–ª–∏ <a href="{% url 'google_oauth:calendar_events' %}">—Å–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã</a>.
                            {% else %}
                                –°–æ–±—ã—Ç–∏—è –∫–∞–ª–µ–Ω–¥–∞—Ä—è –Ω–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã. <a href="#" onclick="syncCalendar()">–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é</a>.
                            {% endif %}
                        </p>
                    </div>
                {% endif %}
                    </div>
                    
                    <!-- –¢–∞–±: –ö–∞–ª–µ–Ω–¥–∞—Ä—å -->
                    <div class="tab-pane fade" id="calendar" role="tabpanel" aria-labelledby="calendar-tab">
                        <div id="calendar-widget">
                            <!-- –ö–∞–ª–µ–Ω–¥–∞—Ä—å –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω —á–µ—Ä–µ–∑ JavaScript -->
                        </div>
                    </div>
                    
                    <!-- –¢–∞–±: –°–ª–æ—Ç—ã -->
                    <div class="tab-pane fade" id="slots" role="tabpanel" aria-labelledby="slots-tab">
                        <div class="slots-container">
                            <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å –∫–Ω–æ–ø–∫–æ–π —ç–∫—Å–ø–æ—Ä—Ç–∞ -->
                            <div class="d-flex justify-content-between align-items-center mb-4">
                                <h4 class="mb-0">
                                    <i class="fas fa-clock me-2 text-success"></i>
                                    –°–≤–æ–±–æ–¥–Ω—ã–µ —Å–ª–æ—Ç—ã
                                </h4>
                                <div class="d-flex gap-2">
                                    <button type="button" class="btn btn-outline-success btn-sm" title="–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ —Å–ª–æ—Ç—ã" onclick="copyAllSlots()">
                                        <i class="fas fa-copy"></i>
                                    </button>
                                </div>
                            </div>
                            
                            <!-- –¢–µ–∫—É—â–∞—è –Ω–µ–¥–µ–ª—è -->
                            <div class="week-section current-week mb-5">
                                <div class="d-flex justify-content-between align-items-center week-header mb-4">
                                    <h5 class="mb-0">
                                        <i class="fas fa-calendar-week me-2 text-success"></i>
                                        –¢–µ–∫—É—â–∞—è –Ω–µ–¥–µ–ª—è
                                    </h5>
                                    <button type="button" class="btn btn-outline-success btn-sm" title="–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –Ω–µ–¥–µ–ª—é" onclick="copyWeekSlots('current')">
                                        <i class="fas fa-copy"></i>
                                    </button>
                                </div>
                                
                                <div class="row g-3">
                                    <!-- –°–ª–æ—Ç—ã —Ç–µ–∫—É—â–µ–π –Ω–µ–¥–µ–ª–∏ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
                                </div>
                            </div>
                            
                            <!-- –°–ª–µ–¥—É—é—â–∞—è –Ω–µ–¥–µ–ª—è -->
                            <div class="week-section next-week">
                                <div class="d-flex justify-content-between align-items-center week-header mb-4">
                                    <h5 class="mb-0">
                                        <i class="fas fa-calendar-week me-2 text-primary"></i>
                                        –°–ª–µ–¥—É—é—â–∞—è –Ω–µ–¥–µ–ª—è
                                    </h5>
                                    <button type="button" class="btn btn-primary btn-sm" title="–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –Ω–µ–¥–µ–ª—é" onclick="copyWeekSlots('next')">
                                        <i class="fas fa-copy"></i>
                                    </button>
                                </div>
                                
                                <div class="row g-3">
                                    <!-- –°–ª–æ—Ç—ã —Å–ª–µ–¥—É—é—â–µ–π –Ω–µ–¥–µ–ª–∏ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
                                                </div>
                                                    </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
    </div>
</div>

<script>
// –î–∞–Ω–Ω—ã–µ —Å–æ–±—ã—Ç–∏–π –∏–∑ Django –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
const calendarEvents = [
    {% for event in page_obj %}
    {
        id: "{{ event.id|escapejs }}",
        title: "{{ event.title|escapejs }}",
        start: "{{ event.start_datetime|date:'Y-m-d H:i:s' }}",
        end: "{{ event.end_datetime|date:'Y-m-d H:i:s' }}",
        location: "{{ event.location|default:''|escapejs }}",
        description: "{{ event.description|default:''|escapejs }}",
        html_link: "{{ event.html_link|default:''|escapejs }}",
        status: "{{ event.status|default:'confirmed'|escapejs }}",
        is_all_day: {{ event.is_all_day|yesno:"true,false" }},
        color: "{% if '–û–±–µ–¥' in event.title %}grey{% elif 'JS Tech Screening' in event.title and forloop.counter0 == 3 %}orange{% else %}blue{% endif %}"
    }{% if not forloop.last %},{% endif %}
    {% endfor %}
];

// –î–∞–Ω–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤ –∏–∑ Django –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
const filterData = {
    dateFrom: "{{ search_form.date_from.value|default:'' }}",
    dateTo: "{{ search_form.date_to.value|default:'' }}",
    search: "{{ search_form.search.value|default:'' }}"
};

// –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è —Ä–∞–±–æ—á–∏—Ö —á–∞—Å–æ–≤
window.userWorkHours = {
    startHour: {{ user.interview_start_time.hour|default:11 }},
    endHour: {{ user.interview_end_time.hour|default:18 }}
};

function syncCalendar() {
    if (confirm('–ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é –∫–∞–ª–µ–Ω–¥–∞—Ä—è? –≠—Ç–æ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –Ω–µ–∫–æ—Ç–æ—Ä–æ–µ –≤—Ä–µ–º—è.')) {
        const button = event.target;
        const originalText = button.innerHTML;
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
        button.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è...';
        button.disabled = true;
        
        const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]');
        if (!csrfToken) {
            alert('–û—à–∏–±–∫–∞: CSRF —Ç–æ–∫–µ–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω');
            button.innerHTML = originalText;
            button.disabled = false;
            return;
        }
        
        // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º AJAX –∑–∞–ø—Ä–æ—Å
        fetch('{% url "google_oauth:sync_calendar" %}', {
            method: 'POST',
            headers: {
                'X-CSRFToken': csrfToken.value,
                'Content-Type': 'application/json',
            },
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert('–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ!');
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –≤–∫–ª–∞–¥–∫—É –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–æ–π
                const activeTab = document.querySelector('#calendarTabs .nav-link.active');
                if (activeTab) {
                    localStorage.setItem('activeCalendarTab', activeTab.id);
                }
                location.reload();
            } else {
                alert('–û—à–∏–±–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏: ' + data.message);
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏');
        })
        .finally(() => {
            // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–Ω–æ–ø–∫—É
            button.innerHTML = originalText;
            button.disabled = false;
        });
    }
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞–ª–µ–Ω–¥–∞—Ä—è (–≤–µ—Ä—Å–∏—è 4.0 - —Å API endpoint)
document.addEventListener('DOMContentLoaded', function() {
    const calendarTab = document.getElementById('calendar-tab');
    const calendarWidget = document.getElementById('calendar-widget');
    const slotsTab = document.getElementById('slots-tab');
    
    // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –≤–∫–ª–∞–¥–∫—É –∏–∑ localStorage
    restoreActiveTab();
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω—É–∂–Ω–æ –ª–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∫–∞–ª–µ–Ω–¥–∞—Ä—å –¥–ª—è –∞–∫—Ç–∏–≤–Ω–æ–π –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤–∫–ª–∞–¥–∫–∏
    setTimeout(() => {
        const activeTab = document.querySelector('#calendarTabs .nav-link.active');
        if (activeTab && activeTab.id === 'calendar-tab') {
            if (!calendarWidget.querySelector('.calendar-initialized')) {
                console.log('üéØ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∫–∞–ª–µ–Ω–¥–∞—Ä—å –¥–ª—è –∞–∫—Ç–∏–≤–Ω–æ–π –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤–∫–ª–∞–¥–∫–∏');
                initializeCalendar();
            }
        }
    }, 200);
    
    // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤–∫–ª–∞–¥–æ–∫
    document.querySelectorAll('#calendarTabs .nav-link').forEach(tab => {
        tab.addEventListener('shown.bs.tab', function() {
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –≤–∫–ª–∞–¥–∫—É –≤ localStorage
            localStorage.setItem('activeCalendarTab', this.id);
            console.log('üíæ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –∞–∫—Ç–∏–≤–Ω–∞—è –≤–∫–ª–∞–¥–∫–∞:', this.id);
        });
    });
    
    calendarTab.addEventListener('shown.bs.tab', function() {
        if (!calendarWidget.querySelector('.calendar-initialized')) {
            initializeCalendar();
        }
    });
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–ª–æ—Ç–æ–≤
    slotsTab.addEventListener('shown.bs.tab', function() {
        if (!document.querySelector('.slots-initialized')) {
            initializeSlots();
        }
    });
    
    function restoreActiveTab() {
        // –ü–æ–ª—É—á–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—É—é –∞–∫—Ç–∏–≤–Ω—É—é –≤–∫–ª–∞–¥–∫—É –∏–∑ localStorage
        const savedTabId = localStorage.getItem('activeCalendarTab');
        
        if (savedTabId) {
            const savedTab = document.getElementById(savedTabId);
            if (savedTab) {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –≤–∫–ª–∞–¥–∫–∞ –Ω–µ –∞–∫—Ç–∏–≤–Ω–∞ —É–∂–µ
                if (!savedTab.classList.contains('active')) {
                    // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—É—é –≤–∫–ª–∞–¥–∫—É
                    const tab = new bootstrap.Tab(savedTab);
                    tab.show();
                    
                    console.log('‚úÖ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –∞–∫—Ç–∏–≤–Ω–∞—è –≤–∫–ª–∞–¥–∫–∞:', savedTabId);
                    
                    // –ï—Å–ª–∏ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –≤–∫–ª–∞–¥–∫–∞ –∫–∞–ª–µ–Ω–¥–∞—Ä—è, –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∫–∞–ª–µ–Ω–¥–∞—Ä—å
                    if (savedTabId === 'calendar-tab') {
                        setTimeout(() => {
                            if (!calendarWidget.querySelector('.calendar-initialized')) {
                                console.log('üéØ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∫–∞–ª–µ–Ω–¥–∞—Ä—å –ø–æ—Å–ª–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –≤–∫–ª–∞–¥–∫–∏');
                                initializeCalendar();
                            }
                        }, 100); // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∞–Ω–∏–º–∞—Ü–∏–∏ —Ç–∞–±–∞
                    }
                    
                    // –ï—Å–ª–∏ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –≤–∫–ª–∞–¥–∫–∞ —Å–ª–æ—Ç–æ–≤, –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Å–ª–æ—Ç—ã
                    if (savedTabId === 'slots-tab') {
                        setTimeout(() => {
                            if (!document.querySelector('.slots-initialized')) {
                                console.log('üéØ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Å–ª–æ—Ç—ã –ø–æ—Å–ª–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –≤–∫–ª–∞–¥–∫–∏');
                                initializeSlots();
                            }
                        }, 100);
                    }
                } else {
                    console.log('‚ÑπÔ∏è –í–∫–ª–∞–¥–∫–∞ —É–∂–µ –∞–∫—Ç–∏–≤–Ω–∞:', savedTabId);
                }
            } else {
                console.log('‚ö†Ô∏è –í–∫–ª–∞–¥–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞:', savedTabId);
                // –û—á–∏—â–∞–µ–º –Ω–µ–≤–µ—Ä–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
                localStorage.removeItem('activeCalendarTab');
            }
        } else {
            console.log('‚ÑπÔ∏è –ù–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–π –∞–∫—Ç–∏–≤–Ω–æ–π –≤–∫–ª–∞–¥–∫–∏');
        }
    }
    
    function initializeSlots() {
        console.log('üéØ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–ª–æ—Ç–æ–≤...');
        console.log('üìä –î–æ—Å—Ç—É–ø–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∫–∞–ª–µ–Ω–¥–∞—Ä—è:', typeof calendarEvents, calendarEvents ? calendarEvents.length : '–Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ');
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
        const currentWeekSection = document.querySelector('.week-section.current-week');
        const nextWeekSection = document.querySelector('.week-section.next-week');
        console.log('üìÖ –°–µ–∫—Ü–∏—è —Ç–µ–∫—É—â–µ–π –Ω–µ–¥–µ–ª–∏:', currentWeekSection);
        console.log('üìÖ –°–µ–∫—Ü–∏—è —Å–ª–µ–¥—É—é—â–µ–π –Ω–µ–¥–µ–ª–∏:', nextWeekSection);
        
        // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–ª–æ—Ç—ã –¥–ª—è –≤—Å–µ—Ö –¥–∞—Ç –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤
        const allSlots = generateSlotsForDateRange();
        
        console.log('üìÖ –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–ª–æ—Ç—ã –¥–ª—è –¥–∏–∞–ø–∞–∑–æ–Ω–∞:', allSlots);
        
        // –û–±–Ω–æ–≤–ª—è–µ–º DOM —Å –¥–∞–Ω–Ω—ã–º–∏ —Å–ª–æ—Ç–æ–≤
        updateSlotsDisplay(allSlots);
        
        // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –∫–Ω–æ–ø–æ–∫
        addSlotsEventHandlers();
        
        // –ü–æ–º–µ—á–∞–µ–º –∫–∞–∫ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ
        const slotsContainer = document.querySelector('.slots-container');
        if (slotsContainer) {
            slotsContainer.classList.add('slots-initialized');
        } else {
            console.error('‚ùå –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å–ª–æ—Ç–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω!');
        }
        
        console.log('‚úÖ –°–ª–æ—Ç—ã –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã');
    }
    
    function calculateAvailableSlots(dayEvents, date) {
        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ä–∞–±–æ—á–∏–µ —á–∞—Å—ã –∏–∑ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        const workStartHour = window.userWorkHours ? window.userWorkHours.startHour : 11;
        const workEndHour = window.userWorkHours ? window.userWorkHours.endHour : 18;
        
        // –°–æ–∑–¥–∞–µ–º –º–∞—Å—Å–∏–≤ —Å–ª–æ—Ç–æ–≤ –ø–æ —á–∞—Å–∞–º
        const slots = [];
        for (let hour = workStartHour; hour < workEndHour; hour++) {
            slots.push({
                hour: hour,
                start: new Date(date.getFullYear(), date.getMonth(), date.getDate(), hour, 0, 0),
                end: new Date(date.getFullYear(), date.getMonth(), date.getDate(), hour + 1, 0, 0),
                isOccupied: false
            });
        }
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞–∂–¥–æ–µ —Å–æ–±—ã—Ç–∏–µ –¥–Ω—è –∏ –æ—Ç–º–µ—á–∞–µ–º –∑–∞–Ω—è—Ç—ã–µ —Å–ª–æ—Ç—ã
        dayEvents.forEach(event => {
            // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Å–æ–±—ã—Ç–∏—è –Ω–∞ –≤–µ—Å—å –¥–µ–Ω—å
            if (event.is_all_day) {
                return;
            }
            
            const eventStart = new Date(event.start);
            const eventEnd = new Date(event.end);
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –ø–µ—Ä–µ—Å–µ–∫–∞–µ—Ç—Å—è –ª–∏ —Å–æ–±—ã—Ç–∏–µ —Å —Ä–∞–±–æ—á–∏–º–∏ —á–∞—Å–∞–º–∏
            if (eventStart.getHours() < workEndHour && eventEnd.getHours() >= workStartHour) {
                // –û—Ç–º–µ—á–∞–µ–º –∑–∞–Ω—è—Ç—ã–µ —Å–ª–æ—Ç—ã
                slots.forEach(slot => {
                    // –ï—Å–ª–∏ —Å–æ–±—ã—Ç–∏–µ –∑–∞–Ω–∏–º–∞–µ—Ç —Ö–æ—Ç—è –±—ã –ø–æ–ª—á–∞—Å–∞ –≤ —Å–ª–æ—Ç–µ, —Å—á–∏—Ç–∞–µ–º —Å–ª–æ—Ç –∑–∞–Ω—è—Ç—ã–º
                    const slotStart = slot.start.getTime();
                    const slotEnd = slot.end.getTime();
                    const eventStartTime = eventStart.getTime();
                    const eventEndTime = eventEnd.getTime();
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–µ (—Å–æ–±—ã—Ç–∏–µ –∑–∞–Ω–∏–º–∞–µ—Ç –º–∏–Ω–∏–º—É–º 30 –º–∏–Ω—É—Ç –≤ —Å–ª–æ—Ç–µ)
                    const overlapStart = Math.max(slotStart, eventStartTime);
                    const overlapEnd = Math.min(slotEnd, eventEndTime);
                    const overlapDuration = overlapEnd - overlapStart;
                    
                    if (overlapDuration >= 30 * 60 * 1000) { // 30 –º–∏–Ω—É—Ç –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö
                        slot.isOccupied = true;
                    }
                });
            }
        });
        
        // –§–æ—Ä–º–∏—Ä—É–µ–º —Å—Ç—Ä–æ–∫—É –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Å–ª–æ—Ç–æ–≤
        const availableRanges = [];
        let currentRangeStart = null;
        
        slots.forEach((slot, index) => {
            if (!slot.isOccupied) {
                if (currentRangeStart === null) {
                    currentRangeStart = slot.hour;
                }
            } else {
                if (currentRangeStart !== null) {
                    // –ó–∞–≤–µ—Ä—à–∞–µ–º —Ç–µ–∫—É—â–∏–π –¥–∏–∞–ø–∞–∑–æ–Ω
                    if (currentRangeStart === slot.hour - 1) {
                        availableRanges.push(currentRangeStart.toString());
                    } else {
                        // –î–æ–±–∞–≤–ª—è–µ–º +1 –∫ –ø–æ—Å–ª–µ–¥–Ω–µ–º—É —á–∞—Å—É –¥–∏–∞–ø–∞–∑–æ–Ω–∞, —Ç–∞–∫ –∫–∞–∫ —Å–ª–æ—Ç –æ–∑–Ω–∞—á–∞–µ—Ç –≤—Ä–µ–º—è –¥–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ —á–∞—Å–∞
                        availableRanges.push(`${currentRangeStart}-${slot.hour}`);
                    }
                    currentRangeStart = null;
                }
            }
        });
        
        // –ó–∞–≤–µ—Ä—à–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–π –¥–∏–∞–ø–∞–∑–æ–Ω, –µ—Å–ª–∏ –æ–Ω –µ—Å—Ç—å
        if (currentRangeStart !== null) {
            const lastSlot = slots[slots.length - 1];
            if (currentRangeStart === lastSlot.hour) {
                availableRanges.push(currentRangeStart.toString());
            } else {
                // –î–æ–±–∞–≤–ª—è–µ–º +1 –∫ –ø–æ—Å–ª–µ–¥–Ω–µ–º—É —á–∞—Å—É, —Ç–∞–∫ –∫–∞–∫ —Å–ª–æ—Ç 17 –æ–∑–Ω–∞—á–∞–µ—Ç –≤—Ä–µ–º—è 17:00-18:00
                availableRanges.push(`${currentRangeStart}-${lastSlot.hour + 1}`);
            }
        }
        
        return availableRanges.length > 0 ? availableRanges.join(', ') : '–ù–µ—Ç —Å–≤–æ–±–æ–¥–Ω—ã—Ö —Å–ª–æ—Ç–æ–≤';
    }
    
    function generateSlotsForDateRange() {
        console.log('üìÖ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–ª–æ—Ç–æ–≤ –¥–ª—è –¥–∏–∞–ø–∞–∑–æ–Ω–∞ –¥–∞—Ç...');
        
        // –ü–∞—Ä—Å–∏–º —Ñ–∏–ª—å—Ç—Ä—ã –ø–æ –¥–∞—Ç–∞–º
        let filterDateFrom = null;
        let filterDateTo = null;
        
        if (filterData.dateFrom) {
            filterDateFrom = new Date(filterData.dateFrom);
            filterDateFrom.setHours(0, 0, 0, 0);
        }
        
        if (filterData.dateTo) {
            filterDateTo = new Date(filterData.dateTo);
            filterDateTo.setHours(23, 59, 59, 999);
        }
        
        // –ï—Å–ª–∏ —Ñ–∏–ª—å—Ç—Ä—ã –Ω–µ –∑–∞–¥–∞–Ω—ã, –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–µ–∫—É—â—É—é –∏ —Å–ª–µ–¥—É—é—â—É—é –Ω–µ–¥–µ–ª—é
        if (!filterDateFrom && !filterDateTo) {
            const currentWeekSlots = generateWeekSlots(0);
            const nextWeekSlots = generateWeekSlots(1);
            return {
                currentWeek: currentWeekSlots,
                nextWeek: nextWeekSlots
            };
        }
        
        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –¥–∏–∞–ø–∞–∑–æ–Ω –¥–∞—Ç
        const today = new Date();
        today.setHours(0, 0, 0, 0);
        
        const startDate = filterDateFrom || today;
        const endDate = filterDateTo || new Date(today.getTime() + 14 * 24 * 60 * 60 * 1000); // +14 –¥–Ω–µ–π –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        
        console.log(`üìÖ –î–∏–∞–ø–∞–∑–æ–Ω –¥–∞—Ç: ${startDate.toDateString()} - ${endDate.toDateString()}`);
        
        const allSlots = [];
        const weekdays = ['–í–°', '–ü–ù', '–í–¢', '–°–†', '–ß–¢', '–ü–¢', '–°–ë'];
        
        // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–ª–æ—Ç—ã –¥–ª—è –≤—Å–µ—Ö –¥–∞—Ç –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ
        const currentDate = new Date(startDate);
        while (currentDate <= endDate) {
            // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –≤—ã—Ö–æ–¥–Ω—ã–µ (—Å—É–±–±–æ—Ç–∞ –∏ –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ)
            if (currentDate.getDay() !== 0 && currentDate.getDay() !== 6) {
                // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –ø—Ä–æ—à–µ–¥—à–∏–µ –¥–Ω–∏
                if (currentDate >= today) {
                    const dateStr = currentDate.toLocaleDateString('ru-RU', { day: '2-digit', month: '2-digit' });
                    const weekday = weekdays[currentDate.getDay()];
                    
                    // –ü–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ–º —Ä–µ–∞–ª—å–Ω—ã–µ –≤—Å—Ç—Ä–µ—á–∏ –∏–∑ –¥–∞–Ω–Ω—ã—Ö –∫–∞–ª–µ–Ω–¥–∞—Ä—è (–∏—Å–∫–ª—é—á–∞—è "–û–±–µ–¥")
                    let meetingsCount = 0;
                    let availableSlots = '';
                    
                    if (typeof calendarEvents !== 'undefined' && Array.isArray(calendarEvents)) {
                        const dayEvents = calendarEvents.filter(event => {
                            const eventDate = new Date(event.start);
                            return eventDate.toDateString() === currentDate.toDateString();
                        });
                        
                        // –ò—Å–∫–ª—é—á–∞–µ–º –≤—Å—Ç—Ä–µ—á–∏ —Å –Ω–∞–∑–≤–∞–Ω–∏–µ–º "–û–±–µ–¥" –¥–ª—è –ø–æ–¥—Å—á–µ—Ç–∞ –≤—Å—Ç—Ä–µ—á
                        const meetingsWithoutLunch = dayEvents.filter(event => {
                            const title = event.title.toLowerCase();
                            const isLunch = title.includes('–æ–±–µ–¥') || title.includes('lunch');
                            return !isLunch;
                        });
                        
                        meetingsCount = meetingsWithoutLunch.length;
                        
                        // –í—ã—á–∏—Å–ª—è–µ–º –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Å–ª–æ—Ç—ã –≤—Ä–µ–º–µ–Ω–∏ (11-18, –∏—Å–∫–ª—é—á–∞—è –æ–±–µ–¥)
                        availableSlots = calculateAvailableSlots(dayEvents, currentDate);
                        
                        console.log(`üìÖ –î–∞—Ç–∞ ${dateStr}: ${meetingsWithoutLunch.length} –≤—Å—Ç—Ä–µ—á (–∏—Å–∫–ª—é—á–∞—è –æ–±–µ–¥ –∏–∑ ${dayEvents.length} –æ–±—â–∏—Ö), —Å–ª–æ—Ç—ã: ${availableSlots}`);
                    } else {
                        availableSlots = '11-18';
                    }
                    
                    allSlots.push({
                        date: new Date(currentDate),
                        dateStr: dateStr,
                        weekday: weekday,
                        meetingsCount: meetingsCount,
                        availableSlots: availableSlots
                    });
                }
            }
            
            currentDate.setDate(currentDate.getDate() + 1);
        }
        
        console.log(`üìÖ –ò—Ç–æ–≥–æ —Å–ª–æ—Ç–æ–≤ –¥–ª—è –¥–∏–∞–ø–∞–∑–æ–Ω–∞: ${allSlots.length}`);
        return allSlots;
    }
    
    function generateWeekSlots(weekOffset) {
        const today = new Date();
        const startOfWeek = new Date(today);
        
        // –ù–∞—Ö–æ–¥–∏–º –Ω–∞—á–∞–ª–æ –Ω–µ–¥–µ–ª–∏ (–ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫)
        const dayOfWeek = today.getDay();
        const daysToMonday = dayOfWeek === 0 ? -6 : 1 - dayOfWeek;
        startOfWeek.setDate(today.getDate() + daysToMonday + (weekOffset * 7));
        
        console.log(`üìÖ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–ª–æ—Ç–æ–≤ –¥–ª—è –Ω–µ–¥–µ–ª–∏ ${weekOffset}, –Ω–∞—á–∞–ª–æ –Ω–µ–¥–µ–ª–∏:`, startOfWeek.toDateString());
        
        const slots = [];
        const weekdays = ['–ü–ù', '–í–¢', '–°–†', '–ß–¢', '–ü–¢', '–°–ë', '–í–°'];
        
        // –ü–∞—Ä—Å–∏–º —Ñ–∏–ª—å—Ç—Ä—ã –ø–æ –¥–∞—Ç–∞–º
        let filterDateFrom = null;
        let filterDateTo = null;
        
        if (filterData.dateFrom) {
            filterDateFrom = new Date(filterData.dateFrom);
            filterDateFrom.setHours(0, 0, 0, 0);
        }
        
        if (filterData.dateTo) {
            filterDateTo = new Date(filterData.dateTo);
            filterDateTo.setHours(23, 59, 59, 999);
        }
        
        // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–ª–æ—Ç—ã –¥–ª—è —Ä–∞–±–æ—á–∏—Ö –¥–Ω–µ–π (–ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫-–ø—è—Ç–Ω–∏—Ü–∞)
        for (let i = 0; i < 5; i++) {
            const date = new Date(startOfWeek);
            date.setDate(startOfWeek.getDate() + i);
            
            // –î–ª—è —Ç–µ–∫—É—â–µ–π –Ω–µ–¥–µ–ª–∏ (weekOffset === 0) –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –ø—Ä–æ—à–µ–¥—à–∏–µ –¥–Ω–∏ –∏ —Å–µ–≥–æ–¥–Ω—è
            if (weekOffset === 0) {
                const todayDate = new Date();
                todayDate.setHours(0, 0, 0, 0); // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—Ä–µ–º—è –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
                date.setHours(0, 0, 0, 0);
                
                if (date <= todayDate) {
                    console.log(`‚è≠Ô∏è –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –ø—Ä–æ—à–µ–¥—à–∏–π/—Ç–µ–∫—É—â–∏–π –¥–µ–Ω—å: ${date.toDateString()}`);
                    continue;
                }
            }
            
            // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ñ–∏–ª—å—Ç—Ä—ã –ø–æ –¥–∞—Ç–∞–º
            if (filterDateFrom && date < filterDateFrom) {
                console.log(`‚è≠Ô∏è –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –¥–µ–Ω—å –¥–æ —Ñ–∏–ª—å—Ç—Ä–∞ date_from: ${date.toDateString()}`);
                continue;
            }
            
            if (filterDateTo && date > filterDateTo) {
                console.log(`‚è≠Ô∏è –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –¥–µ–Ω—å –ø–æ—Å–ª–µ —Ñ–∏–ª—å—Ç—Ä–∞ date_to: ${date.toDateString()}`);
                continue;
            }
            
            const dateStr = date.toLocaleDateString('ru-RU', { day: '2-digit', month: '2-digit' });
            
            // –ü–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ–º —Ä–µ–∞–ª—å–Ω—ã–µ –≤—Å—Ç—Ä–µ—á–∏ –∏–∑ –¥–∞–Ω–Ω—ã—Ö –∫–∞–ª–µ–Ω–¥–∞—Ä—è (–∏—Å–∫–ª—é—á–∞—è "–û–±–µ–¥")
            let meetingsCount = 0;
            let availableSlots = '';
            
            if (typeof calendarEvents !== 'undefined' && Array.isArray(calendarEvents)) {
                console.log(`üîç –ü–æ–∏—Å–∫ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –¥–∞—Ç—ã ${dateStr} (${date.toDateString()})`);
                
                const dayEvents = calendarEvents.filter(event => {
                    const eventDate = new Date(event.start);
                    const isMatch = eventDate.toDateString() === date.toDateString();
                    if (isMatch) {
                        console.log(`  ‚úÖ –ù–∞–π–¥–µ–Ω–æ —Å–æ–±—ã—Ç–∏–µ: "${event.title}" –Ω–∞ ${eventDate.toDateString()}`);
                    }
                    return isMatch;
                });
                
                // –ò—Å–∫–ª—é—á–∞–µ–º –≤—Å—Ç—Ä–µ—á–∏ —Å –Ω–∞–∑–≤–∞–Ω–∏–µ–º "–û–±–µ–¥" –¥–ª—è –ø–æ–¥—Å—á–µ—Ç–∞ –≤—Å—Ç—Ä–µ—á
                const meetingsWithoutLunch = dayEvents.filter(event => {
                    const title = event.title.toLowerCase();
                    const isLunch = title.includes('–æ–±–µ–¥') || title.includes('lunch');
                    if (isLunch) {
                        console.log(`  üçΩÔ∏è –ò—Å–∫–ª—é—á–∞–µ–º –æ–±–µ–¥: "${event.title}"`);
                    }
                    return !isLunch;
                });
                
                meetingsCount = meetingsWithoutLunch.length;
                
                // –í—ã—á–∏—Å–ª—è–µ–º –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Å–ª–æ—Ç—ã –≤—Ä–µ–º–µ–Ω–∏ (11-18, –∏—Å–∫–ª—é—á–∞—è –æ–±–µ–¥)
                availableSlots = calculateAvailableSlots(dayEvents, date);
                
                console.log(`üìÖ –î–∞—Ç–∞ ${dateStr}: ${meetingsWithoutLunch.length} –≤—Å—Ç—Ä–µ—á (–∏—Å–∫–ª—é—á–∞—è –æ–±–µ–¥ –∏–∑ ${dayEvents.length} –æ–±—â–∏—Ö), —Å–ª–æ—Ç—ã: ${availableSlots}`);
            } else {
                console.log(`‚ö†Ô∏è calendarEvents –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è –¥–∞—Ç—ã ${dateStr}`);
                // –ï—Å–ª–∏ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ —Å–æ–±—ã—Ç–∏—è—Ö, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–µ —Å–ª–æ—Ç—ã –∫–∞–∫ –¥–æ—Å—Ç—É–ø–Ω—ã–µ
                const defaultStart = window.userWorkHours ? window.userWorkHours.startHour : 11;
                const defaultEnd = window.userWorkHours ? window.userWorkHours.endHour : 18;
                availableSlots = `${defaultStart}-${defaultEnd}`;
            }
            
            slots.push({
                date: date,
                dateStr: dateStr,
                weekday: weekdays[i],
                meetingsCount: meetingsCount,
                availableSlots: availableSlots
            });
        }
        
        console.log(`üìÖ –ò—Ç–æ–≥–æ —Å–ª–æ—Ç–æ–≤ –¥–ª—è –Ω–µ–¥–µ–ª–∏ ${weekOffset}: ${slots.length}`);
        return slots;
    }
    
    function updateSlotsDisplay(slotsData) {
        console.log('üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–ª–æ—Ç–æ–≤...');
        
        // –ï—Å–ª–∏ slotsData - —ç—Ç–æ –æ–±—ä–µ–∫—Ç —Å currentWeek –∏ nextWeek (—Å—Ç–∞—Ä—ã–π —Ñ–æ—Ä–º–∞—Ç)
        if (slotsData.currentWeek && slotsData.nextWeek) {
            updateSlotsDisplayOld(slotsData.currentWeek, slotsData.nextWeek);
            return;
        }
        
        // –ù–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç - –º–∞—Å—Å–∏–≤ –≤—Å–µ—Ö —Å–ª–æ—Ç–æ–≤
        const allSlots = slotsData;
        
        // –°–∫—Ä—ã–≤–∞–µ–º —Å–µ–∫—Ü–∏–∏ –Ω–µ–¥–µ–ª—å, –µ—Å–ª–∏ –µ—Å—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã
        const currentWeekSection = document.querySelector('.week-section.current-week');
        const nextWeekSection = document.querySelector('.week-section.next-week');
        
        if (filterData.dateFrom || filterData.dateTo) {
            // –ï—Å—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã - —Å–∫—Ä—ã–≤–∞–µ–º —Å–µ–∫—Ü–∏–∏ –Ω–µ–¥–µ–ª—å –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–ª–æ—Ç—ã
            if (currentWeekSection) {
                currentWeekSection.style.display = 'none';
            }
            if (nextWeekSection) {
                nextWeekSection.style.display = 'none';
            }
            
            // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é —Å–µ–∫—Ü–∏—é –¥–ª—è –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å–ª–æ—Ç–æ–≤
            createFilteredSlotsSection(allSlots);
        } else {
            // –ù–µ—Ç —Ñ–∏–ª—å—Ç—Ä–æ–≤ - –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å—Ç–∞—Ä—ã–π —Ñ–æ—Ä–º–∞—Ç
            if (currentWeekSection) {
                currentWeekSection.style.display = 'block';
            }
            if (nextWeekSection) {
                nextWeekSection.style.display = 'block';
            }
            
            // –†–∞–∑–¥–µ–ª—è–µ–º —Å–ª–æ—Ç—ã –Ω–∞ —Ç–µ–∫—É—â—É—é –∏ —Å–ª–µ–¥—É—é—â—É—é –Ω–µ–¥–µ–ª—é
            const today = new Date();
            const currentWeekSlots = allSlots.filter(slot => {
                const slotDate = new Date(slot.date);
                const weekStart = new Date(today);
                const dayOfWeek = today.getDay();
                const daysToMonday = dayOfWeek === 0 ? -6 : 1 - dayOfWeek;
                weekStart.setDate(today.getDate() + daysToMonday);
                weekStart.setHours(0, 0, 0, 0);
                
                const weekEnd = new Date(weekStart);
                weekEnd.setDate(weekStart.getDate() + 6);
                weekEnd.setHours(23, 59, 59, 999);
                
                return slotDate >= weekStart && slotDate <= weekEnd;
            });
            
            const nextWeekSlots = allSlots.filter(slot => {
                const slotDate = new Date(slot.date);
                const nextWeekStart = new Date(today);
                const dayOfWeek = today.getDay();
                const daysToMonday = dayOfWeek === 0 ? -6 : 1 - dayOfWeek;
                nextWeekStart.setDate(today.getDate() + daysToMonday + 7);
                nextWeekStart.setHours(0, 0, 0, 0);
                
                const nextWeekEnd = new Date(nextWeekStart);
                nextWeekEnd.setDate(nextWeekStart.getDate() + 6);
                nextWeekEnd.setHours(23, 59, 59, 999);
                
                return slotDate >= nextWeekStart && slotDate <= nextWeekEnd;
            });
            
            updateSlotsDisplayOld(currentWeekSlots, nextWeekSlots);
        }
    }
    
    function updateSlotsDisplayOld(currentWeek, nextWeek) {
        console.log('üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–ª–æ—Ç–æ–≤ (—Å—Ç–∞—Ä—ã–π —Ñ–æ—Ä–º–∞—Ç)...');
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—É—â—É—é –Ω–µ–¥–µ–ª—é
        const currentWeekContainer = document.querySelector('.week-section.current-week .row');
        console.log('üìÖ –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Ç–µ–∫—É—â–µ–π –Ω–µ–¥–µ–ª–∏:', currentWeekContainer);
        
        if (currentWeekContainer) {
            currentWeekContainer.innerHTML = '';
            console.log('üìÖ –î–æ–±–∞–≤–ª—è–µ–º —Å–ª–æ—Ç—ã —Ç–µ–∫—É—â–µ–π –Ω–µ–¥–µ–ª–∏:', currentWeek.length);
            currentWeek.forEach(slot => {
                const slotHtml = createSlotCard(slot);
                currentWeekContainer.insertAdjacentHTML('beforeend', slotHtml);
            });
            // –ü—Ä–∏–º–µ–Ω—è–µ–º –∞–¥–∞–ø—Ç–∏–≤–Ω—É—é —à–∏—Ä–∏–Ω—É –¥–ª—è —Ç–µ–∫—É—â–µ–π –Ω–µ–¥–µ–ª–∏
            applyAdaptiveWidth(currentWeekContainer, currentWeek.length);
        } else {
            console.error('‚ùå –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Ç–µ–∫—É—â–µ–π –Ω–µ–¥–µ–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω!');
        }
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ª–µ–¥—É—é—â—É—é –Ω–µ–¥–µ–ª—é
        const nextWeekContainer = document.querySelector('.week-section.next-week .row');
        console.log('üìÖ –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å–ª–µ–¥—É—é—â–µ–π –Ω–µ–¥–µ–ª–∏:', nextWeekContainer);
        
        if (nextWeekContainer) {
            nextWeekContainer.innerHTML = '';
            console.log('üìÖ –î–æ–±–∞–≤–ª—è–µ–º —Å–ª–æ—Ç—ã —Å–ª–µ–¥—É—é—â–µ–π –Ω–µ–¥–µ–ª–∏:', nextWeek.length);
            nextWeek.forEach(slot => {
                const slotHtml = createSlotCard(slot);
                nextWeekContainer.insertAdjacentHTML('beforeend', slotHtml);
            });
            // –ü—Ä–∏–º–µ–Ω—è–µ–º –∞–¥–∞–ø—Ç–∏–≤–Ω—É—é —à–∏—Ä–∏–Ω—É –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–π –Ω–µ–¥–µ–ª–∏
            applyAdaptiveWidth(nextWeekContainer, nextWeek.length);
        } else {
            console.error('‚ùå –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å–ª–µ–¥—É—é—â–µ–π –Ω–µ–¥–µ–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω!');
        }
    }
    
    function createFilteredSlotsSection(allSlots) {
        console.log('üîÑ –°–æ–∑–¥–∞–Ω–∏–µ —Å–µ–∫—Ü–∏–∏ –¥–ª—è –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å–ª–æ—Ç–æ–≤...');
        
        // –£–¥–∞–ª—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Å–µ–∫—Ü–∏—é —Ñ–∏–ª—å—Ç—Ä–æ–≤, –µ—Å–ª–∏ –µ—Å—Ç—å
        const existingFilteredSection = document.querySelector('.week-section.filtered-slots');
        if (existingFilteredSection) {
            existingFilteredSection.remove();
        }
        
        // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é —Å–µ–∫—Ü–∏—é
        const slotsContainer = document.querySelector('.slots-container');
        if (!slotsContainer) {
            console.error('‚ùå –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å–ª–æ—Ç–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω!');
            return;
        }
        
        const filteredSection = document.createElement('div');
        filteredSection.className = 'week-section filtered-slots';
        filteredSection.style.background = 'linear-gradient(135deg, #f8f9fa 0%, #e3f2fd 100%)';
        filteredSection.style.borderColor = '#007bff';
        filteredSection.style.borderWidth = '2px';
        
        const dateRangeText = filterData.dateFrom && filterData.dateTo 
            ? `${filterData.dateFrom} - ${filterData.dateTo}`
            : filterData.dateFrom 
                ? `—Å ${filterData.dateFrom}`
                : `–¥–æ ${filterData.dateTo}`;
        
        filteredSection.innerHTML = `
            <div class="d-flex justify-content-between align-items-center week-header mb-4">
                <h5 class="mb-0">
                    <i class="fas fa-calendar-week me-2 text-primary"></i>
                    –û—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–ª–æ—Ç—ã (${dateRangeText})
                </h5>
                <button type="button" class="btn btn-primary btn-sm" title="–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å–ª–æ—Ç—ã" onclick="copyFilteredSlots()">
                    <i class="fas fa-copy"></i>
                </button>
            </div>
            <div class="row g-3">
                <!-- –°–ª–æ—Ç—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
            </div>
        `;
        
        // –î–æ–±–∞–≤–ª—è–µ–º —Å–µ–∫—Ü–∏—é –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
        slotsContainer.appendChild(filteredSection);
        
        // –î–æ–±–∞–≤–ª—è–µ–º —Å–ª–æ—Ç—ã
        const slotsRow = filteredSection.querySelector('.row');
        allSlots.forEach(slot => {
            const slotHtml = createSlotCard(slot);
            slotsRow.insertAdjacentHTML('beforeend', slotHtml);
        });
        
        // –ü—Ä–∏–º–µ–Ω—è–µ–º –∞–¥–∞–ø—Ç–∏–≤–Ω—É—é —à–∏—Ä–∏–Ω—É
        applyAdaptiveWidth(slotsRow, allSlots.length);
        
        console.log(`‚úÖ –°–æ–∑–¥–∞–Ω–∞ —Å–µ–∫—Ü–∏—è —Å ${allSlots.length} —Å–ª–æ—Ç–∞–º–∏`);
    }
    
    function applyAdaptiveWidth(container, cardCount) {
        const cards = container.querySelectorAll('.col-md-4');
        
        if (cardCount <= 2) {
            // –ï—Å–ª–∏ –∫–∞—Ä—Ç–æ—á–µ–∫ 2 –∏ –º–µ–Ω–µ–µ - –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º —à–∏—Ä–∏–Ω—É –¥–æ 380px
            container.style.justifyContent = 'center';
            cards.forEach(card => {
                card.style.maxWidth = '380px';
                card.style.flex = '0 0 auto';
            });
        } else {
            // –ï—Å–ª–∏ –∫–∞—Ä—Ç–æ—á–µ–∫ –±–æ–ª—å—à–µ 2 - –Ω–∞ –≤—Å—é —à–∏—Ä–∏–Ω—É
            container.style.justifyContent = 'flex-start';
            cards.forEach(card => {
                card.style.maxWidth = 'none';
                card.style.flex = '1';
            });
        }
    }
    
    function createSlotCard(slot) {
        return `
            <div class="col-md-4">
                <div class="card slot-card">
                    <div class="card-body text-center">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <span class="fw-bold">${slot.dateStr}</span>
                            <span class="badge bg-secondary">${slot.weekday}</span>
                        </div>
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <div class="text-primary small">
                                ${slot.availableSlots}
                            </div>
                            <div>
                                <i class="fas fa-calendar-check text-success"></i>
                                <span class="ms-1 fw-bold text-success">${slot.meetingsCount}</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        `;
    }
    
    function addSlotsEventHandlers() {
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–∞—Ä—Ç–æ—á–µ–∫ —Å–ª–æ—Ç–æ–≤
        document.querySelectorAll('.slot-card').forEach(card => {
            card.addEventListener('click', function() {
                console.log('üìÖ –ö–ª–∏–∫ –ø–æ —Å–ª–æ—Ç—É');
                // –ó–¥–µ—Å—å –±—É–¥–µ—Ç –ª–æ–≥–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–ª–∏–∫–∞ –ø–æ —Å–ª–æ—Ç—É
            });
        });
    }
    
    // –§—É–Ω–∫—Ü–∏–∏ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è —Å–ª–æ—Ç–æ–≤ (–≥–ª–æ–±–∞–ª—å–Ω—ã–µ)
    window.copyAllSlots = function() {
        console.log('üìã –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —Å–ª–æ—Ç–æ–≤...');
        console.log('üîç filterData:', filterData);
        
        const allSlots = [];
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —Ñ–∏–ª—å—Ç—Ä—ã
        if (filterData.dateFrom || filterData.dateTo) {
            // –ï—Å–ª–∏ –µ—Å—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã, –∫–æ–ø–∏—Ä—É–µ–º —Ç–æ–ª—å–∫–æ –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–ª–æ—Ç—ã
            const filteredSection = document.querySelector('.week-section.filtered-slots');
            if (filteredSection) {
                filteredSection.querySelectorAll('.slot-card').forEach(card => {
                    const slotData = extractSlotData(card);
                    if (slotData) {
                        allSlots.push(slotData);
                    }
                });
                
                const dateRangeText = filterData.dateFrom && filterData.dateTo 
                    ? `${filterData.dateFrom} - ${filterData.dateTo}`
                    : filterData.dateFrom 
                        ? `—Å ${filterData.dateFrom}`
                        : `–¥–æ ${filterData.dateTo}`;
                
                const text = formatSlotsForCopy(allSlots, `–û—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–ª–æ—Ç—ã (${dateRangeText})`);
                copyToClipboard(text);
                return;
            }
        }
        
        // –ï—Å–ª–∏ –Ω–µ—Ç —Ñ–∏–ª—å—Ç—Ä–æ–≤, –∫–æ–ø–∏—Ä—É–µ–º —Å–ª–æ—Ç—ã –∏–∑ –≤—Å–µ—Ö –≤–∏–¥–∏–º—ã—Ö —Å–µ–∫—Ü–∏–π
        document.querySelectorAll('.week-section:not([style*="display: none"]) .slot-card').forEach(card => {
            const slotData = extractSlotData(card);
            if (slotData) {
                allSlots.push(slotData);
            }
        });
        
        if (allSlots.length === 0) {
            showCopyMessage('–ù–µ—Ç —Å–ª–æ—Ç–æ–≤ –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è', 'warning');
            return;
        }
        
        const text = formatSlotsForCopy(allSlots, '–í—Å–µ —Å–ª–æ—Ç—ã');
        copyToClipboard(text);
    }
    
    window.copyWeekSlots = function(weekType) {
        console.log(`üìã –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–ª–æ—Ç–æ–≤ ${weekType} –Ω–µ–¥–µ–ª–∏...`);
        
        // –ù–∞—Ö–æ–¥–∏–º —Å–µ–∫—Ü–∏—é –Ω–µ–¥–µ–ª–∏ –ø–æ —Ç–∏–ø—É
        let weekSection;
        if (weekType === 'current') {
            weekSection = document.querySelector('.week-section.current-week');
        } else if (weekType === 'next') {
            weekSection = document.querySelector('.week-section.next-week');
        }
        
        if (!weekSection) {
            showCopyMessage('–°–µ–∫—Ü–∏—è –Ω–µ–¥–µ–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞', 'error');
            return;
        }
        
        const slots = [];
        weekSection.querySelectorAll('.slot-card').forEach(card => {
            const slotData = extractSlotData(card);
            if (slotData) {
                slots.push(slotData);
            }
        });
        
        if (slots.length === 0) {
            showCopyMessage('–ù–µ—Ç —Å–ª–æ—Ç–æ–≤ –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –≤ —ç—Ç–æ–π –Ω–µ–¥–µ–ª–µ', 'warning');
            return;
        }
        
        const weekName = weekType === 'current' ? '–¢–µ–∫—É—â–∞—è –Ω–µ–¥–µ–ª—è' : '–°–ª–µ–¥—É—é—â–∞—è –Ω–µ–¥–µ–ª—è';
        const text = formatSlotsForCopy(slots, weekName);
        copyToClipboard(text);
    }
    
    window.copyFilteredSlots = function() {
        console.log('üìã –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å–ª–æ—Ç–æ–≤...');
        
        const filteredSection = document.querySelector('.week-section.filtered-slots');
        if (!filteredSection) {
            showCopyMessage('–°–µ–∫—Ü–∏—è –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å–ª–æ—Ç–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞. –í–æ–∑–º–æ–∂–Ω–æ, —Ñ–∏–ª—å—Ç—Ä—ã –Ω–µ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã.', 'error');
            return;
        }
        
        const slots = [];
        filteredSection.querySelectorAll('.slot-card').forEach(card => {
            const slotData = extractSlotData(card);
            if (slotData) {
                slots.push(slotData);
            }
        });
        
        if (slots.length === 0) {
            showCopyMessage('–ù–µ—Ç —Å–ª–æ—Ç–æ–≤ –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω–æ–º –¥–∏–∞–ø–∞–∑–æ–Ω–µ', 'warning');
            return;
        }
        
        const dateRangeText = filterData.dateFrom && filterData.dateTo 
            ? `${filterData.dateFrom} - ${filterData.dateTo}`
            : filterData.dateFrom 
                ? `—Å ${filterData.dateFrom}`
                : `–¥–æ ${filterData.dateTo}`;
        
        const text = formatSlotsForCopy(slots, `–û—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–ª–æ—Ç—ã (${dateRangeText})`);
        copyToClipboard(text);
    }
    
    function extractSlotData(card) {
        try {
            const dateElement = card.querySelector('.fw-bold');
            const weekdayElement = card.querySelector('.badge');
            const slotsElement = card.querySelector('.text-primary');
            const meetingsElement = card.querySelector('.text-success');
            
            console.log('üîç –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Å–ª–æ—Ç–∞:', {
                dateElement: dateElement?.textContent,
                weekdayElement: weekdayElement?.textContent,
                slotsElement: slotsElement?.textContent,
                meetingsElement: meetingsElement?.textContent
            });
            
            if (!dateElement || !weekdayElement || !slotsElement || !meetingsElement) {
                console.warn('‚ö†Ô∏è –ù–µ –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã –Ω–∞–π–¥–µ–Ω—ã –≤ –∫–∞—Ä—Ç–æ—á–∫–µ —Å–ª–æ—Ç–∞');
                return null;
            }
            
            const slotData = {
                date: dateElement.textContent.trim(),
                weekday: weekdayElement.textContent.trim(),
                slots: slotsElement.textContent.trim(),
                meetings: meetingsElement.textContent.trim()
            };
            
            console.log('‚úÖ –ò–∑–≤–ª–µ—á–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Å–ª–æ—Ç–∞:', slotData);
            return slotData;
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö —Å–ª–æ—Ç–∞:', error);
            return null;
        }
    }
    
    function formatSlotsForCopy(slots, title) {
        let text = '';
        
        if (title === '–¢–µ–∫—É—â–∞—è –Ω–µ–¥–µ–ª—è') {
            // –§–æ—Ä–º–∞—Ç –¥–ª—è —Ç–µ–∫—É—â–µ–π –Ω–µ–¥–µ–ª–∏: –ü–ù 12-15, 17
            if (slotsSettings.currentWeekPrefix) {
                text += `${slotsSettings.currentWeekPrefix}\n`;
            }
            slots.forEach(slot => {
                text += `${slot.weekday} ${slot.slots}\n`;
            });
        } else if (title === '–°–ª–µ–¥—É—é—â–∞—è –Ω–µ–¥–µ–ª—è') {
            // –§–æ—Ä–º–∞—Ç –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–π –Ω–µ–¥–µ–ª–∏: –ü–ù (15.09) 11-14, 15
            if (slotsSettings.nextWeekPrefix) {
                text += `${slotsSettings.nextWeekPrefix}\n`;
            }
            slots.forEach(slot => {
                text += `${slot.weekday} (${slot.date}) ${slot.slots}\n`;
            });
        } else if (title === '–í—Å–µ —Å–ª–æ—Ç—ã') {
            // –§–æ—Ä–º–∞—Ç –¥–ª—è –≤—Å–µ—Ö —Å–ª–æ—Ç–æ–≤ —Å —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º –Ω–∞ –Ω–µ–¥–µ–ª–∏
            const today = new Date();
            const currentWeekSlots = [];
            const nextWeekSlots = [];
            
            // –†–∞–∑–¥–µ–ª—è–µ–º —Å–ª–æ—Ç—ã –Ω–∞ —Ç–µ–∫—É—â—É—é –∏ —Å–ª–µ–¥—É—é—â—É—é –Ω–µ–¥–µ–ª—é
            slots.forEach(slot => {
                // –ü—Ä–∞–≤–∏–ª—å–Ω–æ –ø–∞—Ä—Å–∏–º –¥–∞—Ç—É –≤ —Ñ–æ—Ä–º–∞—Ç–µ DD.MM (–¥–æ–±–∞–≤–ª—è–µ–º —Ç–µ–∫—É—â–∏–π –≥–æ–¥)
                const dateParts = slot.date.split('.');
                const day = parseInt(dateParts[0]);
                const month = parseInt(dateParts[1]) - 1; // –ú–µ—Å—è—Ü—ã –≤ JavaScript –Ω–∞—á–∏–Ω–∞—é—Ç—Å—è —Å 0
                const currentYear = today.getFullYear();
                const slotDate = new Date(currentYear, month, day);
                
                const weekStart = new Date(today);
                const dayOfWeek = today.getDay();
                const daysToMonday = dayOfWeek === 0 ? -6 : 1 - dayOfWeek;
                weekStart.setDate(today.getDate() + daysToMonday);
                weekStart.setHours(0, 0, 0, 0);
                
                const weekEnd = new Date(weekStart);
                weekEnd.setDate(weekStart.getDate() + 6);
                weekEnd.setHours(23, 59, 59, 999);
                
                console.log('üîç DEBUG: –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–ª–æ—Ç:', slot.weekday, slot.date, '–î–∞—Ç–∞ —Å–ª–æ—Ç–∞:', slotDate, '–ù–µ–¥–µ–ª—è:', weekStart, '-', weekEnd);
                
                if (slotDate >= weekStart && slotDate <= weekEnd) {
                    currentWeekSlots.push(slot);
                    console.log('üîç DEBUG: –î–æ–±–∞–≤–ª–µ–Ω –≤ —Ç–µ–∫—É—â—É—é –Ω–µ–¥–µ–ª—é:', slot.weekday, slot.date);
                } else {
                    nextWeekSlots.push(slot);
                    console.log('üîç DEBUG: –î–æ–±–∞–≤–ª–µ–Ω –≤ —Å–ª–µ–¥—É—é—â—É—é –Ω–µ–¥–µ–ª—é:', slot.weekday, slot.date);
                }
            });
            
            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—â–∏–π –ø—Ä–µ—Ñ–∏–∫—Å
            if (slotsSettings.allSlotsPrefix) {
                text += `${slotsSettings.allSlotsPrefix}\n`;
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Å–ª–æ—Ç—ã —Ç–µ–∫—É—â–µ–π –Ω–µ–¥–µ–ª–∏
            if (currentWeekSlots.length > 0) {
                currentWeekSlots.forEach(slot => {
                    text += `${slot.weekday} (${slot.date}) ${slot.slots}\n`;
                });
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å –∏ —Å–ª–æ—Ç—ã —Å–ª–µ–¥—É—é—â–µ–π –Ω–µ–¥–µ–ª–∏
            if (nextWeekSlots.length > 0) {
                // –î–æ–±–∞–≤–ª—è–µ–º –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É –∫–∞–∫ —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å –º–µ–∂–¥—É –Ω–µ–¥–µ–ª—è–º–∏
                if (currentWeekSlots.length > 0) {
                    text += `\n`;
                }
                // –î–æ–±–∞–≤–ª—è–µ–º –ø—Ä–µ—Ñ–∏–∫—Å —Å–ª–µ–¥—É—é—â–µ–π –Ω–µ–¥–µ–ª–∏
                if (slotsSettings.nextWeekPrefix) {
                    text += `${slotsSettings.nextWeekPrefix}\n`;
                }
                nextWeekSlots.forEach(slot => {
                    text += `${slot.weekday} (${slot.date}) ${slot.slots}\n`;
                });
            }
        } else {
            // –§–æ—Ä–º–∞—Ç –¥–ª—è –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å–ª–æ—Ç–æ–≤
            text += `${title}\n`;
            slots.forEach(slot => {
                text += `${slot.weekday} (${slot.date}) ${slot.slots}\n`;
            });
        }
        
        return text.trim();
    }
    
    function copyToClipboard(text) {
        if (navigator.clipboard && window.isSecureContext) {
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π API
            navigator.clipboard.writeText(text).then(() => {
                showCopyMessage('–°–ª–æ—Ç—ã —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω—ã –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!', 'success');
            }).catch(err => {
                console.error('–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è:', err);
                fallbackCopyToClipboard(text);
            });
        } else {
            // Fallback –¥–ª—è —Å—Ç–∞—Ä—ã—Ö –±—Ä–∞—É–∑–µ—Ä–æ–≤
            fallbackCopyToClipboard(text);
        }
    }
    
    function fallbackCopyToClipboard(text) {
        const textArea = document.createElement('textarea');
        textArea.value = text;
        textArea.style.position = 'fixed';
        textArea.style.left = '-999999px';
        textArea.style.top = '-999999px';
        document.body.appendChild(textArea);
        textArea.focus();
        textArea.select();
        
        try {
            document.execCommand('copy');
            showCopyMessage('–°–ª–æ—Ç—ã —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω—ã –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!', 'success');
        } catch (err) {
            console.error('–û—à–∏–±–∫–∞ fallback –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è:', err);
            showCopyMessage('–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –≤—ã–¥–µ–ª–∏—Ç—å —Ç–µ–∫—Å—Ç –≤—Ä—É—á–Ω—É—é.', 'error');
        }
        
        document.body.removeChild(textArea);
    }
    
    function showCopyMessage(message, type) {
        // –°–æ–∑–¥–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
        const alertClass = type === 'success' ? 'alert-success' : 
                          type === 'warning' ? 'alert-warning' : 'alert-danger';
        
        const alertHtml = `
            <div class="alert ${alertClass} alert-dismissible fade show position-fixed" 
                 style="top: 20px; right: 20px; z-index: 9999; min-width: 300px;" role="alert">
                <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'warning' ? 'exclamation-triangle' : 'times-circle'} me-2"></i>
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
        `;
        
        // –£–¥–∞–ª—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
        document.querySelectorAll('.alert.position-fixed').forEach(alert => alert.remove());
        
        // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
        document.body.insertAdjacentHTML('beforeend', alertHtml);
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∫—Ä—ã–≤–∞–µ–º —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
        setTimeout(() => {
            const alert = document.querySelector('.alert.position-fixed');
            if (alert) {
                const bsAlert = new bootstrap.Alert(alert);
                bsAlert.close();
            }
        }, 3000);
    }
    
    // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ —Å–ª–æ—Ç–æ–≤
    let slotsSettings = {{ slots_settings.to_dict|safe }};
    
    console.log('üîç DEBUG: –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å —Å–µ—Ä–≤–µ—Ä–∞ (JSON):', slotsSettings);
    
    // –ó–∞–≥—Ä—É–∂–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å —Å–µ—Ä–≤–µ—Ä–∞ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
    window.loadSlotsSettings = function() {
        console.log('üîç DEBUG: –ó–∞–≥—Ä—É–∂–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ –ø–æ–ª—è —Ñ–æ—Ä–º—ã...');
        console.log('üîç DEBUG: slotsSettings:', slotsSettings);
        
        // –ó–∞–ø–æ–ª–Ω—è–µ–º –ø–æ–ª—è –≤ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ –∏–∑ —Å–µ—Ä–≤–µ—Ä–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
        const currentWeekField = document.getElementById('currentWeekPrefix');
        const nextWeekField = document.getElementById('nextWeekPrefix');
        const allSlotsField = document.getElementById('allSlotsPrefix');
        const separatorField = document.getElementById('separatorText');
        
        if (currentWeekField) {
            currentWeekField.value = slotsSettings.currentWeekPrefix;
            console.log('üîç DEBUG: currentWeekPrefix —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω:', currentWeekField.value);
        }
        
        if (nextWeekField) {
            nextWeekField.value = slotsSettings.nextWeekPrefix;
            console.log('üîç DEBUG: nextWeekPrefix —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω:', nextWeekField.value);
        }
        
        if (allSlotsField) {
            allSlotsField.value = slotsSettings.allSlotsPrefix;
            console.log('üîç DEBUG: allSlotsPrefix —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω:', allSlotsField.value);
        }
        
        if (separatorField) {
            separatorField.value = slotsSettings.separatorText;
            console.log('üîç DEBUG: separatorText —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω:', separatorField.value);
        }
        
        updateSettingsPreview();
    }
    
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
    window.saveSlotsSettings = function() {
        const newSettings = {
            currentWeekPrefix: document.getElementById('currentWeekPrefix').value,
            nextWeekPrefix: document.getElementById('nextWeekPrefix').value,
            allSlotsPrefix: document.getElementById('allSlotsPrefix').value,
            separatorText: document.getElementById('separatorText').value
        };
        
        // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
        fetch('{% url "google_oauth:api_slots_settings" %}', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
            },
            body: JSON.stringify(newSettings)
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                // –û–±–Ω–æ–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
                slotsSettings = { ...slotsSettings, ...newSettings };
                
                showCopyMessage('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–ª–æ—Ç–æ–≤ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!', 'success');
                
                // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
                const modal = bootstrap.Modal.getInstance(document.getElementById('slotsSettingsModal'));
                if (modal) {
                    modal.hide();
                }
            } else {
                showCopyMessage('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: ' + data.error, 'danger');
            }
        })
        .catch(error => {
            console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫:', error);
            showCopyMessage('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫', 'danger');
        });
    };
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–µ–≤—å—é –Ω–∞—Å—Ç—Ä–æ–µ–∫
    function updateSettingsPreview() {
        const preview = document.getElementById('settingsPreview');
        if (preview) {
            const currentWeekPrefix = document.getElementById('currentWeekPrefix').value || '–¢–µ–∫—É—â–∞—è –Ω–µ–¥–µ–ª—è:';
            const nextWeekPrefix = document.getElementById('nextWeekPrefix').value || '–°–ª–µ–¥—É—é—â–∞—è –Ω–µ–¥–µ–ª—è:';
            const allSlotsPrefix = document.getElementById('allSlotsPrefix').value || '–î–æ—Å—Ç—É–ø–Ω—ã–µ —Å–ª–æ—Ç—ã:';
            const separatorText = document.getElementById('separatorText').value || '---';
            
            const previewText = `${allSlotsPrefix}
${currentWeekPrefix}
–ü–ù 12-15, 17
–í–¢ 14-17
${separatorText}
${nextWeekPrefix}
–ü–ù (15.09) 11-14, 15
–í–¢ (16.09) 11-18`;
            
            preview.textContent = previewText;
        }
    }
    
    // –ó–∞–ø–æ–ª–Ω—è–µ–º –ø–æ–ª—è —Ñ–æ—Ä–º—ã —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
    setTimeout(function() {
        console.log('üîç DEBUG: –ó–∞–ø–æ–ª–Ω—è–µ–º –ø–æ–ª—è —Ñ–æ—Ä–º—ã —á–µ—Ä–µ–∑ setTimeout...');
        window.loadSlotsSettings();
    }, 100);
    
    // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–µ–≤—å—é –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ø–æ–ª–µ–π
    document.addEventListener('DOMContentLoaded', function() {
        console.log('üîç DEBUG: DOM –∑–∞–≥—Ä—É–∂–µ–Ω, –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–ª–æ—Ç–æ–≤...');
        
        // –ó–∞–ø–æ–ª–Ω—è–µ–º –ø–æ–ª—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ DOM
        setTimeout(function() {
            console.log('üîç DEBUG: –ó–∞–ø–æ–ª–Ω—è–µ–º –ø–æ–ª—è –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ DOM...');
            window.loadSlotsSettings();
        }, 200);
        
        // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
        const modal = document.getElementById('slotsSettingsModal');
        if (modal) {
            modal.addEventListener('show.bs.modal', function() {
                console.log('üîç DEBUG: –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è, –∑–∞–≥—Ä—É–∂–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏...');
                setTimeout(function() {
                    window.loadSlotsSettings();
                }, 50);
            });
        }
        
        // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –ø–æ–ª–µ–π –Ω–∞—Å—Ç—Ä–æ–µ–∫
        ['currentWeekPrefix', 'nextWeekPrefix', 'allSlotsPrefix', 'separatorText'].forEach(fieldId => {
            const field = document.getElementById(fieldId);
            if (field) {
                field.addEventListener('input', updateSettingsPreview);
                console.log('üîç DEBUG: –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–æ–±–∞–≤–ª–µ–Ω –¥–ª—è –ø–æ–ª—è:', fieldId);
            } else {
                console.log('üîç DEBUG: –ü–æ–ª–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ:', fieldId);
            }
        });
    });
    
    function initializeCalendar() {
        console.log('üéØ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞–ª–µ–Ω–¥–∞—Ä—è...');
        
        // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å–æ–±—ã—Ç–∏—è –∏–∑ –≥–ª–æ–±–∞–ª—å–Ω–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π
        const events = calendarEvents;
        console.log('üìÖ –°–æ–±—ã—Ç–∏—è –¥–ª—è –∫–∞–ª–µ–Ω–¥–∞—Ä—è:', events.length);
        
        // –°–æ–∑–¥–∞–µ–º –º–µ—Å—è—á–Ω—ã–π –∫–∞–ª–µ–Ω–¥–∞—Ä—å
        const calendar = createMonthlyCalendar(events);
        calendarWidget.innerHTML = calendar;
        calendarWidget.classList.add('calendar-initialized');
        
        console.log('‚úÖ –ö–∞–ª–µ–Ω–¥–∞—Ä—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
    }
    
    function createMonthlyCalendar(events) {
        console.log('üìÖ –°–æ–∑–¥–∞–Ω–∏–µ –º–µ—Å—è—á–Ω–æ–≥–æ –∫–∞–ª–µ–Ω–¥–∞—Ä—è —Å —Å–æ–±—ã—Ç–∏—è–º–∏:', events.length);
        
        const now = new Date();
        const currentMonth = now.getMonth();
        const currentYear = now.getFullYear();
        
        console.log('üìÖ –¢–µ–∫—É—â–∏–π –º–µ—Å—è—Ü:', currentMonth + 1, '–ì–æ–¥:', currentYear);
        
        // –ü–æ–ª—É—á–∞–µ–º –ø–µ—Ä–≤—ã–π –¥–µ–Ω—å –º–µ—Å—è—Ü–∞ –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π
        const firstDay = new Date(currentYear, currentMonth, 1);
        const lastDay = new Date(currentYear, currentMonth + 1, 0);
        const daysInMonth = lastDay.getDate();
        
        // –ù–∞—Ö–æ–¥–∏–º –ø–µ—Ä–≤—ã–π –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
        const startDate = new Date(firstDay);
        const dayOfWeek = firstDay.getDay();
        const mondayOffset = dayOfWeek === 0 ? -6 : 1 - dayOfWeek;
        startDate.setDate(firstDay.getDate() + mondayOffset);
        
        const monthNames = ['–Ø–Ω–≤–∞—Ä—å', '–§–µ–≤—Ä–∞–ª—å', '–ú–∞—Ä—Ç', '–ê–ø—Ä–µ–ª—å', '–ú–∞–π', '–ò—é–Ω—å', 
                           '–ò—é–ª—å', '–ê–≤–≥—É—Å—Ç', '–°–µ–Ω—Ç—è–±—Ä—å', '–û–∫—Ç—è–±—Ä—å', '–ù–æ—è–±—Ä—å', '–î–µ–∫–∞–±—Ä—å'];
        
        let html = `
            <div class="calendar-container">
                <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∏ –Ω–∞–≤–∏–≥–∞—Ü–∏—è -->
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <div class="d-flex align-items-center">
                        <button class="btn btn-outline-secondary me-2" onclick="changeMonth(-1)">
                            <i class="fas fa-chevron-left"></i>
                        </button>
                        <h2 class="mb-0 me-3">${monthNames[currentMonth]} ${currentYear}</h2>
                        <button class="btn btn-outline-secondary" onclick="changeMonth(1)">
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                    <div>
                        <button type="button" class="btn btn-success" onclick="syncCalendar()" title="–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å">
                            <i class="fas fa-sync"></i>
                        </button>
                    </div>
                </div>

                <!-- –ö–∞–ª–µ–Ω–¥–∞—Ä—å -->
                <div class="card">
                    <div class="card-body p-0">
                        <div class="table-responsive">
                            <table class="table table-bordered mb-0">
                                <thead class="table-light">
                                    <tr>
                                        <th class="text-center">–ü–Ω</th>
                                        <th class="text-center">–í—Ç</th>
                                        <th class="text-center">–°—Ä</th>
                                        <th class="text-center">–ß—Ç</th>
                                        <th class="text-center">–ü—Ç</th>
                                        <th class="text-center">–°–±</th>
                                        <th class="text-center">–í—Å</th>
                                    </tr>
                                </thead>
                                <tbody>
        `;
        
        // –°–æ–∑–¥–∞–µ–º –∫–∞–ª–µ–Ω–¥–∞—Ä–Ω—É—é —Å–µ—Ç–∫—É
        let currentDate = new Date(startDate);
        let weekCount = 0;
        
        while (weekCount < 6) { // –ú–∞–∫—Å–∏–º—É–º 6 –Ω–µ–¥–µ–ª—å
            html += '<tr>';
            
            for (let day = 0; day < 7; day++) {
                const isCurrentMonth = currentDate.getMonth() === currentMonth;
                const isToday = currentDate.toDateString() === now.toDateString();
                const dayNumber = currentDate.getDate();
                
                // –ù–∞—Ö–æ–¥–∏–º —Å–æ–±—ã—Ç–∏—è –¥–ª—è —ç—Ç–æ–≥–æ –¥–Ω—è
                const dayEvents = events.filter(event => {
                    const eventDate = new Date(event.start);
                    return eventDate.toDateString() === currentDate.toDateString();
                });
                
                html += `
                    <td class="calendar-day" style="height: 120px; vertical-align: top; position: relative;">
                        <div class="d-flex justify-content-between align-items-start p-2">
                            <span class="fw-bold ${isToday ? 'text-primary' : ''}" style="font-size: 16px;">
                                ${dayNumber}
                            </span>
                            ${dayEvents.length > 0 ? `<span class="badge bg-primary rounded-pill">${dayEvents.length}</span>` : ''}
                        </div>
                        
                        <!-- –°–æ–±—ã—Ç–∏—è –¥–Ω—è -->
                        <div class="events-container p-1" style="max-height: 80px; overflow-y: auto;">
                `;
                
                dayEvents.forEach(event => {
                    const startTime = new Date(event.start);
                    // –í—Ä–µ–º—è –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤ –∫–∞–ª–µ–Ω–¥–∞—Ä–µ, —Ç–æ–ª—å–∫–æ –≤ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ
                    // –í—Ä–µ–º—è –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤ –∫–∞–ª–µ–Ω–¥–∞—Ä–µ, —Ç–æ–ª—å–∫–æ –≤ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ
                    const titleStr = event.title.length > 20 ? event.title.substring(0, 17) + '...' : event.title;
                    
                    // –û—á–∏—â–∞–µ–º –æ–ø–∏—Å–∞–Ω–∏–µ –æ—Ç HTML-—Ç–µ–≥–æ–≤ –¥–ª—è –∞—Ç—Ä–∏–±—É—Ç–∞
                    const cleanDescription = event.description ? event.description.replace(/<[^>]*>/g, '') : '';
                    
                    let statusClass = 'success';
                    let statusColor = '#28a745';
                    if (event.color === 'orange') {
                        statusClass = 'warning';
                        statusColor = '#ffc107';
                    } else if (event.color === 'grey') {
                        statusClass = 'secondary';
                        statusColor = '#6c757d';
                    }
                    
                    html += `
                        <div class="event-item mb-1 p-1 rounded"
                             style="background-color: ${statusColor}20; 
                                    border-left: 3px solid ${statusColor}; 
                                    font-size: 0.75rem; cursor: pointer;"
                             data-bs-toggle="modal" 
                             data-bs-target="#eventModal"
                             data-event-id="${event.id}">
                            <div class="fw-bold text-truncate" title="${event.title}">
                                ${titleStr}
                            </div>
                        </div>
                    `;
                });
                
                html += `
                        </div>
                    </td>
                `;
                
                currentDate.setDate(currentDate.getDate() + 1);
            }
            
            html += '</tr>';
            weekCount++;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –≤—ã—à–ª–∏ –ª–∏ –º—ã –∑–∞ –ø—Ä–µ–¥–µ–ª—ã –º–µ—Å—è—Ü–∞
            if (currentDate.getMonth() !== currentMonth && currentDate.getDate() > 7) {
                break;
            }
        }
        
        html += `
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        `;
        
        return html;
    }
    
    // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –ø–æ –º–µ—Å—è—Ü–∞–º
    window.changeMonth = function(direction) {
        console.log('–°–º–µ–Ω–∞ –º–µ—Å—è—Ü–∞:', direction);
        // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏–∫—É —Å–º–µ–Ω—ã –º–µ—Å—è—Ü–∞
    };
});

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –¥–ª—è —Å–æ–±—ã—Ç–∏–π (–≤–µ—Ä—Å–∏—è 4.0 - —Å API endpoint)
document.addEventListener('DOMContentLoaded', function() {
    const eventModal = document.getElementById('eventModal');
    const eventDetails = document.getElementById('eventDetails');
    
    if (eventModal) {
        eventModal.addEventListener('show.bs.modal', function (event) {
            const button = event.relatedTarget;
            const eventId = button.getAttribute('data-event-id');
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
            if (eventDetails) {
                eventDetails.innerHTML = `
                    <div class="text-center py-4">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                        </div>
                        <p class="mt-2 text-muted">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–µ—Ç–∞–ª–µ–π —Å–æ–±—ã—Ç–∏—è...</p>
                    </div>
                `;
            }
            
            // –ü–æ–ª—É—á–∞–µ–º –¥–µ—Ç–∞–ª–∏ —Å–æ–±—ã—Ç–∏—è —á–µ—Ä–µ–∑ API
            fetch(`/google-oauth/api/event/${eventId}/`)
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        const eventData = data.event;
                        
                        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è –≤ –∑–∞–≥–æ–ª–æ–≤–æ–∫ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
                        const modalTitle = document.getElementById('eventModalLabel');
                        if (modalTitle) {
                            modalTitle.textContent = eventData.title;
                        }
                        
                        // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –≤—Ä–µ–º—è
                        const startTime = eventData.start_time ? new Date(eventData.start_time) : null;
                        const endTime = eventData.end_time ? new Date(eventData.end_time) : null;
                        const start = startTime ? startTime.toLocaleString('ru-RU') : '–ù–µ —É–∫–∞–∑–∞–Ω–æ';
                        const end = endTime ? endTime.toLocaleString('ru-RU') : '–ù–µ —É–∫–∞–∑–∞–Ω–æ';
                        
                        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ü–≤–µ—Ç —Å—Ç–∞—Ç—É—Å–∞
                        let statusClass = 'success';
                        let statusText = '–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ';
                        if (eventData.status === 'tentative') {
                            statusClass = 'warning';
                            statusText = '–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ';
                        } else if (eventData.status === 'cancelled') {
                            statusClass = 'danger';
                            statusText = '–û—Ç–º–µ–Ω–µ–Ω–æ';
                        }
                        
                        const modalHtml = `
                            <div class="row">
                                <div class="col-12">
                                    <div class="mb-3">
                                        <strong><i class="fas fa-clock me-2"></i>–í—Ä–µ–º—è:</strong>
                                        <span class="ms-2">${start} - ${end}</span>
                                        ${eventData.is_all_day ? '<br><span class="badge bg-info">–í–µ—Å—å –¥–µ–Ω—å</span>' : ''}
                                    </div>
                                    <div class="mb-3">
                                        <strong><i class="fas fa-info-circle me-2"></i>–°—Ç–∞—Ç—É—Å:</strong>
                                        <span class="badge bg-${statusClass} ms-2">${statusText}</span>
                                    </div>
                                    ${eventData.location ? `
                                    <div class="mb-3">
                                        <strong><i class="fas fa-map-marker-alt me-2"></i>–ú–µ—Å—Ç–æ:</strong>
                                        <span class="ms-2">${eventData.location}</span>
                                    </div>
                                    ` : ''}
                                    ${eventData.description ? `
                                    <div class="mb-3">
                                        <strong><i class="fas fa-align-left me-2"></i>–û–ø–∏—Å–∞–Ω–∏–µ:</strong>
                                        <div class="ms-2 mt-1 p-2 bg-light rounded" style="white-space: pre-wrap;">${eventData.description}</div>
                                    </div>
                                    ` : ''}
                                    ${eventData.attendees && eventData.attendees.length > 0 ? `
                                    <div class="mb-3">
                                        <strong><i class="fas fa-users me-2"></i>–£—á–∞—Å—Ç–Ω–∏–∫–∏:</strong>
                                        <div class="ms-2 mt-1">
                                            ${eventData.attendees.map(attendee => `
                                                <div class="d-flex align-items-center mb-1">
                                                    <span class="badge bg-${attendee.response_status === 'accepted' ? 'success' : attendee.response_status === 'declined' ? 'danger' : 'warning'} me-2">
                                                        ${attendee.response_status === 'accepted' ? '‚úì' : attendee.response_status === 'declined' ? '‚úó' : '?'}
                                                    </span>
                                                    <span>${attendee.name || attendee.email}</span>
                                                </div>
                                            `).join('')}
                                        </div>
                                    </div>
                                    ` : ''}
                                    ${eventData.meet_link ? `
                                    <div class="mb-3">
                                        <strong><i class="fab fa-google-meet me-2"></i>Google Meet:</strong>
                                        <a href="${eventData.meet_link}" target="_blank" class="btn btn-sm btn-outline-success ms-2">
                                            <i class="fab fa-google-meet me-1"></i>
                                            –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è –∫ –≤—Å—Ç—Ä–µ—á–µ
                                        </a>
                                    </div>
                                    ` : ''}
                                    ${eventData.html_link ? `
                                    <div class="mb-3">
                                        <strong><i class="fas fa-external-link-alt me-2"></i>–°—Å—ã–ª–∫–∞:</strong>
                                        <a href="${eventData.html_link}" target="_blank" class="btn btn-sm btn-outline-primary ms-2">
                                            <i class="fas fa-external-link-alt me-1"></i>
                                            –û—Ç–∫—Ä—ã—Ç—å –≤ Google Calendar
                                        </a>
                                    </div>
                                    ` : ''}
                                </div>
                            </div>
                        `;
                        
                        if (eventDetails) {
                            eventDetails.innerHTML = modalHtml;
                        }
                    } else {
                        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—à–∏–±–∫—É
                        if (eventDetails) {
                            eventDetails.innerHTML = `
                                <div class="alert alert-danger">
                                    <i class="fas fa-exclamation-triangle me-2"></i>
                                    –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ–±—ã—Ç–∏—è: ${data.message}
                                </div>
                            `;
                        }
                    }
                })
                .catch(error => {
                    console.error('Error fetching event details:', error);
                    if (eventDetails) {
                        eventDetails.innerHTML = `
                            <div class="alert alert-danger">
                                <i class="fas fa-external-link-alt me-2"></i>
                                –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ–±—ã—Ç–∏—è: ${error.message}
                            </div>
                        `;
                    }
                });
        });
    }
});

// –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –∑–∞–ø–æ–ª–Ω—è–µ–º –ø–æ–ª—è —Ñ–æ—Ä–º—ã –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
setTimeout(function() {
    console.log('üîç DEBUG: –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–æ–ª–µ–π —Ñ–æ—Ä–º—ã...');
    try {
        if (typeof window.loadSlotsSettings === 'function') {
            window.loadSlotsSettings();
        } else {
            console.error('–§—É–Ω–∫—Ü–∏—è loadSlotsSettings –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
        }
    } catch (e) {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–∏ –ø–æ–ª–µ–π:', e);
    }
}, 2000);

// –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–∏–¥–∏–º–æ—Å—Ç—å—é –∫–Ω–æ–ø–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Å–ª–æ—Ç–æ–≤
document.addEventListener('DOMContentLoaded', function() {
    const slotsSettingsBtn = document.getElementById('slotsSettingsBtn');
    const slotsTab = document.getElementById('slots-tab');
    const listTab = document.getElementById('list-tab');
    const calendarTab = document.getElementById('calendar-tab');
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫–∞–∑–∞/—Å–∫—Ä—ã—Ç–∏—è –∫–Ω–æ–ø–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫
    function toggleSettingsButton() {
        if (slotsTab && slotsTab.classList.contains('active')) {
            slotsSettingsBtn.style.display = 'inline-block';
        } else {
            slotsSettingsBtn.style.display = 'none';
        }
    }
    
    // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –≤—Å–µ—Ö –≤–∫–ª–∞–¥–æ–∫
    if (slotsTab) {
        slotsTab.addEventListener('click', toggleSettingsButton);
    }
    if (listTab) {
        listTab.addEventListener('click', toggleSettingsButton);
    }
    if (calendarTab) {
        calendarTab.addEventListener('click', toggleSettingsButton);
    }
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
    toggleSettingsButton();
});
</script>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Å–æ–±—ã—Ç–∏—è -->
<div class="modal fade" id="eventModal" tabindex="-1" aria-labelledby="eventModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="eventModalLabel">–î–µ—Ç–∞–ª–∏ —Å–æ–±—ã—Ç–∏—è</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div id="eventDetails">
                    <!-- –î–µ—Ç–∞–ª–∏ —Å–æ–±—ã—Ç–∏—è –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–ó–∞–∫—Ä—ã—Ç—å</button>
            </div>
        </div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Å–ª–æ—Ç–æ–≤ -->
<div class="modal fade" id="slotsSettingsModal" tabindex="-1" aria-labelledby="slotsSettingsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="slotsSettingsModalLabel">
                    <i class="fas fa-cog me-2"></i>
                    –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–ª–æ—Ç–æ–≤
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-12">
                        <p class="text-muted mb-4">
                            –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —Ç–µ–∫—Å—Ç, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –∫ —Å–ª–æ—Ç–∞–º –ø—Ä–∏ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–∏.
                        </p>
                        
                        <div class="mb-4">
                            <label for="currentWeekPrefix" class="form-label">
                                <i class="fas fa-calendar-week text-success me-2"></i>
                                –¢–µ–∫—Å—Ç –ø–µ—Ä–µ–¥ —Å–ª–æ—Ç–∞–º–∏ —Ç–µ–∫—É—â–µ–π –Ω–µ–¥–µ–ª–∏
                            </label>
                            <input type="text" class="form-control" id="currentWeekPrefix" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –¢–µ–∫—É—â–∞—è –Ω–µ–¥–µ–ª—è:" value="">
                            <div class="form-text">–≠—Ç–æ—Ç —Ç–µ–∫—Å—Ç –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω –ø–µ—Ä–µ–¥ —Å–ª–æ—Ç–∞–º–∏ —Ç–µ–∫—É—â–µ–π –Ω–µ–¥–µ–ª–∏</div>
                        </div>
                        
                        <div class="mb-4">
                            <label for="nextWeekPrefix" class="form-label">
                                <i class="fas fa-calendar-week text-primary me-2"></i>
                                –¢–µ–∫—Å—Ç –ø–µ—Ä–µ–¥ —Å–ª–æ—Ç–∞–º–∏ —Å–ª–µ–¥—É—é—â–µ–π –Ω–µ–¥–µ–ª–∏
                            </label>
                            <input type="text" class="form-control" id="nextWeekPrefix" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –°–ª–µ–¥—É—é—â–∞—è –Ω–µ–¥–µ–ª—è:" value="">
                            <div class="form-text">–≠—Ç–æ—Ç —Ç–µ–∫—Å—Ç –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω –ø–µ—Ä–µ–¥ —Å–ª–æ—Ç–∞–º–∏ —Å–ª–µ–¥—É—é—â–µ–π –Ω–µ–¥–µ–ª–∏</div>
                        </div>
                        
                        <div class="mb-4">
                            <label for="allSlotsPrefix" class="form-label">
                                <i class="fas fa-copy me-2"></i>
                                –¢–µ–∫—Å—Ç –ø–µ—Ä–µ–¥ –≤—Å–µ–º–∏ —Å–ª–æ—Ç–∞–º–∏
                            </label>
                            <input type="text" class="form-control" id="allSlotsPrefix" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –î–æ—Å—Ç—É–ø–Ω—ã–µ —Å–ª–æ—Ç—ã:" value="">
                            <div class="form-text">–≠—Ç–æ—Ç —Ç–µ–∫—Å—Ç –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω –≤ –Ω–∞—á–∞–ª–æ –ø—Ä–∏ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–∏ –≤—Å–µ—Ö —Å–ª–æ—Ç–æ–≤</div>
                        </div>
                        
                        <div class="mb-4">
                            <label for="separatorText" class="form-label">
                                <i class="fas fa-minus me-2"></i>
                                –†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å –º–µ–∂–¥—É –Ω–µ–¥–µ–ª—è–º–∏
                            </label>
                            <input type="text" class="form-control" id="separatorText" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: ---" value="---">
                            <div class="form-text">–¢–µ–∫—Å—Ç, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç —Ä–∞–∑–¥–µ–ª—è—Ç—å —Ç–µ–∫—É—â—É—é –∏ —Å–ª–µ–¥—É—é—â—É—é –Ω–µ–¥–µ–ª—é</div>
                        </div>
                        
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle me-2"></i>
                            <strong>–ü—Ä–∏–º–µ—Ä —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞:</strong>
                            <pre id="settingsPreview" class="mt-2 mb-0"></pre>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
                <button type="button" class="btn btn-primary" onclick="saveSlotsSettings()">
                    <i class="fas fa-save me-2"></i>
                    –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
                </button>
            </div>
        </div>
    </div>
</div>

{% endblock %}
