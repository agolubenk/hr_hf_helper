{% extends 'common/base.html' %}
{% load static %}

{% block title %}{{ title }}{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- –°–µ–ª–µ–∫—Ç–æ—Ä –≤–∞–∫–∞–Ω—Å–∏–∏ –∏ —Å–≤–æ–±–æ–¥–Ω—ã–µ —Å–ª–æ—Ç—ã -->
    <div class="row" style="margin-bottom: -5px;">
        <div class="col-12">
            <div class="vacancy-selector">
                <div class="row align-items-center">
                    <div class="col-md-8">

                        <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤—ã–±—Ä–∞–Ω–Ω–æ–π –≤–∞–∫–∞–Ω—Å–∏–∏ -->
                        {% if selected_vacancy %}
                        <div class="automation-card mt-1">
                            <div class="row align-items-center">
                                <div class="col-12">
                                    <!-- –ö–Ω–æ–ø–∫–∏ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –≤–æ–ø—Ä–æ—Å–æ–≤ –∏ —Å–ª–æ—Ç–æ–≤ -->
                                    <div class="copy-buttons">
                                        <div class="d-flex gap-2 flex-wrap">
                                            <!-- –ö–Ω–æ–ø–∫–∏ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è –ë–µ–ª–∞—Ä—É—Å–∏ -->
                                            <button class="btn-copy btn-copy-vacancy-link-belarus position-relative" 
                                                    onclick="window.copyVacancyLink('belarus')"
                                                    {% if not selected_vacancy.vacancy_link_belarus %}disabled{% endif %}
                                                    title="–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É –Ω–∞ –≤–∞–∫–∞–Ω—Å–∏—é (–ë–µ–ª–∞—Ä—É—Å—å)">
                                                <i class="fas fa-link"></i>
                                                <div class="position-absolute top-0 start-100 translate-middle">
                                                    <span class="flag-emoji">üáßüáæ</span>
                </div>
                                                <div class="copy-tooltip">–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É –Ω–∞ –≤–∞–∫–∞–Ω—Å–∏—é (–ë–µ–ª–∞—Ä—É—Å—å)</div>
                                            </button>
                                            
                                            <button class="btn-copy btn-copy-belarus position-relative" 
                                                    onclick="copyQuestions('belarus')"
                                                    {% if not selected_vacancy.questions_belarus %}disabled{% endif %}
                                                    title="–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≤–æ–ø—Ä–æ—Å—ã –¥–ª—è –ë–µ–ª–∞—Ä—É—Å–∏">
                                                <i class="fas fa-question"></i>
                                                <div class="position-absolute top-0 start-100 translate-middle">
                                                    <span class="flag-emoji">üáßüáæ</span>
            </div>
                                                <div class="copy-tooltip">–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≤–æ–ø—Ä–æ—Å—ã –¥–ª—è –ë–µ–ª–∞—Ä—É—Å–∏</div>
                                            </button>
                                            
                                            <!-- –ö–Ω–æ–ø–∫–∏ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è –ü–æ–ª—å—à–∏ -->
                                            <button class="btn-copy btn-copy-vacancy-link-poland position-relative" 
                                                    onclick="window.copyVacancyLink('poland')"
                                                    {% if not selected_vacancy.vacancy_link_poland %}disabled{% endif %}
                                                    title="–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É –Ω–∞ –≤–∞–∫–∞–Ω—Å–∏—é (–ü–æ–ª—å—à–∞)">
                                                <i class="fas fa-link"></i>
                                                <div class="position-absolute top-0 start-100 translate-middle">
                                                    <span class="flag-emoji">üáµüá±</span>
                                                </div>
                                                <div class="copy-tooltip">–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É –Ω–∞ –≤–∞–∫–∞–Ω—Å–∏—é (–ü–æ–ª—å—à–∞)</div>
                                            </button>
                                            
                                            <button class="btn-copy btn-copy-poland position-relative" 
                                                    onclick="copyQuestions('poland')"
                                                    {% if not selected_vacancy.questions_poland %}disabled{% endif %}
                                                    title="–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≤–æ–ø—Ä–æ—Å—ã –¥–ª—è –ü–æ–ª—å—à–∏">
                                                <i class="fas fa-question"></i>
                                                <div class="position-absolute top-0 start-100 translate-middle">
                                                    <span class="flag-emoji">üáµüá±</span>
                                                </div>
                                                <div class="copy-tooltip">–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≤–æ–ø—Ä–æ—Å—ã –¥–ª—è –ü–æ–ª—å—à–∏</div>
                                            </button>
                                            
                                            <!-- –ö–Ω–æ–ø–∫–∏ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è —Å–ª–æ—Ç–æ–≤ -->
                                            <button class="btn-copy btn-copy-current-week" 
                                                    onclick="window.copyWeekSlots('current')"
                                                    title="–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å–ª–æ—Ç—ã —Ç–µ–∫—É—â–µ–π –Ω–µ–¥–µ–ª–∏">
                                                <i class="fas fa-calendar-week"></i>
                                                <div class="copy-tooltip">–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å–ª–æ—Ç—ã —Ç–µ–∫—É—â–µ–π –Ω–µ–¥–µ–ª–∏</div>
                                            </button>
                                            
                                            <button class="btn-copy btn-copy-next-week" 
                                                    onclick="window.copyWeekSlots('next')"
                                                    title="–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å–ª–æ—Ç—ã —Å–ª–µ–¥—É—é—â–µ–π –Ω–µ–¥–µ–ª–∏">
                                                <i class="fas fa-calendar-plus"></i>
                                                <div class="copy-tooltip">–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å–ª–æ—Ç—ã —Å–ª–µ–¥—É—é—â–µ–π –Ω–µ–¥–µ–ª–∏</div>
                                            </button>
                                            
                                            <button class="btn-copy btn-copy-all-slots" 
                                                    onclick="window.copyAllSlots()"
                                                    title="–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ —Å–ª–æ—Ç—ã">
                                                <i class="fas fa-copy"></i>
                                                <div class="copy-tooltip">–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ —Å–ª–æ—Ç—ã</div>
                                            </button>
                                            
                                            <button class="btn-copy btn-refresh-slots" 
                                                    onclick="window.refreshSlots()"
                                                    title="–û–±–Ω–æ–≤–∏—Ç—å —Å–ª–æ—Ç—ã">
                                                <i class="fas fa-sync-alt"></i>
                                                <div class="copy-tooltip">–û–±–Ω–æ–≤–∏—Ç—å —Å–ª–æ—Ç—ã</div>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endif %}
                    </div>
                    <div class="col-md-4">
                        <form method="GET" id="vacancyForm">
                            <select name="vacancy_id" style="margin-top: 40px!important;" class="form-select" onchange="this.form.submit()">
                                <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞–∫–∞–Ω—Å–∏—é --</option>
                                {% for vacancy in active_vacancies %}
                                    <option value="{{ vacancy.id }}" 
                                            {% if selected_vacancy and vacancy.id == selected_vacancy.id %}selected{% endif %}>
                                        {{ vacancy.name }}
                                    </option>
                                {% endfor %}
                            </select>
                        </form>
                        {% if selected_vacancy %}
                        <div class="mt-2 text-end">
                            <span class="badge bg-success fs-6 clickable-badge" onclick="toggleSlotsCard()" style="cursor: pointer;">
                                <i class="fas fa-clock me-2"></i> –°–≤–æ–±–æ–¥–Ω—ã–µ —Å–ª–æ—Ç—ã
                            </span>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- –°–≤–æ–±–æ–¥–Ω—ã–µ —Å–ª–æ—Ç—ã -->
    {% if selected_vacancy %}
    <div class="row">
        <div class="col-12">
            <div class="collapse" id="slotsCardBody">
            <!-- –¢–µ–∫—É—â–∞—è –Ω–µ–¥–µ–ª—è -->
            <div class="week-section current-week mb-4">
                <h6 class="text-primary mb-3">
                    <i class="fas fa-calendar-week me-2"></i>
                    –¢–µ–∫—É—â–∞—è –Ω–µ–¥–µ–ª—è
                    <button class="btn btn-sm btn-outline-primary float-end btn-collapse" type="button" data-bs-toggle="collapse" data-bs-target="#currentWeekSlots" aria-expanded="true" aria-controls="currentWeekSlots">
                        <i class="fas fa-chevron-up"></i>
                    </button>
                </h6>
                <div class="collapse show" id="currentWeekSlots">
                    <div class="row">
                        <!-- –°–ª–æ—Ç—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
                    </div>
                </div>
            </div>
            
            <!-- –°–ª–µ–¥—É—é—â–∞—è –Ω–µ–¥–µ–ª—è -->
            <div class="week-section next-week">
                <h6 class="text-info mb-3">
                    <i class="fas fa-calendar-plus me-2"></i>
                    –°–ª–µ–¥—É—é—â–∞—è –Ω–µ–¥–µ–ª—è
                    <button class="btn btn-sm btn-outline-info float-end btn-collapse" type="button" data-bs-toggle="collapse" data-bs-target="#nextWeekSlots" aria-expanded="true" aria-controls="nextWeekSlots">
                        <i class="fas fa-chevron-up"></i>
                    </button>
                </h6>
                <div class="collapse show" id="nextWeekSlots">
                    <div class="row">
                        <!-- –°–ª–æ—Ç—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
                    </div>
                </div>
            </div>
        </div>
            </div>
        </div>
    </div>
    {% endif %}


            <div class="row">
                <div class="col-lg-8">
            <!-- –ß–∞—Ç -->
                    <div class="card shadow">
                        <div class="card-header py-3">
                            <h6 class="m-0 font-weight-bold text-primary">
                        <i class="fas fa-comments me-2"></i>HR-–ø–æ–º–æ—â–Ω–∏–∫
                        <span class="badge bg-secondary ms-2">#{{ chat_session.id }}</span>
                            </h6>
                        </div>
                
                        <div class="card-body p-0">
                    <!-- –°–æ–æ–±—â–µ–Ω–∏—è —á–∞—Ç–∞ -->
                    <div id="chat-messages" class="chat-messages" style="height: 500px; overflow-y: auto;">
                                {% for message in messages %}
                            <div class="message mb-3 {% if message.message_type == 'user' %}user-message{% elif message.message_type == 'hr_screening' %}system-message hr-screening-message{% elif message.message_type == 'invite' %}system-message invite-message{% else %}system-message{% endif %}">
                                        <div class="d-flex {% if message.message_type == 'user' %}justify-content-end{% else %}justify-content-start{% endif %}">
                                            <div class="message-bubble {% if message.message_type == 'user' %}user-bubble{% else %}system-bubble{% endif %}">
                                        
                                        <!-- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ -->
                                                {% if message.message_type == 'user' %}
                                                    <div class="message-header">
                                                        <i class="fas fa-user me-1"></i>
                                                        <strong>–í—ã</strong>
                                                        <small class="text-muted ms-2">{{ message.created_at|date:"d.m.Y H:i" }}</small>
                                                    </div>
                                            <div class="message-content user-content">{{ message.content|linebreaks }}</div>
                                                
                                        <!-- HR-—Å–∫—Ä–∏–Ω–∏–Ω–≥ -->
                                                {% elif message.message_type == 'hr_screening' %}
                                                    <div class="message-header">
                                                        <i class="fas fa-clipboard-list me-1"></i>
                                                        <strong>HR-—Å–∫—Ä–∏–Ω–∏–Ω–≥</strong>
                                                        <small class="text-muted ms-2">{{ message.created_at|date:"d.m.Y H:i" }}</small>
                                                    </div>
                                            <div class="message-content bot-content-fixed">
                                                <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –∏ –∫–Ω–æ–ø–∫–∞–º–∏ -->
                                                <div class="message-body-with-buttons">
                                                    <div class="message-info">
                                                        <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–∞–Ω–¥–∏–¥–∞—Ç–µ -->
                                                        <div class="candidate-info-table">
                                                            {% if message.metadata.candidate_name %}
                                                                <div class="info-row-table">
                                                                    <span class="info-label-table">–ö–∞–Ω–¥–∏–¥–∞—Ç:</span>
                                                                    <span class="info-value-table">{{ message.metadata.candidate_name }}</span>
                                                                </div>
                                                            {% endif %}
                                                            
                                                            {% if message.metadata.vacancy_name %}
                                                                <div class="info-row-table">
                                                                    <span class="info-label-table">–í–∞–∫–∞–Ω—Å–∏—è:</span>
                                                                    <span class="info-value-table">{{ message.metadata.vacancy_name }}</span>
                                                                </div>
                                                            {% endif %}
                                                            
                                                            {% if message.metadata.determined_grade %}
                                                                <div class="info-row-table">
                                                                    <span class="info-label-table">–£—Ä–æ–≤–µ–Ω—å:</span>
                                                                    <span class="grade-badge-inline">{{ message.metadata.determined_grade }}</span>
                                                                </div>
                                                            {% endif %}
                                                        </div>
                                                        
                                                        <div class="status-message-compact">
                                                            <i class="fas fa-check-circle me-1"></i>
                                                            –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –∏ –ø–µ—Ä–µ–¥–∞–Ω—ã –≤ Huntflow
                                                        </div>
                                                    </div>
                                                    
                                                    <!-- –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π —Å–ø—Ä–∞–≤–∞ -->
                                                        {% if message.metadata %}
                                                        <div class="action-buttons-right">
                                                                    {% if message.metadata.candidate_url %}
                                                                <a href="{{ message.metadata.candidate_url }}" target="_blank" class="btn btn-sm btn-outline-primary" title="–û—Ç–∫—Ä—ã—Ç—å –≤ Huntflow">
                                                                            <i class="fas fa-external-link-alt"></i>
                                                                        </a>
                                                                    {% endif %}
                                                            </div>
                                                        {% endif %}
                                                </div>
                                                    </div>
                                                
                                        <!-- –ò–Ω–≤–∞–π—Ç -->
                                                {% elif message.message_type == 'invite' %}
                                                    <div class="message-header">
                                                        <i class="fas fa-calendar-plus me-1"></i>
                                                        <strong>–ò–Ω–≤–∞–π—Ç</strong>
                                                        <small class="text-muted ms-2">{{ message.created_at|date:"d.m.Y H:i" }}</small>
                                                    </div>
                                            <div class="message-content bot-content-fixed">
                                                <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –∏ –∫–Ω–æ–ø–∫–∞–º–∏ -->
                                                <div class="message-body-with-buttons">
                                                    <div class="message-info">
                                                        <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –∏–Ω–≤–∞–π—Ç–µ -->
                                                        <div class="candidate-info-table">
                                                            {% if message.metadata.candidate_name %}
                                                                <div class="info-row-table">
                                                                    <span class="info-label-table">–ö–∞–Ω–¥–∏–¥–∞—Ç:</span>
                                                                    <span class="info-value-table">{{ message.metadata.candidate_name }}</span>
                                                                </div>
                                                            {% endif %}
                                                            
                                                            {% if message.metadata.vacancy_name %}
                                                                <div class="info-row-table">
                                                                    <span class="info-label-table">–í–∞–∫–∞–Ω—Å–∏—è:</span>
                                                                    <span class="info-value-table">{{ message.metadata.vacancy_name }}</span>
                                                                </div>
                                                            {% endif %}
                                                            
                                                            {% if message.metadata.determined_grade %}
                                                                <div class="info-row-table">
                                                                    <span class="info-label-table">–£—Ä–æ–≤–µ–Ω—å:</span>
                                                                    <span class="grade-badge-inline">{{ message.metadata.determined_grade }}</span>
                                                                </div>
                                                            {% endif %}
                                                            
                                                            {% if message.invite.google_drive_file_url %}
                                                                <div class="info-row-table">
                                                                    <span class="info-label-table">Scorecard:</span>
                                                                    <a href="{{ message.invite.google_drive_file_url }}" target="_blank" class="info-link-compact">
                                                                        –û—Ç–∫—Ä—ã—Ç—å <i class="fas fa-external-link-alt ms-1"></i>
                                                                    </a>
                                                                </div>
                                                            {% endif %}
                                                            
                                                            {% if message.invite.google_meet_url %}
                                                                <div class="info-row-table">
                                                                    <span class="info-label-table">Google Meet:</span>
                                                                    <a href="{{ message.invite.google_meet_url }}" target="_blank" class="info-link-compact">
                                                                        –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è <i class="fas fa-external-link-alt ms-1"></i>
                                                                    </a>
                                                                </div>
                                                            {% endif %}
                                                            
                                                            {% if message.invite.interview_datetime %}
                                                                <div class="info-row-table">
                                                                    <span class="info-label-table">–î–∞—Ç–∞ –∏–Ω—Ç–µ—Ä–≤—å—é:</span>
                                                                    <span class="info-value-table">{{ message.invite.interview_datetime|date:"Y-m-d H:i" }}</span>
                                                                </div>
                                                            {% endif %}
                                                        </div>
                                                        
                                                        <div class="status-message-compact">
                                                            <i class="fas fa-check-circle me-1"></i>
                                                            –ò–Ω–≤–∞–π—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –∏ –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∫–∞–ª–µ–Ω–¥–∞—Ä—å
                                                        </div>
                                                    </div>
                                                    
                                                    <!-- –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π —Å–ø—Ä–∞–≤–∞ -->
                                                        {% if message.metadata %}
                                                        <div class="action-buttons-right">
                                                                    {% if message.metadata.candidate_url %}
                                                                <a href="{{ message.metadata.candidate_url }}" target="_blank" class="btn btn-sm btn-outline-primary" title="–û—Ç–∫—Ä—ã—Ç—å –≤ Huntflow">
                                                                            <i class="fas fa-external-link-alt"></i>
                                                                        </a>
                                                                    {% endif %}
                                                                    {% if message.invite %}
                                                                <a href="{% url 'google_oauth:invite_detail' message.invite.id %}" class="btn btn-sm btn-outline-success" title="–ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏">
                                                                            <i class="fas fa-eye"></i>
                                                                        </a>
                                                                <button type="button" class="btn btn-sm btn-outline-warning copy-invitation-btn" data-invite-id="{{ message.invite.id }}" title="–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç –∏–Ω–≤–∞–π—Ç–∞">
                                                                            <i class="fas fa-copy"></i>
                                                                        </button>
                                                                    {% endif %}
                                                            </div>
                                                        {% endif %}
                                                </div>
                                                    </div>
                                                
                                        <!-- –°–∏—Å—Ç–µ–º–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ -->
                                                {% else %}
                                                    <div class="message-header">
                                                        <i class="fas fa-robot me-1"></i>
                                                        <strong>–°–∏—Å—Ç–µ–º–∞</strong>
                                                        <small class="text-muted ms-2">{{ message.created_at|date:"d.m.Y H:i" }}</small>
                                                    </div>
                                                    <div class="message-content">{{ message.content|linebreaks }}</div>
                                                {% endif %}
                                            </div>
                                        </div>
                                    </div>
                                {% empty %}
                                    <div class="text-center text-muted py-5">
                                        <i class="fas fa-comments fa-3x mb-3"></i>
                                        <p>–ù–∞—á–Ω–∏—Ç–µ –¥–∏–∞–ª–æ–≥, –æ—Ç–ø—Ä–∞–≤–∏–≤ —Å–æ–æ–±—â–µ–Ω–∏–µ</p>
                                    </div>
                                {% endfor %}
                            </div>
                            
                            <!-- –§–æ—Ä–º–∞ –≤–≤–æ–¥–∞ -->
                            <div class="card-footer">
                                <form method="post" id="chat-form">
                                    {% csrf_token %}
                                    <input type="hidden" name="session_id" value="{{ chat_session.id }}">
                                    
                                    <!-- –û–±—ë—Ä—Ç–∫–∞ –ø–æ–ª—è –≤–≤–æ–¥–∞ -->
                                    <div class="chat-input-wrapper">
                                        <!-- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤—ã–±—Ä–∞–Ω–Ω–æ–π –º–µ—Ç–∫–∏ (—Å–∫—Ä—ã—Ç–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) -->
                                        <span id="selectedTag"
                                              class="tag-label badge bg-primary me-2"
                                              style="display:none; font-weight:bold;">
                                        </span>

                                        <div class="input-group">
                                            {{ form.message }}
                                            <button type="submit" class="btn btn-primary" id="send-btn">
                                                <i class="fas fa-paper-plane"></i>
                                            </button>
                                        </div>
                                        
                                        <!-- –°–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ —Ç–∏–ø–∞ –¥–µ–π—Å—Ç–≤–∏—è -->
                                        <input type="hidden"
                                               id="actionType"
                                               name="action_type"
                                               value="hrscreening">
                                    </div>
                                    
                                    {% if form.message.errors %}
                                        <div class="alert alert-danger small mt-2">
                                            {% for error in form.message.errors %}
                                        <i class="fas fa-exclamation-triangle me-1"></i>{{ error|striptags }}
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                </form>
                            </div>
                        </div>
                    </div>
                </div>

         <!-- –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å —Å–æ —Å–ø–∏—Å–∫–æ–º —Å–µ—Å—Å–∏–π -->
                <div class="col-lg-4">
                    <div class="card shadow">
                        <div class="card-header py-3">
                            <h6 class="m-0 font-weight-bold text-primary">
                         <i class="fas fa-comments me-2"></i>–ò—Å—Ç–æ—Ä–∏—è —á–∞—Ç–æ–≤
                            </h6>
                        </div>
                 <div class="card-body p-0 pt-2">
                     <!-- –°–ø–∏—Å–æ–∫ —Å–µ—Å—Å–∏–π -->
                     <div class="sessions-list" style="max-height: 400px; overflow-y: auto;">
                         {% for session in all_sessions %}
                             <div class="session-item mx-2 {% if session.id == chat_session.id %}active{% endif %}">
                                 <a href="{% url 'google_oauth:chat_workflow_session' session.id %}" class="session-link">
                                     <div class="session-header">
                                         <div class="session-info">
                                             <span class="session-id">#{{ session.id }}</span>
                                             <span class="session-date">{{ session.updated_at|date:"d.m.Y H:i" }}</span>
                            </div>
                                         <div class="session-status">
                                             {% if session.id == chat_session.id %}
                                                 <i class="fas fa-circle text-primary" style="font-size: 8px;"></i>
                                             {% endif %}
                            </div>
                        </div>
                                     <div class="session-preview">
                                         {% if session.messages.last %}
                                             <span class="session-last-message">
                                                 {% if session.messages.last.message_type == 'user' %}
                                                     <i class="fas fa-user me-1 text-muted"></i>
                                                 {% elif session.messages.last.message_type == 'hr_screening' %}
                                                     <i class="fas fa-clipboard-list me-1 text-success"></i>
                                                 {% elif session.messages.last.message_type == 'invite' %}
                                                     <i class="fas fa-calendar-plus me-1 text-warning"></i>
                                                 {% else %}
                                                     <i class="fas fa-robot me-1 text-muted"></i>
                                                 {% endif %}
                                                 {{ session.messages.last.content|truncatechars:50 }}
                                             </span>
                                         {% else %}
                                             <span class="session-empty text-muted">
                                                 <i class="fas fa-comment-slash me-1"></i>
                                                 –ü—É—Å—Ç–æ–π —á–∞—Ç
                                             </span>
                                         {% endif %}
                    </div>
                                 </a>
                </div>
                         {% empty %}
                             <div class="text-center text-muted py-4">
                                 <i class="fas fa-comments fa-2x mb-2"></i>
                                 <p class="mb-0">–ù–µ—Ç —á–∞—Ç–æ–≤</p>
            </div>
                         {% endfor %}
                            </div>
                        </div>
                 <div class="card-footer py-2">
                     <a href="{% url 'google_oauth:chat_workflow' %}" class="btn btn-sm btn-outline-primary w-100">
                         <i class="fas fa-plus me-1"></i>–ù–æ–≤—ã–π —á–∞—Ç
                     </a>
                </div>
            </div>
            
            <!-- –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –∫–æ–º–∞–Ω–¥–∞–º -->
            <div class="card shadow mt-3">
                <div class="card-header py-3">
                    <h6 class="m-0 font-weight-bold text-primary">
                        <i class="fas fa-keyboard me-2"></i>–ö–æ–º–∞–Ω–¥—ã —á–∞—Ç–∞
                    </h6>
                </div>
                <div class="card-body p-3">
                    <div class="commands-list">
                        <div class="command-item mb-3">
                            <div class="command-header">
                                <span class="command-badge bg-success">/s</span>
                                <strong class="ms-2">HR-—Å–∫—Ä–∏–Ω–∏–Ω–≥</strong>
                            </div>
                            <p class="command-description mb-0 text-muted small">
                                –°–æ–∑–¥–∞–µ—Ç HR-—Å–∫—Ä–∏–Ω–∏–Ω–≥. –í—Å—Ç–∞–≤—å—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ –∫–∞–Ω–¥–∏–¥–∞—Ç–∞ –∏–∑ Huntflow –∏ –æ–ø–∏—à–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏—è.
                            </p>
                            <div class="command-example mt-1">
                                <code class="text-primary small">/s https://huntflow.ru/vacancy/123/candidate/456 –ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤ –ø—Ä–æ—à–µ–ª —Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏–µ...</code>
                            </div>
                        </div>
                        
                        <div class="command-item">
                            <div class="command-header">
                                <span class="command-badge bg-warning">/in</span>
                                <strong class="ms-2">–ò–Ω–≤–∞–π—Ç</strong>
                            </div>
                            <p class="command-description mb-0 text-muted small">
                                –°–æ–∑–¥–∞–µ—Ç –∏–Ω–≤–∞–π—Ç –Ω–∞ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∏–Ω—Ç–µ—Ä–≤—å—é. –í—Å—Ç–∞–≤—å—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ –∫–∞–Ω–¥–∏–¥–∞—Ç–∞ –∏ —É–∫–∞–∂–∏—Ç–µ –¥–µ—Ç–∞–ª–∏ –≤—Å—Ç—Ä–µ—á–∏.
                            </p>
                            <div class="command-example mt-1">
                                <code class="text-primary small">/in https://huntflow.ru/vacancy/123/candidate/456 –ü—Ä–∏–≥–ª–∞—à–∞–µ–º –Ω–∞ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∏–Ω—Ç–µ—Ä–≤—å—é...</code>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
/* === –ï–î–ò–ù–û–û–ë–†–ê–ó–ò–ï –†–ê–ó–ú–ï–†–û–í –®–†–ò–§–¢–û–í === */
.card .chat-messages {
    background-color: #ffffff; /* –ë–µ–ª—ã–π —Ñ–æ–Ω –¥–ª—è —Å–≤–µ—Ç–ª–æ–π —Ç–µ–º—ã */
    padding: 12px !important;
}

/* –¢–µ–º–Ω–∞—è —Ç–µ–º–∞ - —á–µ—Ä–Ω—ã–π —Ñ–æ–Ω —á–∞—Ç–∞ */
[data-theme="dark"] .card .chat-messages {
    background-color: #000000;
}

.card .message {
    margin-bottom: 12px !important;
    width: 100%;
    display: block;
}

.card .message > .d-flex {
    width: 100%;
}

/* –ö–õ–Æ–ß–ï–í–û–ï –ò–ó–ú–ï–ù–ï–ù–ò–ï: –ï–¥–∏–Ω—ã–π —Ä–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ –¥–ª—è –≤—Å–µ—Ö —Å–æ–æ–±—â–µ–Ω–∏–π */
.card .message-bubble {
    padding: 8px 12px;
    border-radius: 12px;
    word-wrap: break-word;
    line-height: 1.3;
    font-size: 1.1rem !important; /* –£–í–ï–õ–ò–ß–ò–í–ê–ï–ú –¥–æ —Ä–∞–∑–º–µ—Ä–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π */
    display: inline-block;
    width: auto !important;
    min-width: fit-content !important;
    max-width: none !important;
}

/* –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è - –æ—Å—Ç–∞—é—Ç—Å—è —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º */
.card .user-message .message-bubble {
    max-width: 75%;
    min-width: 120px;
}

/* –°–∏—Å—Ç–µ–º–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è - –ë–ï–ó –û–ì–†–ê–ù–ò–ß–ï–ù–ò–ô –®–ò–†–ò–ù–´ */
.card .system-message .message-bubble {
    max-width: none !important;
    min-width: fit-content !important;
    width: auto !important;
}

.card .user-bubble {
    background: var(--hr-gradient, linear-gradient(135deg, #007bff 0%, #0056b3 100%));
    color: white;
    border: none;
}

.card .system-bubble {
    background-color: var(--hr-card-bg, #ffffff);
    border: 1px solid var(--hr-border, #dee2e6);
    color: var(--hr-text, #333);
}

/* –ó–∞–≥–æ–ª–æ–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π - –û–°–¢–ê–í–õ–Ø–ï–ú –º–µ–Ω—å—à–∏–º–∏ –¥–ª—è —Ä–∞–∑–ª–∏—á–∏—è */
.card .message-header {
    font-size: 0.7rem;
    margin-bottom: 4px;
    opacity: 0.8;
    font-weight: 500;
    line-height: 1.2;
}

.card .message-header i {
    font-size: 0.65rem;
    margin-right: 3px;
}

.card .message-header strong {
    font-weight: 600;
}

.card .message-header small {
    font-size: 0.65rem;
    margin-left: 6px;
}

/* –ö–õ–Æ–ß–ï–í–û–ï –ò–ó–ú–ï–ù–ï–ù–ò–ï: –∫–æ–Ω—Ç–µ–Ω—Ç —Å–æ–æ–±—â–µ–Ω–∏–π –û–î–ò–ù–ê–ö–û–í–û–ì–û —Ä–∞–∑–º–µ—Ä–∞ */
.card .message-content {
    line-height: 1.3;
    margin: 0;
    width: auto !important;
    max-width: none !important;
    min-width: fit-content !important;
    display: block !important;
    font-size: 1.1rem !important; /* –û–î–ò–ù–ê–ö–û–í–´–ô —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–º–∏ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏ */
}

/* –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç - —Å–æ—Ö—Ä–∞–Ω—è–µ–º –º–Ω–æ–≥–æ—Å—Ç—Ä–æ—á–Ω–æ—Å—Ç—å */
.card .user-content {
    white-space: pre-wrap;
    word-break: break-word;
}

/* –ö–æ–Ω—Ç–µ–Ω—Ç –±–æ—Ç–∞ –ë–ï–ó –û–ì–†–ê–ù–ò–ß–ï–ù–ò–ô */
.card .bot-content-fixed {
    display: block !important;
    width: auto !important;
    min-width: fit-content !important;
    max-width: none !important;
}

/* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –∏ –∫–Ω–æ–ø–∫–∞–º–∏ */
.card .message-body-with-buttons {
    display: flex;
    align-items: flex-start;
    gap: 12px;
    width: auto;
    min-width: fit-content;
}

.card .message-info {
    flex: 1;
    min-width: fit-content;
}

/* –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π –°–ü–†–ê–í–ê */
.card .action-buttons-right {
    display: flex;
    flex-direction: column;
    gap: 4px;
    flex-shrink: 0;
    align-self: flex-start;
    margin-top: 2px;
}

/* –¢–ê–ë–õ–ò–ß–ù–ê–Ø –°–¢–†–£–ö–¢–£–†–ê –¥–ª—è –≥–∞—Ä–∞–Ω—Ç–∏–∏ –æ–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏ */
.card .candidate-info-table {
    display: table;
    width: auto;
    min-width: fit-content;
    border-spacing: 0;
    border-collapse: collapse;
    margin-bottom: 6px;
}

.card .info-row-table {
    display: table-row;
}

/* –ö–õ–Æ–ß–ï–í–û–ï –ò–ó–ú–ï–ù–ï–ù–ò–ï: —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä –ª–µ–π–±–ª–æ–≤ */
.card .info-label-table {
    display: table-cell;
    font-weight: 600;
    color: var(--hr-text, #333);
    padding-right: 8px;
    white-space: nowrap;
    vertical-align: top;
    line-height: 1.3;
    font-size: 1.1rem !important; /* –£–í–ï–õ–ò–ß–ò–í–ê–ï–ú –¥–æ —Ä–∞–∑–º–µ—Ä–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π */
    min-width: 65px;
}

/* –ö–õ–Æ–ß–ï–í–û–ï –ò–ó–ú–ï–ù–ï–ù–ò–ï: —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä –∑–Ω–∞—á–µ–Ω–∏–π */
.card .info-value-table {
    display: table-cell;
    white-space: nowrap;
    vertical-align: top;
    line-height: 1.3;
    font-size: 1.1rem !important; /* –£–í–ï–õ–ò–ß–ò–í–ê–ï–ú –¥–æ —Ä–∞–∑–º–µ—Ä–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π */
}

/* –ö–õ–Æ–ß–ï–í–û–ï –ò–ó–ú–ï–ù–ï–ù–ò–ï: —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä —Å—Å—ã–ª–æ–∫ */
.card .info-link-compact {
    color: var(--color-primary, #007bff);
    text-decoration: none;
    font-size: 1.1rem !important; /* –£–í–ï–õ–ò–ß–ò–í–ê–ï–ú –¥–æ —Ä–∞–∑–º–µ—Ä–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π */
    white-space: nowrap;
}

.card .info-link-compact:hover {
    text-decoration: underline;
}

/* –ö–õ–Æ–ß–ï–í–û–ï –ò–ó–ú–ï–ù–ï–ù–ò–ï: —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä –±–µ–π–¥–∂–∞ */
.card .grade-badge-inline {
    background: linear-gradient(135deg, var(--color-primary, #007bff) 0%, var(--color-primary-hover, #0056b3) 100%);
    color: white;
    padding: 2px 8px; /* –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º padding –¥–ª—è –±–æ–ª—å—à–µ–≥–æ —Ç–µ–∫—Å—Ç–∞ */
    border-radius: 8px;
    font-size: 0.8rem !important; /* –£–í–ï–õ–ò–ß–ò–í–ê–ï–ú —Ä–∞–∑–º–µ—Ä –±–µ–π–¥–∂–∞ */
    font-weight: 500;
    white-space: nowrap;
}

/* –ö–õ–Æ–ß–ï–í–û–ï –ò–ó–ú–ï–ù–ï–ù–ò–ï: —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä —Å—Ç–∞—Ç—É—Å–∞ */
.card .status-message-compact {
    color: var(--color-success, #28a745);
    font-weight: 500;
    font-size: 1.1rem !important; /* –£–í–ï–õ–ò–ß–ò–í–ê–ï–ú –¥–æ —Ä–∞–∑–º–µ—Ä–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π */
    padding: 6px 10px; /* –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º padding –¥–ª—è –±–æ–ª—å—à–µ–≥–æ —Ç–µ–∫—Å—Ç–∞ */
    background: rgba(40, 167, 69, 0.1);
    border-radius: 6px;
    border-left: 2px solid var(--color-success, #28a745);
    margin-top: 4px;
    white-space: nowrap;
    display: inline-block;
    width: auto;
}

/* –°—Ç–∏–ª–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ —Å–ø—Ä–∞–≤–∞ - –æ—Å—Ç–∞–≤–ª—è–µ–º –ø—Ä–µ–∂–Ω–∏–º–∏ */
.card .action-buttons-right .btn {
    padding: 3px 6px !important;
    font-size: 1.2rem !important;
    border-radius: 4px !important;
    border-width: 1px !important;
    min-height: 28px !important;
    min-width: 28px !important;
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
}

.card .action-buttons-right .btn i {
    font-size: 0.85rem !important;
    margin: 0 !important;
}

/* –í—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π */
.card .user-message {
    display: flex;
    justify-content: flex-end;
    width: 100%;
}

.card .system-message {
    display: flex;
    justify-content: flex-start;
    width: 100%;
    max-width: none !important;
}

.card .user-message .message-bubble {
    border-bottom-right-radius: 3px;
}

.card .system-message .message-bubble {
    border-bottom-left-radius: 3px;
}

/* –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Ü–≤–µ—Ç–∞ –¥–ª—è —Ç–∏–ø–æ–≤ —Å–æ–æ–±—â–µ–Ω–∏–π */
.card .hr-screening-message .system-bubble {
    background: linear-gradient(135deg, rgba(76, 175, 80, 0.08) 0%, rgba(76, 175, 80, 0.03) 100%);
    border-color: rgba(76, 175, 80, 0.2);
}

.card .hr-screening-message .message-header {
    color: #2e7d32;
}

.card .invite-message .system-bubble {
    background: linear-gradient(135deg, rgba(255, 193, 7, 0.08) 0%, rgba(255, 193, 7, 0.03) 100%);
    border-color: rgba(255, 193, 7, 0.2);
}

.card .invite-message .message-header {
    color: #f57c00;
}

/* –§—É—Ç–µ—Ä –∫–∞—Ä—Ç–æ—á–∫–∏ */
.card .card-footer {
    padding: 12px !important;
    background-color: var(--hr-card-bg, #ffffff);
    border-top: 1px solid var(--hr-border, #dee2e6);
}

.card #id_message {
    border-radius: 18px 0 0 18px;
    min-height: 48px !important;
    max-height: 576px !important; /* 12 —Å—Ç—Ä–æ–∫ * 48px */
    overflow-y: auto;
    border-right: none;
    padding: 8px 12px;
    font-size: 1.1rem; /* –¢–ê–ö–û–ô –ñ–ï —Ä–∞–∑–º–µ—Ä –∫–∞–∫ –∏ –≤ —Å–æ–æ–±—â–µ–Ω–∏—è—Ö */
    resize: none;
}

.card #send-btn {
    border-radius: 0 18px 18px 0;
    padding: 8px 12px;
    min-height: 36px;
}

/* –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∫–∞—Ä—Ç–æ—á–∫–∏ */
.card .card-header {
    padding: 12px 16px !important;
    background: var(--hr-gradient, linear-gradient(135deg, #007bff 0%, #0056b3 100%));
    border-bottom: 1px solid var(--hr-border, #dee2e6);
}

.card .card-header h6 {
    margin: 0 !important;
    font-size: 1.1rem !important;
    color: white !important;
}

.card .card-header .badge {
    font-size: 0.65rem !important;
    padding: 2px 6px !important;
    margin-left: 6px !important;
}

/* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö - —Å–æ—Ö—Ä–∞–Ω—è–µ–º –ø—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å */
@media (max-width: 768px) {
    .card .message-bubble {
        max-width: 95%;
        padding: 6px 10px;
        font-size: 0.85rem !important; /* –ù–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —á—É—Ç—å –º–µ–Ω—å—à–µ, –Ω–æ –æ–¥–∏–Ω–∞–∫–æ–≤–æ */
    }
    
    .card .system-message .message-bubble {
        min-width: 200px;
        max-width: 95%;
    }
    
    .card .message-content {
        font-size: 0.85rem !important; /* –ù–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —á—É—Ç—å –º–µ–Ω—å—à–µ, –Ω–æ –æ–¥–∏–Ω–∞–∫–æ–≤–æ */
    }
    
    .card .message-body-with-buttons {
        flex-direction: column;
        gap: 6px;
    }
    
    .card .action-buttons-right {
        flex-direction: row;
        align-self: stretch;
        justify-content: flex-end;
    }
    
    .card .info-label-table {
        min-width: 55px;
        font-size: 0.85rem !important; /* –ù–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —á—É—Ç—å –º–µ–Ω—å—à–µ, –Ω–æ –æ–¥–∏–Ω–∞–∫–æ–≤–æ */
    }
    
    .card .info-value-table {
        font-size: 0.85rem !important; /* –ù–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —á—É—Ç—å –º–µ–Ω—å—à–µ, –Ω–æ –æ–¥–∏–Ω–∞–∫–æ–≤–æ */
    }
    
    .card .info-link-compact {
        font-size: 0.85rem !important; /* –ù–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —á—É—Ç—å –º–µ–Ω—å—à–µ, –Ω–æ –æ–¥–∏–Ω–∞–∫–æ–≤–æ */
    }
    
    .card .status-message-compact {
        font-size: 0.85rem !important; /* –ù–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —á—É—Ç—å –º–µ–Ω—å—à–µ, –Ω–æ –æ–¥–∏–Ω–∞–∫–æ–≤–æ */
        padding: 4px 8px;
    }
    
    .card .grade-badge-inline {
        font-size: 0.75rem !important;
        padding: 1px 6px;
    }
    
    .card .action-buttons-right .btn {
        padding: 2px 5px !important;
        font-size: 0.65rem !important;
        min-width: 24px !important;
    }
    
    .card #id_message {
        font-size: 0.85rem; /* –ù–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —Ç–æ–∂–µ –º–µ–Ω—å—à–µ, –Ω–æ –æ–¥–∏–Ω–∞–∫–æ–≤–æ */
    }
}

/* –ê–Ω–∏–º–∞—Ü–∏–∏ */
.card .message {
    animation: messageSlideIn 0.2s ease-out;
}

@keyframes messageSlideIn {
    from {
        opacity: 0;
        transform: translateY(8px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* –°–∫—Ä–æ–ª–ª–±–∞—Ä */
.card .chat-messages::-webkit-scrollbar {
    width: 4px;
}

.card .chat-messages::-webkit-scrollbar-track {
    background: var(--hr-border, #dee2e6);
    border-radius: 2px;
}

.card .chat-messages::-webkit-scrollbar-thumb {
    background: var(--hr-primary, #007bff);
    border-radius: 2px;
}

.card .chat-messages::-webkit-scrollbar-thumb:hover {
    background: var(--hr-primary-hover, #0056b3);
}

/* –¢–µ–º–Ω–∞—è —Ç–µ–º–∞ */
[data-theme="dark"] .card .hr-screening-message .system-bubble {
    background: linear-gradient(135deg, rgba(76, 175, 80, 0.12) 0%, rgba(76, 175, 80, 0.06) 100%);
    border-color: rgba(76, 175, 80, 0.3);
}

[data-theme="dark"] .card .hr-screening-message .message-header {
    color: #81c784;
}

[data-theme="dark"] .card .invite-message .system-bubble {
    background: linear-gradient(135deg, rgba(255, 193, 7, 0.12) 0%, rgba(255, 193, 7, 0.06) 100%);
    border-color: rgba(255, 193, 7, 0.3);
}

 [data-theme="dark"] .card .invite-message .message-header {
     color: #ffb300;
 }

 /* === –°–¢–ò–õ–ò –î–õ–Ø –°–ü–ò–°–ö–ê –°–ï–°–°–ò–ô === */
 .card .sessions-list {
     background-color: var(--hr-card-bg, #ffffff);
 }

 .card .session-item {
     border-bottom: 1px solid var(--hr-border, #dee2e6);
     transition: background-color 0.2s ease;
 }

 .card .session-item:last-child {
     border-bottom: none;
 }

 .card .session-item:hover {
     background-color: var(--hr-hover-bg, #f8f9fa);
 }

 .card .session-item.active {
     background-color: var(--hr-primary-light, rgba(0, 123, 255, 0.1));
     border-left: 3px solid var(--hr-primary, #007bff);
 }

 .card .session-link {
     display: block;
     padding: 12px 16px;
     text-decoration: none;
     color: inherit;
 }

 .card .session-link:hover {
     text-decoration: none;
     color: inherit;
 }

 .card .session-header {
     display: flex;
     justify-content: space-between;
     align-items: center;
     margin-bottom: 6px;
 }

 .card .session-info {
     display: flex;
     align-items: center;
     gap: 8px;
 }

 .card .session-id {
     font-weight: 600;
     font-size: 0.9rem;
     color: var(--hr-primary, #007bff);
 }

 .card .session-date {
     font-size: 0.75rem;
     color: var(--hr-text-muted, #6c757d);
 }

 .card .session-status {
     display: flex;
     align-items: center;
 }

 .card .session-preview {
     font-size: 0.8rem;
     line-height: 1.3;
 }

 .card .session-last-message {
     color: var(--hr-text, #333);
     display: block;
     overflow: hidden;
     text-overflow: ellipsis;
     white-space: nowrap;
 }

 .card .session-empty {
     font-size: 0.8rem;
     font-style: italic;
 }

 /* –¢–µ–º–Ω–∞—è —Ç–µ–º–∞ –¥–ª—è —Å–ø–∏—Å–∫–∞ —Å–µ—Å—Å–∏–π */
 [data-theme="dark"] .card .session-item:hover {
     background-color: var(--color-surface-hover, #2d3748);
 }

 [data-theme="dark"] .card .session-item.active {
     background-color: rgba(0, 123, 255, 0.15);
 }

 [data-theme="dark"] .card .session-last-message {
     color: var(--color-text, #e2e8f0);
 }

 [data-theme="dark"] .card .session-empty {
     color: var(--color-text-muted, #a0aec0);
 }

 /* –°–∫—Ä–æ–ª–ª–±–∞—Ä –¥–ª—è —Å–ø–∏—Å–∫–∞ —Å–µ—Å—Å–∏–π */
 .card .sessions-list::-webkit-scrollbar {
     width: 4px;
 }

 .card .sessions-list::-webkit-scrollbar-track {
     background: var(--hr-border, #dee2e6);
     border-radius: 2px;
 }

 .card .sessions-list::-webkit-scrollbar-thumb {
     background: var(--hr-primary, #007bff);
     border-radius: 2px;
 }

 .card .sessions-list::-webkit-scrollbar-thumb:hover {
     background: var(--hr-primary-hover, #0056b3);
 }

 /* === –°–¢–ò–õ–ò –î–õ–Ø –°–ï–õ–ï–ö–¢–û–†–ê –í–ê–ö–ê–ù–°–ò–ò –ò –°–õ–û–¢–û–í === */
 .vacancy-selector {
     background: var(--hr-card-bg, #ffffff);
     border: 1px solid var(--hr-border, #dee2e6);
     border-radius: 12px;
     padding: 20px;
     margin-bottom: 20px;
 }

 .automation-card {
     background: var(--hr-surface, #f8f9fa);
     border: 1px solid var(--hr-border, #dee2e6);
     border-radius: 8px;
     padding: 15px;
 }

 .copy-buttons {
     margin-top: 10px;
 }

 .btn-copy {
     background: var(--hr-primary, #007bff);
     color: white;
     border: none;
     border-radius: 6px;
     padding: 8px 12px;
     font-size: 0.9rem;
     cursor: pointer;
     transition: all 0.2s ease;
     position: relative;
     display: inline-flex;
     align-items: center;
     gap: 6px;
 }

 .btn-copy:hover {
     background: var(--hr-primary-hover, #0056b3);
        transform: translateY(-1px);
 }

 .btn-copy:disabled {
     background: var(--hr-secondary, #6c757d);
     cursor: not-allowed;
     transform: none;
 }

 .flag-emoji {
     font-size: 12px;
     line-height: 1;
 }

 .copy-tooltip {
     position: absolute;
     bottom: 100%;
     left: 50%;
     transform: translateX(-50%);
     background: var(--hr-dark, #333);
     color: white;
     padding: 4px 8px;
     border-radius: 4px;
     font-size: 0.75rem;
     white-space: nowrap;
     opacity: 0;
     visibility: hidden;
     transition: all 0.2s ease;
     z-index: 1000;
     margin-bottom: 5px;
 }

 .btn-copy:hover .copy-tooltip {
     opacity: 1;
     visibility: visible;
 }

 .general-card {
     background: var(--hr-card-bg, #ffffff);
     border: 1px solid var(--hr-border, #dee2e6);
     border-radius: 12px;
     padding: 20px;
     margin-bottom: 20px;
 }

 .week-section {
     margin-bottom: 20px;
 }

 .slot-card {
     background: var(--hr-surface, #f8f9fa);
     border: 1px solid var(--hr-border, #dee2e6);
     transition: all 0.2s ease;
 }

 .slot-card:hover {
     transform: translateY(-2px);
     box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
 }

 .btn-collapse {
     background: transparent;
     border: 1px solid var(--hr-border, #dee2e6);
     color: var(--hr-text, #333);
     border-radius: 4px;
     padding: 4px 8px;
     font-size: 0.8rem;
     transition: all 0.2s ease;
 }

 .btn-collapse:hover {
     background: var(--hr-surface, #f8f9fa);
     border-color: var(--hr-primary, #007bff);
     color: var(--hr-primary, #007bff);
 }

 /* –¢–µ–º–Ω–∞—è —Ç–µ–º–∞ –¥–ª—è –Ω–æ–≤—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ */
 [data-theme="dark"] .vacancy-selector {
     background: var(--color-surface, #2d3748);
     border-color: var(--color-border, #4a5568);
 }

 [data-theme="dark"] .automation-card {
     background: var(--color-surface-hover, #374151);
     border-color: var(--color-border, #4a5568);
 }

 [data-theme="dark"] .general-card {
     background: var(--color-surface, #2d3748);
     border-color: var(--color-border, #4a5568);
 }

 [data-theme="dark"] .slot-card {
     background: var(--color-surface-hover, #374151);
     border-color: var(--color-border, #4a5568);
 }

 [data-theme="dark"] .btn-collapse {
     background: transparent;
     border-color: var(--color-border, #4a5568);
     color: var(--color-text, #e2e8f0);
 }

 [data-theme="dark"] .btn-collapse:hover {
     background: var(--color-surface-hover, #374151);
     border-color: var(--color-primary, #3182ce);
     color: var(--color-primary, #3182ce);
 }

 /* === –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –°–¢–ò–õ–ò –î–õ–Ø –ö–ù–û–ü–û–ö –ö–û–ü–ò–†–û–í–ê–ù–ò–Ø === */
 .copy-buttons .btn-copy {
     width: 40px !important;
     height: 40px !important;
     border-radius: 50% !important;
     border: none !important;
     display: flex !important;
     align-items: center !important;
     justify-content: center !important;
     font-size: 16px !important;
     transition: all 0.3s ease !important;
     cursor: pointer !important;
     position: relative !important;
     margin: 2px !important;
 }

 .copy-buttons .btn-copy-belarus {
     background: linear-gradient(135deg, #ff6b6b, #ee5a24) !important;
     color: white !important;
     border: 2px solid #fff !important;
     box-shadow: 0 2px 8px rgba(255, 107, 107, 0.3) !important;
 }

 .copy-buttons .btn-copy-belarus:hover {
     background: linear-gradient(135deg, #ee5a24, #d63031) !important;
     box-shadow: 0 4px 15px rgba(255, 107, 107, 0.5) !important;
     transform: scale(1.1) !important;
 }

 .copy-buttons .btn-copy-poland {
     background: linear-gradient(135deg, #4834d4, #686de0) !important;
     color: white !important;
     border: 2px solid #fff !important;
     box-shadow: 0 2px 8px rgba(72, 52, 212, 0.3) !important;
 }

 .copy-buttons .btn-copy-poland:hover {
     background: linear-gradient(135deg, #686de0, #5f3dc4) !important;
     box-shadow: 0 4px 15px rgba(72, 52, 212, 0.5) !important;
     transform: scale(1.1) !important;
 }

 .copy-buttons .btn-copy-vacancy-link-belarus {
     background: linear-gradient(135deg, #e74c3c, #c0392b) !important;
     color: white !important;
     border: 2px solid #fff !important;
     box-shadow: 0 2px 8px rgba(231, 76, 60, 0.3) !important;
 }

 .copy-buttons .btn-copy-vacancy-link-belarus:hover {
     background: linear-gradient(135deg, #c0392b, #a93226) !important;
     box-shadow: 0 4px 15px rgba(231, 76, 60, 0.5) !important;
     transform: scale(1.1) !important;
 }

 .copy-buttons .btn-copy-vacancy-link-poland {
     background: linear-gradient(135deg, #f39c12, #e67e22) !important;
     color: white !important;
     border: 2px solid #fff !important;
     box-shadow: 0 2px 8px rgba(243, 156, 18, 0.3) !important;
 }

 .copy-buttons .btn-copy-vacancy-link-poland:hover {
     background: linear-gradient(135deg, #e67e22, #d35400) !important;
     box-shadow: 0 4px 15px rgba(243, 156, 18, 0.5) !important;
     transform: scale(1.1) !important;
 }

 .copy-buttons .btn-copy-current-week {
     background: linear-gradient(135deg, #fd79a8, #e84393) !important;
     color: white !important;
     border: 2px solid #fff !important;
     box-shadow: 0 2px 8px rgba(253, 121, 168, 0.3) !important;
 }

 .copy-buttons .btn-copy-current-week:hover {
     background: linear-gradient(135deg, #e84393, #d63031) !important;
     box-shadow: 0 4px 15px rgba(253, 121, 168, 0.5) !important;
     transform: scale(1.1) !important;
 }

 .copy-buttons .btn-copy-next-week {
     background: linear-gradient(135deg, #0984e3, #74b9ff) !important;
     color: white !important;
     border: 2px solid #fff !important;
     box-shadow: 0 2px 8px rgba(9, 132, 227, 0.3) !important;
 }

 .copy-buttons .btn-copy-next-week:hover {
     background: linear-gradient(135deg, #74b9ff, #0984e3) !important;
     box-shadow: 0 4px 15px rgba(9, 132, 227, 0.5) !important;
     transform: scale(1.1) !important;
 }

 .copy-buttons .btn-copy-all-slots {
     background: linear-gradient(135deg, #6c5ce7, #a29bfe) !important;
     color: white !important;
     border: 2px solid #fff !important;
     box-shadow: 0 2px 8px rgba(108, 92, 231, 0.3) !important;
 }

 .copy-buttons .btn-copy-all-slots:hover {
     background: linear-gradient(135deg, #a29bfe, #6c5ce7) !important;
     box-shadow: 0 4px 15px rgba(108, 92, 231, 0.5) !important;
     transform: scale(1.1) !important;
 }

 .copy-buttons .btn-refresh-slots {
     background: linear-gradient(135deg, #17a2b8, #138496) !important;
     color: white !important;
     border: 2px solid #fff !important;
     box-shadow: 0 2px 8px rgba(23, 162, 184, 0.3) !important;
 }

 .copy-buttons .btn-refresh-slots:hover {
     background: linear-gradient(135deg, #138496, #0f6674) !important;
     box-shadow: 0 4px 15px rgba(23, 162, 184, 0.5) !important;
     transform: scale(1.1) !important;
 }

 .copy-buttons .btn-copy:disabled {
     opacity: 0.4 !important;
     cursor: not-allowed !important;
     transform: none !important;
     filter: grayscale(0.8) !important;
     background: linear-gradient(135deg, #6c757d, #495057) !important;
     border: 2px solid #6c757d !important;
     box-shadow: 0 2px 4px rgba(108, 117, 125, 0.2) !important;
 }

 .copy-buttons .btn-copy:disabled:hover {
     transform: none !important;
     box-shadow: 0 2px 4px rgba(108, 117, 125, 0.2) !important;
     filter: grayscale(0.8) !important;
 }

 .copy-buttons .btn-copy .copy-tooltip {
     position: absolute !important;
     bottom: -35px !important;
     left: 50% !important;
     transform: translateX(-50%) !important;
     background: rgba(0, 0, 0, 0.8) !important;
     color: white !important;
     padding: 5px 10px !important;
     border-radius: 5px !important;
     font-size: 12px !important;
     white-space: nowrap !important;
     opacity: 0 !important;
     transition: opacity 0.3s ease !important;
     pointer-events: none !important;
     z-index: 1000 !important;
 }

 .copy-buttons .btn-copy:hover .copy-tooltip {
     opacity: 1 !important;
 }

 .copy-buttons .btn-copy .flag-emoji {
     font-size: 12px !important;
     line-height: 1 !important;
     background: rgba(230, 230, 230, 0.15) !important;
     border-radius: 50% !important;
     padding: 2px !important;
     box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2) !important;
     border: 1px solid rgba(0, 0, 0, 0.1) !important;
     display: inline-block !important;
     line-height: 1 !important;
     min-width: 21px !important;
     min-height: 21px !important;
     text-align: center !important;
     margin-top: 7px !important;
     margin-left: -7px !important;
 }

 /* –°—Ç–∏–ª–∏ –¥–ª—è —É—Å–ø–µ—à–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è */
 .copy-buttons .btn-copy.copy-success {
     background: linear-gradient(135deg, #00b894, #00cec9) !important;
 }

 .copy-buttons .btn-copy.copy-success:hover {
     background: linear-gradient(135deg, #00b894, #00cec9) !important;
     transform: scale(1.1) !important;
 }

 /* –¢–µ–º–Ω–∞—è —Ç–µ–º–∞ –¥–ª—è –∫–Ω–æ–ø–æ–∫ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è */
 [data-theme="dark"] .copy-buttons .btn-copy-vacancy-link-belarus {
     background: linear-gradient(135deg, #ff4757, #ff3742) !important;
     border: 2px solid #2c2c2c !important;
     box-shadow: 0 2px 8px rgba(255, 71, 87, 0.4) !important;
 }

 [data-theme="dark"] .copy-buttons .btn-copy-vacancy-link-belarus:hover {
     background: linear-gradient(135deg, #ff3742, #ff2f3a) !important;
     box-shadow: 0 4px 15px rgba(255, 71, 87, 0.6) !important;
 }

 [data-theme="dark"] .copy-buttons .btn-copy-vacancy-link-poland {
     background: linear-gradient(135deg, #ffa502, #ff9500) !important;
     border: 2px solid #2c2c2c !important;
     box-shadow: 0 2px 8px rgba(255, 165, 2, 0.4) !important;
 }

 [data-theme="dark"] .copy-buttons .btn-copy-vacancy-link-poland:hover {
     background: linear-gradient(135deg, #ff9500, #ff8c00) !important;
     box-shadow: 0 4px 15px rgba(255, 165, 2, 0.6) !important;
 }

 [data-theme="dark"] .copy-buttons .btn-copy-belarus {
     background: linear-gradient(135deg, #ff6b6b, #ee5a24) !important;
     border: 2px solid #2c2c2c !important;
     box-shadow: 0 2px 8px rgba(255, 107, 107, 0.4) !important;
 }

 [data-theme="dark"] .copy-buttons .btn-copy-belarus:hover {
     background: linear-gradient(135deg, #ee5a24, #d63031) !important;
     box-shadow: 0 4px 15px rgba(255, 107, 107, 0.6) !important;
 }

 [data-theme="dark"] .copy-buttons .btn-copy-poland {
     background: linear-gradient(135deg, #4834d4, #686de0) !important;
     border: 2px solid #2c2c2c !important;
     box-shadow: 0 2px 8px rgba(72, 52, 212, 0.4) !important;
 }

 [data-theme="dark"] .copy-buttons .btn-copy-poland:hover {
     background: linear-gradient(135deg, #686de0, #5f3dc4) !important;
     box-shadow: 0 4px 15px rgba(72, 52, 212, 0.6) !important;
 }

 [data-theme="dark"] .copy-buttons .btn-copy-current-week {
     background: linear-gradient(135deg, #fd79a8, #e84393) !important;
     border: 2px solid #2c2c2c !important;
     box-shadow: 0 2px 8px rgba(253, 121, 168, 0.4) !important;
 }

 [data-theme="dark"] .copy-buttons .btn-copy-current-week:hover {
     background: linear-gradient(135deg, #e84393, #d63031) !important;
     box-shadow: 0 4px 15px rgba(253, 121, 168, 0.6) !important;
 }

 [data-theme="dark"] .copy-buttons .btn-copy-next-week {
     background: linear-gradient(135deg, #0984e3, #74b9ff) !important;
     border: 2px solid #2c2c2c !important;
     box-shadow: 0 2px 8px rgba(9, 132, 227, 0.4) !important;
 }

 [data-theme="dark"] .copy-buttons .btn-copy-next-week:hover {
     background: linear-gradient(135deg, #74b9ff, #0984e3) !important;
     box-shadow: 0 4px 15px rgba(9, 132, 227, 0.6) !important;
 }

 [data-theme="dark"] .copy-buttons .btn-copy-all-slots {
     background: linear-gradient(135deg, #6c5ce7, #a29bfe) !important;
     border: 2px solid #2c2c2c !important;
     box-shadow: 0 2px 8px rgba(108, 92, 231, 0.4) !important;
 }

 [data-theme="dark"] .copy-buttons .btn-copy-all-slots:hover {
     background: linear-gradient(135deg, #a29bfe, #6c5ce7) !important;
     box-shadow: 0 4px 15px rgba(108, 92, 231, 0.6) !important;
 }

 [data-theme="dark"] .copy-buttons .btn-refresh-slots {
     background: linear-gradient(135deg, #17a2b8, #138496) !important;
     border: 2px solid #2c2c2c !important;
     box-shadow: 0 2px 8px rgba(23, 162, 184, 0.4) !important;
 }

 [data-theme="dark"] .copy-buttons .btn-refresh-slots:hover {
     background: linear-gradient(135deg, #138496, #0f6674) !important;
     box-shadow: 0 4px 15px rgba(23, 162, 184, 0.6) !important;
 }

 [data-theme="dark"] .copy-buttons .btn-copy:disabled {
     opacity: 0.3 !important;
     background: linear-gradient(135deg, #495057, #343a40) !important;
     border: 2px solid #495057 !important;
     box-shadow: 0 2px 4px rgba(73, 80, 87, 0.3) !important;
 }

 [data-theme="dark"] .copy-buttons .btn-copy:disabled:hover {
     transform: none !important;
     box-shadow: 0 2px 4px rgba(73, 80, 87, 0.3) !important;
 }

 [data-theme="dark"] .copy-buttons .btn-copy.copy-success {
     background: linear-gradient(135deg, #00b894, #00cec9) !important;
     border: 2px solid #2c2c2c !important;
     box-shadow: 0 4px 15px rgba(0, 184, 148, 0.6) !important;
}

/* === –°–¢–ò–õ–ò –î–õ–Ø –ë–õ–û–ö–ê –ö–û–ú–ê–ù–î === */
.commands-list {
    font-size: 0.9rem;
}

.command-item {
    border-left: 3px solid var(--hr-border, #dee2e6);
    padding-left: 12px;
    transition: all 0.2s ease;
}

.command-item:hover {
    border-left-color: var(--hr-primary, #007bff);
    background-color: rgba(0, 123, 255, 0.05);
    border-radius: 4px;
    padding: 8px 12px;
    margin: -8px -12px;
}

.command-header {
    display: flex;
    align-items: center;
    margin-bottom: 4px;
}

.command-badge {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 24px;
    height: 24px;
    border-radius: 4px;
    font-size: 0.75rem;
    font-weight: 600;
    color: white;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
}

.command-description {
    line-height: 1.4;
}

.command-example {
    background-color: var(--hr-surface, #f8f9fa);
    border: 1px solid var(--hr-border, #dee2e6);
    border-radius: 4px;
    padding: 6px 8px;
    font-family: 'Courier New', monospace;
    word-break: break-all;
}

.command-example code {
    background: none;
    padding: 0;
    color: var(--hr-primary, #007bff);
    font-size: 0.8rem;
}

/* –¢–µ–º–Ω–∞—è —Ç–µ–º–∞ –¥–ª—è –∫–æ–º–∞–Ω–¥ */
[data-theme="dark"] .command-item:hover {
    background-color: rgba(0, 123, 255, 0.1);
}

[data-theme="dark"] .command-example {
    background-color: var(--color-surface-hover, #374151);
    border-color: var(--color-border, #4a5568);
}

[data-theme="dark"] .command-example code {
    color: var(--color-primary, #3182ce);
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const chatMessages = document.getElementById('chat-messages');
    const chatForm = document.getElementById('chat-form');
    const messageInput = document.getElementById('id_message');
    const sendBtn = document.getElementById('send-btn');
    
    // –ü—Ä–æ–∫—Ä—É—Ç–∫–∞ –≤–Ω–∏–∑ —á–∞—Ç–∞ (–±–µ–∑ —Å–∫—Ä–æ–ª–ª–∞ –≤—Å–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã)
    function scrollToBottom() {
        if (chatMessages) {
        chatMessages.scrollTop = chatMessages.scrollHeight;
        }
    }
    
    // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º —á–∞—Ç –∫ –ø–æ—Å–ª–µ–¥–Ω–∏–º —Å–æ–æ–±—â–µ–Ω–∏—è–º –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ (—Ç–æ–ª—å–∫–æ –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ —á–∞—Ç–∞)
    setTimeout(() => {
    scrollToBottom();
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Ä–∞–∑–º–µ—Ä textarea –≤ –æ–¥–Ω—É —Å—Ç—Ä–æ–∫—É
        resetTextareaSize();
    }, 100);
    
    // –û—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–æ—Ä–º—ã
    chatForm.addEventListener('submit', function(e) {
        if (!messageInput.value.trim()) {
            e.preventDefault();
            return;
        }
        
        sendBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
        sendBtn.disabled = true;
        messageInput.disabled = true;
        
        // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä textarea –ø–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏
        setTimeout(() => {
            resetTextareaSize();
        }, 100);
    });
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–±—Ä–æ—Å–∞ —Ä–∞–∑–º–µ—Ä–∞ textarea –∫ –æ–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–µ
    function resetTextareaSize() {
        messageInput.style.height = 'auto';
        messageInput.style.height = '48px'; // –í—ã—Å–æ—Ç–∞ –æ–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏
        messageInput.scrollTop = 0;
    }
    
    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ textarea (1-12 —Å—Ç—Ä–æ–∫)
    messageInput.addEventListener('input', function() {
        this.style.height = 'auto';
        const maxHeight = 48 * 12; // 12 —Å—Ç—Ä–æ–∫ * 48px –Ω–∞ —Å—Ç—Ä–æ–∫—É
        const newHeight = Math.min(this.scrollHeight, maxHeight);
        this.style.height = newHeight + 'px';
    });
    
    // –û—Ç–ø—Ä–∞–≤–∫–∞ –ø–æ Enter (–±–µ–∑ Shift)
    messageInput.addEventListener('keydown', function(e) {
        if (e.key === 'Enter' && !e.shiftKey) {
            e.preventDefault();
            chatForm.submit();
        }
    });
    
    // –§–æ–∫—É—Å –Ω–∞ –ø–æ–ª–µ –≤–≤–æ–¥–∞ (—É–±–∏—Ä–∞–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ñ–æ–∫—É—Å –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ)
    // messageInput.focus();
    
    // –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –∏–Ω–≤–∞–π—Ç–∞
    document.addEventListener('click', function(e) {
        if (e.target.closest('.copy-invitation-btn')) {
            e.preventDefault();
            const btn = e.target.closest('.copy-invitation-btn');
            const inviteId = btn.getAttribute('data-invite-id');
            const originalText = btn.innerHTML;
            
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
            btn.disabled = true;
            
            fetch(`/google-oauth/invites/${inviteId}/invitation-text/`, {
                method: 'POST',
                headers: {
                    'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
                    'Content-Type': 'application/json',
                },
            })
            .then(response => response.json())
            .then(data => {
                if (data.success && data.invitation_text) {
                    navigator.clipboard.writeText(data.invitation_text).then(() => {
                        btn.innerHTML = '<i class="fas fa-check"></i>';
                        btn.classList.remove('btn-outline-warning');
                        btn.classList.add('btn-success');
                        
                        setTimeout(() => {
                            btn.innerHTML = originalText;
                            btn.classList.remove('btn-success');
                            btn.classList.add('btn-outline-warning');
                            btn.disabled = false;
                        }, 1500);
                    }).catch(err => {
                        console.error('Clipboard error:', err);
                        alert('–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞');
                        btn.innerHTML = originalText;
                        btn.disabled = false;
                    });
                } else {
                    alert('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞ –∏–Ω–≤–∞–π—Ç–∞');
                    btn.innerHTML = originalText;
                    btn.disabled = false;
                }
            })
            .catch(error => {
                console.error('Fetch error:', error);
                alert('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏');
                btn.innerHTML = originalText;
                btn.disabled = false;
            });
        }
    });
});

</script>

{{ calendar_events_data|json_script:"calendar-events" }}

<!-- –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–ª—è —Å–æ–±—ã—Ç–∏–π –∫–∞–ª–µ–Ω–¥–∞—Ä—è -->
<script>
console.log('üîç DEBUG: calendar_events_data –∏–∑ Django:', {{ calendar_events_data|safe }});
console.log('üîç DEBUG: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–±—ã—Ç–∏–π:', {{ calendar_events_data|length }});
</script>

{% if selected_vacancy %}
<script type="application/json" id="vacancy-data">
{
    "vacancy_link_belarus": "{{ selected_vacancy.vacancy_link_belarus|escapejs }}",
    "vacancy_link_poland": "{{ selected_vacancy.vacancy_link_poland|escapejs }}",
    "questions_belarus": "{{ selected_vacancy.questions_belarus|escapejs }}",
    "questions_poland": "{{ selected_vacancy.questions_poland|escapejs }}"
}
</script>

<!-- –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
<script>
console.log('üîç DEBUG: –í—ã–±—Ä–∞–Ω–Ω–∞—è –≤–∞–∫–∞–Ω—Å–∏—è:', {
    id: {{ selected_vacancy.id }},
    name: "{{ selected_vacancy.name|escapejs }}",
    vacancy_link_belarus: "{{ selected_vacancy.vacancy_link_belarus|escapejs }}",
    vacancy_link_poland: "{{ selected_vacancy.vacancy_link_poland|escapejs }}",
    questions_belarus: "{{ selected_vacancy.questions_belarus|escapejs }}",
    questions_poland: "{{ selected_vacancy.questions_poland|escapejs }}"
});
</script>
{% else %}
<script>
console.log('‚ö†Ô∏è DEBUG: –í–∞–∫–∞–Ω—Å–∏—è –Ω–µ –≤—ã–±—Ä–∞–Ω–∞');
</script>
{% endif %}

<script type="application/json" id="slots-settings-data">
{{ slots_settings.to_dict|default:"{}"|safe }}
</script>

<!-- –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Å–ª–æ—Ç–æ–≤ -->
<script>
console.log('üîç DEBUG: slots_settings.to_dict:', {{ slots_settings.to_dict|default:"{}"|safe }});
</script>

<script>
// –î–∞–Ω–Ω—ã–µ —Å–æ–±—ã—Ç–∏–π –∏–∑ Django –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ (–∫–∞–∫ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –∫–∞–ª–µ–Ω–¥–∞—Ä—è)
console.log('üîç DEBUG: –ù–∞—á–∏–Ω–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É —Å–æ–±—ã—Ç–∏–π...');
console.log('üîç DEBUG: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–±—ã—Ç–∏–π –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ:', {{ calendar_events_data|length|default:"0" }});

// –ó–∞–≥—Ä—É–∂–∞–µ–º —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Å–æ–±—ã—Ç–∏–π
const calendarEvents = JSON.parse(document.getElementById('calendar-events').textContent);
console.log('üîç DEBUG: –ó–∞–≥—Ä—É–∂–µ–Ω—ã —Ä–µ–∞–ª—å–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ:', calendarEvents.length);

// –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–ª–æ—Ç–æ–≤ –∏–∑ Django –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
let slotsSettings = {{ slots_settings.to_dict|default:"{}"|safe }};
console.log('üîç DEBUG: –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–ª–æ—Ç–æ–≤:', slotsSettings);

console.log('üìä –ó–∞–≥—Ä—É–∂–µ–Ω–æ —Å–æ–±—ã—Ç–∏–π –∫–∞–ª–µ–Ω–¥–∞—Ä—è:', calendarEvents.length);
console.log('üîç DEBUG: –ü–µ—Ä–≤–æ–µ —Å–æ–±—ã—Ç–∏–µ:', calendarEvents[0]);
console.log('üîç DEBUG: –í—Å–µ —Å–æ–±—ã—Ç–∏—è:', calendarEvents);

{% if selected_vacancy %}
window.vacancyLinkBelarus = "{{ selected_vacancy.vacancy_link_belarus|escapejs }}";
window.vacancyLinkPoland = "{{ selected_vacancy.vacancy_link_poland|escapejs }}";
window.questionsBelarus = "{{ selected_vacancy.questions_belarus|escapejs }}";
window.questionsPoland = "{{ selected_vacancy.questions_poland|escapejs }}";
{% endif %}
</script>

            <script src="{% static 'js/vacancy-slots.js' %}"></script>
            
            <script>
            // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –∫–∞—Ä—Ç–æ—á–∫–∏ —Å–ª–æ—Ç–æ–≤ –ø–æ –∫–ª–∏–∫—É –Ω–∞ –±–µ–π–¥–∂
            function toggleSlotsCard() {
                console.log('üîÑ toggleSlotsCard –≤—ã–∑–≤–∞–Ω–∞');
                const slotsCardBody = document.getElementById('slotsCardBody');
                const collapseButton = document.querySelector('[data-bs-target="#slotsCardBody"]');
                
                console.log('üîç slotsCardBody –Ω–∞–π–¥–µ–Ω:', !!slotsCardBody);
                console.log('üîç collapseButton –Ω–∞–π–¥–µ–Ω:', !!collapseButton);
                console.log('üîç slotsCardBody —ç–ª–µ–º–µ–Ω—Ç:', slotsCardBody);
                
                if (slotsCardBody) {
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
                    const isCollapsed = slotsCardBody.classList.contains('collapse') && !slotsCardBody.classList.contains('show');
                    console.log('üîç –ö–∞—Ä—Ç–æ—á–∫–∞ —Å–≤–µ—Ä–Ω—É—Ç–∞:', isCollapsed);
                    
                    // –ü—Ä–æ–±—É–µ–º Bootstrap Collapse
                    if (typeof bootstrap !== 'undefined' && bootstrap.Collapse) {
                        const bsCollapse = new bootstrap.Collapse(slotsCardBody, {
                            toggle: true
                        });
                        console.log('‚úÖ Bootstrap Collapse –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
                    } else {
                        // –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Å–ø–æ—Å–æ–± –±–µ–∑ Bootstrap
                        console.log('‚ö†Ô∏è Bootstrap –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ–º –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Å–ø–æ—Å–æ–±');
                        if (slotsCardBody.classList.contains('show')) {
                            slotsCardBody.classList.remove('show');
                            slotsCardBody.style.display = 'none';
                        } else {
                            slotsCardBody.classList.add('show');
                            slotsCardBody.style.display = 'block';
                        }
                        console.log('‚úÖ –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ');
                    }
                } else {
                    console.error('‚ùå –≠–ª–µ–º–µ–Ω—Ç slotsCardBody –Ω–µ –Ω–∞–π–¥–µ–Ω!');
                }
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç–∏–ª–∏ –¥–ª—è –∫–ª–∏–∫–∞–±–µ–ª—å–Ω–æ–≥–æ –±–µ–π–¥–∂–∞
            document.addEventListener('DOMContentLoaded', function() {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ Bootstrap –∑–∞–≥—Ä—É–∂–µ–Ω
                console.log('üîç Bootstrap –¥–æ—Å—Ç—É–ø–µ–Ω:', typeof bootstrap !== 'undefined');
                console.log('üîç Bootstrap.Collapse –¥–æ—Å—Ç—É–ø–µ–Ω:', typeof bootstrap?.Collapse !== 'undefined');
                
                const clickableBadge = document.querySelector('.clickable-badge');
                console.log('üîç –ö–ª–∏–∫–∞–±–µ–ª—å–Ω—ã–π –±–µ–π–¥–∂ –Ω–∞–π–¥–µ–Ω:', !!clickableBadge);
                if (clickableBadge) {
                    // –î–æ–±–∞–≤–ª—è–µ–º hover —ç—Ñ—Ñ–µ–∫—Ç
                    clickableBadge.addEventListener('mouseenter', function() {
                        this.style.transform = 'scale(1.05)';
                        this.style.transition = 'transform 0.2s ease';
                    });
                    
                    clickableBadge.addEventListener('mouseleave', function() {
                        this.style.transform = 'scale(1)';
                    });
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç –ø—Ä–∏ –∫–ª–∏–∫–µ
                    clickableBadge.addEventListener('mousedown', function() {
                        this.style.transform = 'scale(0.95)';
                    });
                    
                    clickableBadge.addEventListener('mouseup', function() {
                        this.style.transform = 'scale(1.05)';
                    });
                }
            });
            </script>
            
            <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –º–µ—Ç–æ–∫ -->
            <script>
                // –ü–µ—Ä–µ–¥–∞–µ–º sessionId –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ —à–∞–±–ª–æ–Ω–∞ –≤ –≥–ª–æ–±–∞–ª—å–Ω—ã–π scope
                window.sessionId = {{ chat_session.id }};
            </script>
            <script src="{% static 'js/chat_actions.js' %}"></script>
            {% endblock %}