{% load static %}
{% load huntflow_filters %}
{% load sidebar_tags %}
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="csrf-token" content="{{ csrf_token }}">
    <title>{% block title %}HR Helper{% endblock %}</title>
    
    <!-- Bootstrap CSS -->
    <link href="{% static 'css/bootstrap.min.css' %}" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="{% static 'css/all.min.css' %}" rel="stylesheet">
    <!-- HR Helper Custom CSS -->
    <link href="{% static 'css/hrhelper.css' %}" rel="stylesheet">
    
    <!-- –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π favicon -->
    <link id="favicon" rel="icon" type="image/png" href="{% static 'img/logo-dark.png' %}">
    
    <!-- –°—Ç–∏–ª–∏ –¥–ª—è –º–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–æ–≥–æ —Å–∞–π–¥–±–∞—Ä–∞ —Ç–µ–ø–µ—Ä—å –≤–∫–ª—é—á–µ–Ω—ã –≤ hrhelper.css -->
    
        {% block extra_css %}{% endblock %}
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            {% if not request.resolver_match.url_name == 'account_login' and not request.resolver_match.url_name == 'signup' and not request.resolver_match.url_name == 'password_reset' %}
            <nav class="col-md-3 col-lg-2 d-md-block sidebar collapse">
                <div class="position-sticky pt-3">
                    <div class="text-center mb-4">
                        <h4 class="text-white">
                            <i class="fas fa-sync-alt me-2"></i>
                HR Helper
                        </h4>
                        <p class="text-white-50 small">–°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è HR</p>
                    </div>
                    
                    <!-- –î–∏–Ω–∞–º–∏—á–Ω–æ–µ –º–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–æ–µ –º–µ–Ω—é -->
                    {% render_sidebar_menu %}

                    <hr class="my-4" style="border-color: rgba(255,255,255,0.5); border-width: 1px;">
                    <ul class="nav flex-column mb-2">
                        <li class="nav-item">
                            <a class="nav-link{% if request.resolver_match.url_name == 'profile' %} active{% endif %}" href="{% url 'accounts:profile' %}">
                                <i class="fas fa-user me-2"></i>
                                –ü—Ä–æ—Ñ–∏–ª—å
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link{% if request.resolver_match.url_name == 'integrations' %} active{% endif %}" href="{% url 'accounts:integrations' %}">
                                <i class="fas fa-plug me-2"></i>
                                –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link{% if request.resolver_match.namespace == 'admin' %} active{% endif %}" href="{% url 'admin:index' %}">
                                <i class="fas fa-cog me-2"></i>
                                Admin-–ø–∞–Ω–µ–ª—å
                            </a>
                        </li>
                    </ul>
            </div>
            </nav>
            {% endif %}
            
            <!-- Main content -->
            <main class="{% if request.resolver_match.url_name == 'account_login' or request.resolver_match.url_name == 'signup' or request.resolver_match.url_name == 'password_reset' %}col-12{% else %}col-md-9 ms-sm-auto col-lg-10{% endif %} px-md-4 main-content">
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    {% if not request.resolver_match.url_name == 'account_login' and not request.resolver_match.url_name == 'signup' and not request.resolver_match.url_name == 'password_reset' %}
                    <h1 class="h2">
                        {% block page_title %}HR Helper{% endblock %}
                    </h1>
                    {% else %}
                    <div></div>
                    {% endif %}
                    <div class="btn-toolbar mb-2 mb-md-0">
                        <!-- –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Ç–µ–º—ã -->
                        <div class="btn-group me-3" role="group">
                            <button type="button" class="btn btn-outline-secondary theme-toggle" id="themeToggle" title="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É">
                                <i class="fas fa-sun" id="themeIcon"></i>
                </button>
            </div>
            
                    {% if user.is_authenticated %}
                            <div class="btn-group me-3" role="group">
                                <a href="{% url 'accounts:profile' %}" class="btn btn-outline-primary">
                                    <i class="fas fa-user me-1"></i>
                                    {{ user.email|default:user.username }}
                                </a>
                                <a href="{% url 'accounts:account_logout' %}" class="btn btn-outline-danger">
                                    <i class="fas fa-sign-out-alt me-1"></i>
                                    –í—ã—Ö–æ–¥
                                </a>
                            </div>
                    {% else %}
                            <a href="{% url 'accounts:account_login' %}" class="btn btn-primary me-3">
                                <i class="fas fa-sign-in-alt me-1"></i>
                                –í—Ö–æ–¥
                            </a>
                    {% endif %}
                        {% block page_actions %}{% endblock %}
            </div>
        </div>

                <!-- Messages -->
    {% if messages and not request.resolver_match.url_name == 'chat_workflow' and not request.resolver_match.url_name == 'chat_workflow_session' %}
        <div class="messages">
            {% for message in messages %}
            <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                {{ message }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
            {% endfor %}
    </div>
    {% endif %}

                <!-- Page content -->
        {% block content %}{% endblock %}
    </main>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="{% static 'js/bootstrap.bundle.min.js' %}"></script>
    <!-- jQuery -->
    <script src="{% static 'js/jquery-3.6.0.min.js' %}"></script>
    
    <!-- –û—Å–Ω–æ–≤–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã –¥–ª—è –≤—Å–µ—Ö —Å—Ç—Ä–∞–Ω–∏—Ü -->
    <script>
        // –û–±—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –≤—Å–µ—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
        function showLoading(element) {
            element.innerHTML = '<span class="loading-spinner"></span> –ó–∞–≥—Ä—É–∑–∫–∞...';
            element.disabled = true;
        }
        
        function hideLoading(element, originalText) {
            element.innerHTML = originalText;
            element.disabled = false;
        }
        
        function showAlert(message, type = 'info') {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type} alert-dismissible fade show`;
            alertDiv.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            
            const container = document.querySelector('.container-fluid');
            container.insertBefore(alertDiv, container.firstChild);
            
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∫—Ä—ã—Ç—å —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
            setTimeout(() => {
                alertDiv.remove();
            }, 5000);
        }
        
        // –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –º–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–æ–≥–æ —Å–∞–π–¥–±–∞—Ä–∞
        document.addEventListener('DOMContentLoaded', function() {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–∞—Ö–æ–¥–∏–º—Å—è –ª–∏ –º—ã –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ "–ì–ª–∞–≤–Ω–∞—è" (—á–∞—Ç-–ø–æ–º–æ—â–Ω–∏–∫)
            const isMainPage = window.location.pathname.includes('/google-oauth/chat/');
            
            // –°–Ω–∞—á–∞–ª–∞ —Å–≤–æ—Ä–∞—á–∏–≤–∞–µ–º –í–°–ï –º–µ–Ω—é
            const allCollapseElements = document.querySelectorAll('.sidebar .collapse');
            allCollapseElements.forEach(element => {
                element.classList.remove('show');
                const toggle = document.querySelector(`[data-bs-target="#${element.id}"]`);
                if (toggle) {
                    toggle.setAttribute('aria-expanded', 'false');
                }
            });
            
            // –ï—Å–ª–∏ –º—ã –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ (—á–∞—Ç-–ø–æ–º–æ—â–Ω–∏–∫), –Ω–µ —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ–º –Ω–∏–∫–∞–∫–∏—Ö –º–µ–Ω—é
            if (isMainPage) {
                // –£–±–∏—Ä–∞–µ–º –∫–ª–∞—Å—Å active —Å–æ –≤—Å–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ, –∫—Ä–æ–º–µ —Å–∞–º–æ–π –≥–ª–∞–≤–Ω–æ–π
                const allNavLinks = document.querySelectorAll('.sidebar .nav-link');
                allNavLinks.forEach(link => {
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —ç—Ç–æ —Å—Å—ã–ª–∫–æ–π –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
                    const href = link.getAttribute('href');
                    if (href && !href.includes('/google-oauth/chat/')) {
                        link.classList.remove('active');
                    }
                });
                console.log('üè† –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞: —É–±—Ä–∞–Ω –∫–ª–∞—Å—Å active —Å–æ –≤—Å–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤, –∫—Ä–æ–º–µ –≥–ª–∞–≤–Ω–æ–π');
                return; // –í—ã—Ö–æ–¥–∏–º –∏–∑ —Ñ—É–Ω–∫—Ü–∏–∏, –æ—Å—Ç–∞–≤–ª—è—è –≤—Å–µ –º–µ–Ω—é —Å–≤–µ—Ä–Ω—É—Ç—ã–º–∏
            }
            
            // –ù–∞—Ö–æ–¥–∏–º –≤—Å–µ –∞–∫—Ç–∏–≤–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –º–µ–Ω—é
            const activeMenuItems = document.querySelectorAll('.sidebar .nav-link.active');
            
            // –î–ª—è –∫–∞–∂–¥–æ–≥–æ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞, —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ–º —Ç–æ–ª—å–∫–æ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–µ –º–µ–Ω—é
            activeMenuItems.forEach(function(activeItem) {
                let currentItem = activeItem.closest('.nav-item');
                
                // –ü–æ–¥–Ω–∏–º–∞–µ–º—Å—è –ø–æ –∏–µ—Ä–∞—Ä—Ö–∏–∏ –∏ —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ–º —Ç–æ–ª—å–∫–æ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–µ –º–µ–Ω—é
                while (currentItem) {
                    const parentToggle = currentItem.querySelector('.sidebar-toggle');
                    if (parentToggle) {
                        const targetId = parentToggle.getAttribute('data-bs-target');
                        const targetElement = document.querySelector(targetId);
                        
                        if (targetElement) {
                            targetElement.classList.add('show');
                            parentToggle.setAttribute('aria-expanded', 'true');
                        }
                    }
                    
                    // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–º—É —ç–ª–µ–º–µ–Ω—Ç—É
                    currentItem = currentItem.parentElement.closest('.nav-item');
                }
            });
            
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–æ–≤ –ø–æ –º–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–æ–º—É –º–µ–Ω—é
            const sidebarToggles = document.querySelectorAll('.sidebar-toggle');
            
            sidebarToggles.forEach(toggle => {
                toggle.addEventListener('click', function(e) {
                    // –ï—Å–ª–∏ —ç—Ç–æ —Å—Å—ã–ª–∫–∞ —Å –ø–æ–¥–º–µ–Ω—é - –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç–∏—Ç—å –ø–µ—Ä–µ—Ö–æ–¥
                    if (this.dataset.bsToggle === 'collapse') {
                        e.preventDefault();
                        
                        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —É—Ä–æ–≤–µ–Ω—å —Ç–µ–∫—É—â–µ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞
                        const currentNavItem = this.closest('.nav-item');
                        const currentLevel = currentNavItem.classList.contains('ms-1') ? 1 : 
                                           currentNavItem.classList.contains('ms-2') ? 2 : 0;
                        
                        // –°–≤–æ—Ä–∞—á–∏–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –º–µ–Ω—é —Ç–æ–≥–æ –∂–µ —É—Ä–æ–≤–Ω—è
                        const allCollapses = document.querySelectorAll('.sidebar .collapse');
                        allCollapses.forEach(collapse => {
                            if (collapse.id !== this.dataset.bsTarget.replace('#', '')) {
                                const collapseToggle = document.querySelector(`[data-bs-target="#${collapse.id}"]`);
                                if (collapseToggle) {
                                    const collapseNavItem = collapseToggle.closest('.nav-item');
                                    const collapseLevel = collapseNavItem.classList.contains('ms-1') ? 1 : 
                                                        collapseNavItem.classList.contains('ms-2') ? 2 : 0;
                                    
                                    // –°–≤–æ—Ä–∞—á–∏–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —ç—Ç–æ —Ç–æ—Ç –∂–µ —É—Ä–æ–≤–µ–Ω—å
                                    if (collapseLevel === currentLevel) {
                                        collapse.classList.remove('show');
                                        collapseToggle.setAttribute('aria-expanded', 'false');
                                    }
                                }
                            }
                        });
                        
                        // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º —Ç–µ–∫—É—â–µ–µ –º–µ–Ω—é
                        const targetId = this.dataset.bsTarget.replace('#', '');
                        const targetElement = document.querySelector(this.dataset.bsTarget);
                        const isExpanded = this.getAttribute('aria-expanded') === 'true';
                        
                        if (isExpanded) {
                            // –°–≤–æ—Ä–∞—á–∏–≤–∞–µ–º
                            targetElement.classList.remove('show');
                            this.setAttribute('aria-expanded', 'false');
                        } else {
                            // –†–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ–º
                            targetElement.classList.add('show');
                            this.setAttribute('aria-expanded', 'true');
                        }
                    }
                });
            });
        });
        
        // –ü–ï–†–ï–ö–õ–Æ–ß–ê–¢–ï–õ–¨ –¢–ï–ú–´ - —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç –≤–µ–∑–¥–µ:
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è favicon –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–µ–º—ã
        function updateFavicon(theme) {
            const favicon = document.getElementById('favicon');
            if (favicon) {
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã –¥–ª—è –∫–∞–∂–¥–æ–π —Ç–µ–º—ã
                if (theme === 'dark') {
                    // –¢–µ–º–Ω–∞—è —Ç–µ–º–∞: –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å–≤–µ—Ç–ª—ã–π –ª–æ–≥–æ—Ç–∏–ø
                    favicon.href = '{% static "img/logo-light.png" %}';
                } else {
                    // –°–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞: –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–µ–º–Ω—ã–π –ª–æ–≥–æ—Ç–∏–ø
                    favicon.href = '{% static "img/logo-dark.png" %}';
                }
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ç–µ–º—ã
        function toggleTheme() {
            console.log('üé® –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç–µ–º—ã...');
            const html = document.documentElement;
            const currentTheme = html.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            
            console.log('üìä –¢–µ–∫—É—â–∞—è —Ç–µ–º–∞:', currentTheme);
            console.log('üéØ –ù–æ–≤–∞—è —Ç–µ–º–∞:', newTheme);
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–æ–≤—É—é —Ç–µ–º—É
            html.setAttribute('data-theme', newTheme);
            console.log('‚úÖ –ê—Ç—Ä–∏–±—É—Ç data-theme —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω:', html.getAttribute('data-theme'));
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∞—Ç—Ä–∏–±—É—Ç –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
            setTimeout(() => {
                console.log('üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è:', html.getAttribute('data-theme'));
            }, 100);
            
            // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ–º CSS –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
            const root = document.documentElement;
            if (newTheme === 'dark') {
                root.style.setProperty('--color-background', '#0d1117');
                root.style.setProperty('--color-surface', '#161b22');
                root.style.setProperty('--color-text', 'var(--color-luna-400)');
                root.style.setProperty('--color-primary', 'var(--color-pink-400)');
                console.log('üåô –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã —Ç–µ–º–Ω—ã–µ —Ü–≤–µ—Ç–∞');
            } else {
                root.style.setProperty('--color-background', '#ffffff');
                root.style.setProperty('--color-surface', '#ffffff');
                root.style.setProperty('--color-text', '#13343b');
                root.style.setProperty('--color-primary', 'var(--color-lime-500)'); // –¢–µ–ø–µ—Ä—å —Å–∏–Ω–∏–π
                console.log('‚òÄÔ∏è –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã —Å–≤–µ—Ç–ª—ã–µ —Ü–≤–µ—Ç–∞ (–ª–∞–π–º —Ç–µ–ø–µ—Ä—å —Å–∏–Ω–∏–π)');
            }
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage
            localStorage.setItem('theme', newTheme);
            console.log('üíæ –¢–µ–º–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –≤ localStorage:', localStorage.getItem('theme'));
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–∫–æ–Ω–∫—É
            updateThemeIcon(newTheme);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º favicon
            updateFavicon(newTheme);
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
            showThemeNotification(newTheme);
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–∫–æ–Ω–∫–∏ —Ç–µ–º—ã
        function updateThemeIcon(theme) {
            const themeIcon = document.getElementById('themeIcon');
            if (themeIcon) {
                if (theme === 'dark') {
                    themeIcon.className = 'fas fa-moon';
                } else {
                    themeIcon.className = 'fas fa-sun';
                }
                console.log('üé® –ò–∫–æ–Ω–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–ª—è —Ç–µ–º—ã:', theme);
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫–∞–∑–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Å–º–µ–Ω–µ —Ç–µ–º—ã
        function showThemeNotification(theme) {
            const themeName = theme === 'dark' ? '–¢—ë–º–Ω–∞—è' : '–°–≤–µ—Ç–ª–∞—è';
            
            // –°–æ–∑–¥–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
            const notification = document.createElement('div');
            notification.className = 'alert alert-info alert-dismissible fade show position-fixed toast-notification';
            notification.style.cssText = 'bottom: 20px; left: 20px; z-index: 9999; transition: all 0.3s ease;';
            
            notification.innerHTML = `
                <i class="fas fa-${theme === 'dark' ? 'moon' : 'sun'} me-2"></i>
                –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–æ –Ω–∞ ${themeName} —Ç–µ–º—É
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            
            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ –∑–∞–∫—Ä—ã—Ç–∏—è
            const closeButton = notification.querySelector('.btn-close');
            closeButton.addEventListener('click', function() {
                // –£–¥–∞–ª—è–µ–º —Ç–æ—Å—Ç
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                    
                    // –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º –ø–æ–∑–∏—Ü–∏–∏ –æ—Å—Ç–∞–≤—à–∏—Ö—Å—è —Ç–æ—Å—Ç–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏—Ö —Ä–µ–∞–ª—å–Ω–æ–π –≤—ã—Å–æ—Ç—ã
                    const remainingToasts = document.querySelectorAll('.toast-notification');
                    let currentBottom = 20;
                    remainingToasts.forEach((toast) => {
                        toast.style.bottom = `${currentBottom}px`;
                        const toastHeight = toast.offsetHeight;
                        const margin = 10; // –æ—Ç—Å—Ç—É–ø –º–µ–∂–¥—É —Ç–æ—Å—Ç–∞–º–∏
                        currentBottom += toastHeight + margin;
                    });
                }
            });
            
            // –ü–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç–æ—Å—Ç—ã
            const existingToasts = document.querySelectorAll('.toast-notification');
            
            // –î–æ–±–∞–≤–ª—è–µ–º –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å–Ω–∞—á–∞–ª–∞
            document.body.appendChild(notification);
            
            // –ü–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä—É–µ–º –Ω–æ–≤—ã–π —Ç–æ—Å—Ç –≤ —Å–∞–º–æ–º –Ω–∏–∑—É
            notification.style.bottom = '20px';
            
            // –ü–æ–¥–Ω–∏–º–∞–µ–º –≤—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç–æ—Å—Ç—ã –≤–≤–µ—Ä—Ö –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏—Ö —Ä–µ–∞–ª—å–Ω–æ–π –≤—ã—Å–æ—Ç—ã
            let currentBottom = 20;
            existingToasts.forEach((toast) => {
                const toastHeight = toast.offsetHeight;
                const margin = 10; // –æ—Ç—Å—Ç—É–ø –º–µ–∂–¥—É —Ç–æ—Å—Ç–∞–º–∏
                currentBottom += toastHeight + margin;
                toast.style.bottom = `${currentBottom}px`;
            });
            
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è–µ–º —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
            setTimeout(function() {
                if (notification.parentNode) {
                    // –£–¥–∞–ª—è–µ–º —Ç–æ—Å—Ç
                    notification.parentNode.removeChild(notification);
                    
                    // –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º –ø–æ–∑–∏—Ü–∏–∏ –æ—Å—Ç–∞–≤—à–∏—Ö—Å—è —Ç–æ—Å—Ç–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏—Ö —Ä–µ–∞–ª—å–Ω–æ–π –≤—ã—Å–æ—Ç—ã
                    const remainingToasts = document.querySelectorAll('.toast-notification');
                    let currentBottom = 20;
                    remainingToasts.forEach((toast) => {
                        toast.style.bottom = `${currentBottom}px`;
                        const toastHeight = toast.offsetHeight;
                        const margin = 10; // –æ—Ç—Å—Ç—É–ø –º–µ–∂–¥—É —Ç–æ—Å—Ç–∞–º–∏
                        currentBottom += toastHeight + margin;
                    });
                }
            }, 3000);
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ –≤—Å–µ—Ö —Ç–æ—Å—Ç–æ–≤
        function clearAllToasts() {
            const existingToasts = document.querySelectorAll('.toast-notification');
            existingToasts.forEach(toast => {
                if (toast.parentNode) {
                    toast.parentNode.removeChild(toast);
                }
            });
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ç–µ–º—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—è —Ç–µ–º—ã...');
            
            // –û—á–∏—â–∞–µ–º –≤—Å–µ —Å—Ç–∞—Ä—ã–µ —Ç–æ—Å—Ç—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            clearAllToasts();
            
            // –ü–æ–ª—É—á–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—É—é —Ç–µ–º—É –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å–∏—Å—Ç–µ–º–Ω—É—é
            const savedTheme = localStorage.getItem('theme');
            const systemTheme = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
            const theme = savedTheme || systemTheme;
            
            console.log('üíæ –°–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–∞—è —Ç–µ–º–∞:', savedTheme);
            console.log('üñ•Ô∏è –°–∏—Å—Ç–µ–º–Ω–∞—è —Ç–µ–º–∞:', systemTheme);
            console.log('üéØ –í—ã–±—Ä–∞–Ω–Ω–∞—è —Ç–µ–º–∞:', theme);
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ–º—É
            document.documentElement.setAttribute('data-theme', theme);
            console.log('‚úÖ –ê—Ç—Ä–∏–±—É—Ç data-theme —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ:', document.documentElement.getAttribute('data-theme'));
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∞—Ç—Ä–∏–±—É—Ç –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
            setTimeout(() => {
                console.log('üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ 100ms:', document.documentElement.getAttribute('data-theme'));
            }, 100);
            
            // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ–º CSS –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
            const root = document.documentElement;
            if (theme === 'dark') {
                root.style.setProperty('--color-background', '#0d1117');
                root.style.setProperty('--color-surface', '#161b22');
                root.style.setProperty('--color-text', 'var(--color-luna-400)');
                root.style.setProperty('--color-primary', 'var(--color-pink-400)');
                console.log('üåô –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã —Ç–µ–º–Ω—ã–µ —Ü–≤–µ—Ç–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ');
            } else {
                root.style.setProperty('--color-background', '#ffffff');
                root.style.setProperty('--color-surface', '#ffffff');
                root.style.setProperty('--color-text', '#13343b');
                root.style.setProperty('--color-primary', 'var(--color-lime-500)'); // –¢–µ–ø–µ—Ä—å —Å–∏–Ω–∏–π
                console.log('‚òÄÔ∏è –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã —Å–≤–µ—Ç–ª—ã–µ —Ü–≤–µ—Ç–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ (–ª–∞–π–º —Ç–µ–ø–µ—Ä—å —Å–∏–Ω–∏–π)');
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–∫–æ–Ω–∫—É
            updateThemeIcon(theme);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º favicon
            updateFavicon(theme);
            
            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –Ω–∞ –∫–Ω–æ–ø–∫—É –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ç–µ–º—ã
            const themeToggle = document.getElementById('themeToggle');
            console.log('üîò –ö–Ω–æ–ø–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ç–µ–º—ã –Ω–∞–π–¥–µ–Ω–∞:', themeToggle);
            if (themeToggle) {
                // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏, –µ—Å–ª–∏ –æ–Ω–∏ –µ—Å—Ç—å
                themeToggle.removeEventListener('click', toggleTheme);
                // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫
                themeToggle.addEventListener('click', toggleTheme);
                console.log('‚úÖ –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω');
                
                // –¢–µ—Å—Ç–∏—Ä—É–µ–º –∫–ª–∏–∫ –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ
                console.log('üß™ –¢–µ—Å—Ç–∏—Ä—É–µ–º –ø—Ä–æ–≥—Ä–∞–º–º–Ω—ã–π –∫–ª–∏–∫...');
                setTimeout(() => {
                    console.log('üéØ –ê—Ç—Ä–∏–±—É—Ç data-theme –ø–µ—Ä–µ–¥ —Ç–µ—Å—Ç–æ–º:', document.documentElement.getAttribute('data-theme'));
                }, 500);
            } else {
                console.error('‚ùå –ö–Ω–æ–ø–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ç–µ–º—ã –Ω–µ –Ω–∞–π–¥–µ–Ω–∞!');
            }
            
            // –°–ª—É—à–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–∏—Å—Ç–µ–º–Ω–æ–π —Ç–µ–º—ã
            window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', function(e) {
                if (!localStorage.getItem('theme')) {
                    const newTheme = e.matches ? 'dark' : 'light';
                    document.documentElement.setAttribute('data-theme', newTheme);
                    updateThemeIcon(newTheme);
                    updateFavicon(newTheme);
                }
            });
            
            console.log('‚úÖ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—è —Ç–µ–º—ã –∑–∞–≤–µ—Ä—à–µ–Ω–∞');
            
            // –ì–ª–æ–±–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
            window.testThemeToggle = function() {
                console.log('üß™ –¢–µ—Å—Ç–∏—Ä—É–µ–º –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç–µ–º—ã...');
                toggleTheme();
            };
        });
    </script>

    <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Å—Ç—Ä–∞–Ω–∏—Ü -->
    {% block extra_js %}
    {% endblock %}
</body>
</html>
