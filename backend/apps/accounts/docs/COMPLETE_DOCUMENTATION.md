# Accounts App - –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ
1. [–û–±–∑–æ—Ä](#–æ–±–∑–æ—Ä)
2. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)
3. [–ú–æ–¥–µ–ª–∏](#–º–æ–¥–µ–ª–∏)
4. [API –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è](#api-—Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è)
5. [–°–µ—Ä–≤–∏—Å–Ω—ã–π —Å–ª–æ–π](#—Å–µ—Ä–≤–∏—Å–Ω—ã–π-—Å–ª–æ–π)
6. [–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–æ–ª—è–º–∏](#—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ-—Ä–æ–ª—è–º–∏)
7. [OAuth –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è](#oauth-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è)
8. [CLI –∫–æ–º–∞–Ω–¥—ã](#cli-–∫–æ–º–∞–Ω–¥—ã)
9. [–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å](#–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å)
10. [–†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ](#—Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ)

---

## üéØ –û–±–∑–æ—Ä

**Accounts App** - —ç—Ç–æ —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏, —Ä–æ–ª—è–º–∏ –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è–º–∏ –≤ —Å–∏—Å—Ç–µ–º–µ HR Helper. –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é, –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π.

### –ö–ª—é—á–µ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:
- ‚úÖ **–†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –º–æ–¥–µ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è** —Å –ø–æ–ª—è–º–∏ –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π
- ‚úÖ **–°–∏—Å—Ç–µ–º–∞ —Ä–æ–ª–µ–π** (–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã, –†–µ–∫—Ä—É—Ç–µ—Ä—ã, –ò–Ω—Ç–µ—Ä–≤—å—é–µ—Ä—ã, –ù–∞–±–ª—é–¥–∞—Ç–µ–ª–∏)
- ‚úÖ **Google OAuth** –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- ‚úÖ **API –∫–ª—é—á–∏** –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ (Gemini, ClickUp, Huntflow, Notion)
- ‚úÖ **REST API** —Å –ø–æ–ª–Ω–æ–π CRUD —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å—é
- ‚úÖ **CLI –∫–æ–º–∞–Ω–¥—ã** –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
- ‚úÖ **–°–µ—Ä–≤–∏—Å–Ω—ã–π —Å–ª–æ–π** –¥–ª—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:
```
apps/accounts/
‚îú‚îÄ‚îÄ models.py              # –ú–æ–¥–µ–ª—å User (—Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è AbstractUser)
‚îú‚îÄ‚îÄ views.py               # –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å (HTML + JSON)
‚îú‚îÄ‚îÄ views_api.py           # REST API (DRF ViewSets)
‚îú‚îÄ‚îÄ forms.py               # Django —Ñ–æ—Ä–º—ã
‚îú‚îÄ‚îÄ admin.py               # –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
‚îú‚îÄ‚îÄ urls.py                # URL –º–∞—Ä—à—Ä—É—Ç—ã
‚îú‚îÄ‚îÄ apps.py                # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ logic/                 # –°–µ—Ä–≤–∏—Å–Ω—ã–π —Å–ª–æ–π
‚îÇ   ‚îú‚îÄ‚îÄ user_service.py    # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
‚îÇ   ‚îú‚îÄ‚îÄ role_service.py    # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–æ–ª—è–º–∏
‚îÇ   ‚îú‚îÄ‚îÄ oauth_service.py   # Google OAuth
‚îÇ   ‚îú‚îÄ‚îÄ auth_adapters.py   # –ê–¥–∞–ø—Ç–µ—Ä—ã –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ serializers.py     # API —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ç–æ—Ä—ã
‚îÇ   ‚îî‚îÄ‚îÄ signals.py         # Django —Å–∏–≥–Ω–∞–ª—ã
‚îú‚îÄ‚îÄ management/commands/   # CLI –∫–æ–º–∞–Ω–¥—ã
‚îÇ   ‚îú‚îÄ‚îÄ create_user.py     # –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
‚îÇ   ‚îú‚îÄ‚îÄ assign_role.py     # –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ —Ä–æ–ª–µ–π
‚îÇ   ‚îú‚îÄ‚îÄ user_stats.py      # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
‚îÇ   ‚îî‚îÄ‚îÄ seed_roles.py      # –°–æ–∑–¥–∞–Ω–∏–µ —Ä–æ–ª–µ–π
‚îî‚îÄ‚îÄ migrations/            # –ú–∏–≥—Ä–∞—Ü–∏–∏ –ë–î
```

### –ü—Ä–∏–Ω—Ü–∏–ø—ã –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã:
- **Single Responsibility** - –∫–∞–∂–¥—ã–π –º–æ–¥—É–ª—å –∏–º–µ–µ—Ç –æ–¥–Ω—É –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å
- **Separation of Concerns** - —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏ –∏ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–π
- **DRY** - —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–¥–∞
- **Service Layer** - —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
- **Dependency Injection** - —Å–ª–∞–±–∞—è —Å–≤—è–∑–∞–Ω–Ω–æ—Å—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

---

## üìä –ú–æ–¥–µ–ª–∏

### User (—Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è AbstractUser)

```python
class User(AbstractUser):
    # –û—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–ª—è
    full_name = models.CharField(max_length=255, blank=True)
    telegram_username = models.CharField(max_length=64, blank=True)
    
    # API –∫–ª—é—á–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π
    gemini_api_key = models.CharField(max_length=256, blank=True)
    clickup_api_key = models.CharField(max_length=256, blank=True)
    notion_integration_token = models.CharField(max_length=256, blank=True)
    
    # Huntflow –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
    huntflow_prod_url = models.URLField(blank=True)
    huntflow_prod_api_key = models.CharField(max_length=256, blank=True)
    huntflow_sandbox_url = models.URLField(blank=True)
    huntflow_sandbox_api_key = models.CharField(max_length=256, blank=True)
    active_system = models.CharField(choices=SystemChoice.choices, default=SystemChoice.SANDBOX)
    
    # –†–æ–ª–∏ –∏ –ø—Ä–∞–≤–∞
    interviewer_calendar_url = models.URLField(blank=True)
    is_observer_active = models.BooleanField(default=False)
```

### –°–≤–æ–π—Å—Ç–≤–∞ —Ä–æ–ª–µ–π:
```python
@property
def is_admin(self) -> bool:
    return self.is_superuser or self.groups.filter(name="–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã").exists()

@property
def is_recruiter(self) -> bool:
    return self.groups.filter(name="–†–µ–∫—Ä—É—Ç–µ—Ä—ã").exists()

@property
def is_interviewer(self) -> bool:
    return self.groups.filter(name="–ò–Ω—Ç–µ—Ä–≤—å—é–µ—Ä—ã").exists()

@property
def is_observer(self) -> bool:
    return self.groups.filter(name="–ù–∞–±–ª—é–¥–∞—Ç–µ–ª–∏").exists()
```

### SystemChoice:
```python
class SystemChoice(models.TextChoices):
    PROD = "prod", _("–ü—Ä–æ–¥")
    SANDBOX = "sandbox", _("–ü–µ—Å–æ—á–Ω–∏—Ü–∞")
```

---

## üîå API –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è

### REST API Endpoints

#### UserViewSet (`/api/users/`)

**–ë–∞–∑–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏:**
- `GET /api/users/` - —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- `POST /api/users/` - —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `GET /api/users/{id}/` - –ø–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `PUT /api/users/{id}/` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `DELETE /api/users/{id}/` - —É–¥–∞–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–ö–∞—Å—Ç–æ–º–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è:**
- `GET /api/users/profile/` - –ø—Ä–æ—Ñ–∏–ª—å —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `PUT /api/users/profile/` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è
- `POST /api/users/change-password/` - —Å–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è
- `GET /api/users/settings/` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `PUT /api/users/settings/` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫
- `POST /api/users/{id}/assign-groups/` - –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –≥—Ä—É–ø–ø
- `GET /api/users/stats/` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

#### GroupViewSet (`/api/groups/`)
- `GET /api/groups/` - —Å–ø–∏—Å–æ–∫ –≥—Ä—É–ø–ø
- `GET /api/groups/{id}/` - –ø–æ–ª—É—á–µ–Ω–∏–µ –≥—Ä—É–ø–ø—ã

### JSON API Endpoints

#### –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è:
```http
POST /accounts/api/login/
Content-Type: application/json

{
    "username": "user@example.com",
    "password": "password123"
}
```

#### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API –∫–ª—é—á–µ–π:
```http
POST /accounts/api/test-gemini/
Content-Type: application/json

{
    "api_key": "AIzaSy..."
}
```

```http
POST /accounts/api/test-huntflow/
Content-Type: application/json

{
    "api_key": "hf_...",
    "api_url": "https://api.huntflow.ru",
    "system": "prod"
}
```

### –°–µ—Ä–∏–∞–ª–∏–∑–∞—Ç–æ—Ä—ã

#### UserSerializer
```python
{
    "id": 1,
    "username": "user",
    "email": "user@example.com",
    "first_name": "–ò–≤–∞–Ω",
    "last_name": "–ò–≤–∞–Ω–æ–≤",
    "full_name": "–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω",
    "telegram_username": "@ivan_ivanov",
    "groups": [...],
    "groups_display": ["–†–µ–∫—Ä—É—Ç–µ—Ä—ã", "–ù–∞–±–ª—é–¥–∞—Ç–µ–ª–∏"],
    "is_admin": false,
    "is_recruiter": true,
    "is_interviewer": false,
    "is_observer": true,
    "active_system": "sandbox",
    "is_observer_active": true,
    "date_joined": "2024-01-15T10:30:00Z",
    "last_login": "2024-01-20T15:45:00Z"
}
```

#### UserCreateSerializer
```python
{
    "username": "new_user",
    "email": "new@example.com",
    "first_name": "–ù–æ–≤—ã–π",
    "last_name": "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å",
    "password": "secure_password",
    "password_confirm": "secure_password",
    "telegram_username": "@new_user"
}
```

---

## ‚öôÔ∏è –°–µ—Ä–≤–∏—Å–Ω—ã–π —Å–ª–æ–π

### UserService

#### –û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã:
```python
# –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ—Ñ–∏–ª—è
UserService.get_user_profile_data(user)

# –°—Ç–∞—Ç—É—Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π
UserService.get_integrations_status(user)

# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ API –∫–ª—é—á–µ–π
UserService.update_user_api_keys(user, data)

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
UserService.get_user_stats()

# –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å —Ä–æ–ª—å—é
UserService.create_user_with_observer_role(user_data)

# –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –≥—Ä—É–ø–ø
UserService.assign_groups_to_user(user, group_ids)

# –°–≤—è–∑—ã–≤–∞–Ω–∏–µ —Å–æ—Ü–∏–∞–ª—å–Ω—ã—Ö –∞–∫–∫–∞—É–Ω—Ç–æ–≤
UserService.link_social_account_to_existing_user(sociallogin, email)
```

### RoleService

#### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–æ–ª—è–º–∏:
```python
# –°–æ–∑–¥–∞–Ω–∏–µ —Ä–æ–ª–µ–π –∏ –ø—Ä–∞–≤
RoleService.create_roles_and_permissions()

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä–æ–ª–µ–π
RoleService.get_role_statistics()

# –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ —Ä–æ–ª–∏
RoleService.assign_role_to_user(user, role_name)

# –£–¥–∞–ª–µ–Ω–∏–µ —Ä–æ–ª–∏
RoleService.remove_role_from_user(user, role_name)

# –ü–æ–ª—É—á–µ–Ω–∏–µ —Ä–æ–ª–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
RoleService.get_user_roles(user)

# –í–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–∞–≤
RoleService.validate_role_permissions()
```

### GoogleOAuthService

#### OAuth –æ–ø–µ—Ä–∞—Ü–∏–∏:
```python
# –ü–æ–ª—É—á–µ–Ω–∏–µ URL –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
GoogleOAuthService.get_authorization_url(request)

# –û–±—Ä–∞–±–æ—Ç–∫–∞ callback
GoogleOAuthService.handle_oauth_callback(request)
```

---

## üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–æ–ª—è–º–∏

### –°–∏—Å—Ç–µ–º–∞ —Ä–æ–ª–µ–π:

#### 1. –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã
- **–ü—Ä–∞–≤–∞:** –í—Å–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ (300 –ø—Ä–∞–≤)
- **–î–æ—Å—Ç—É–ø:** –ü–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º —Ñ—É–Ω–∫—Ü–∏—è–º
- **–°–æ–∑–¥–∞–Ω–∏–µ:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ `is_superuser=True`

#### 2. –†–µ–∫—Ä—É—Ç–µ—Ä—ã
- **–ü—Ä–∞–≤–∞:** –í—Å–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ (300 –ø—Ä–∞–≤)
- **–î–æ—Å—Ç—É–ø:** –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–∞–∫–∞–Ω—Å–∏—è–º–∏, –∫–∞–Ω–¥–∏–¥–∞—Ç–∞–º–∏, –∏–Ω—Ç–µ—Ä–≤—å—é
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ß–µ—Ä–µ–∑ –≥—Ä—É–ø–ø—ã –∏–ª–∏ CLI –∫–æ–º–∞–Ω–¥—ã

#### 3. –ò–Ω—Ç–µ—Ä–≤—å—é–µ—Ä—ã
- **–ü—Ä–∞–≤–∞:** –¢–æ–ª—å–∫–æ –ø—Ä–æ—Å–º–æ—Ç—Ä (75 –ø—Ä–∞–≤)
- **–î–æ—Å—Ç—É–ø:** –ü—Ä–æ—Å–º–æ—Ç—Ä –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã—Ö –∏–Ω—Ç–µ—Ä–≤—å—é, –∫–∞–ª–µ–Ω–¥–∞—Ä—å
- **–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:** –ú–æ–≥—É—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ

#### 4. –ù–∞–±–ª—é–¥–∞—Ç–µ–ª–∏
- **–ü—Ä–∞–≤–∞:** –¢–æ–ª—å–∫–æ –ø—Ä–æ—Å–º–æ—Ç—Ä (75 –ø—Ä–∞–≤)
- **–î–æ—Å—Ç—É–ø:** –ü—Ä–æ—Å–º–æ—Ç—Ä –¥–∞–Ω–Ω—ã—Ö –±–µ–∑ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–æ–≤—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º

### –°–æ–∑–¥–∞–Ω–∏–µ —Ä–æ–ª–µ–π:
```bash
python manage.py seed_roles
```

### –í–∞–ª–∏–¥–∞—Ü–∏—è —Ä–æ–ª–µ–π:
```bash
python manage.py seed_roles --validate
```

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä–æ–ª–µ–π:
```bash
python manage.py seed_roles --stats
```

---

## üîê OAuth –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

### Google OAuth 2.0

#### –ù–∞—Å—Ç—Ä–æ–π–∫–∞:
```python
# settings.py
SOCIALACCOUNT_PROVIDERS = {
    'google': {
        'SCOPE': ['profile', 'email'],
        'AUTH_PARAMS': {'access_type': 'online'}
    }
}

ACCOUNT_ADAPTER = 'apps.accounts.logic.auth_adapters.CustomAccountAdapter'
SOCIALACCOUNT_ADAPTER = 'apps.accounts.logic.auth_adapters.CustomSocialAccountAdapter'
```

#### Endpoints:
- `GET /accounts/google-oauth/` - –∏–Ω–∏—Ü–∏–∞—Ü–∏—è OAuth
- `GET /accounts/google-oauth-callback/` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ callback
- `GET /accounts/google-oauth-demo/` - –¥–µ–º–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞
- `GET /accounts/oauth-debug/` - –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

#### –ü—Ä–æ—Ü–µ—Å—Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –Ω–∞ `/accounts/google-oauth/`
2. –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ Google OAuth
3. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑—É–µ—Ç—Å—è –≤ Google
4. Google –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–∞ callback
5. –°–æ–∑–¥–∞–Ω–∏–µ/–ø–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ —Å–∏—Å—Ç–µ–º–µ
6. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ —Ä–æ–ª–∏ "–ù–∞–±–ª—é–¥–∞—Ç–µ–ª–∏"
7. –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –≤ —Å–∏—Å—Ç–µ–º–µ

#### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:
- ‚úÖ **State parameter** –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç CSRF
- ‚úÖ **–í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–æ–≤** —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π —Å—Ä–æ–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è
- ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ** —Ç–æ–∫–µ–Ω–æ–≤
- ‚úÖ **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

---

## üñ•Ô∏è CLI –∫–æ–º–∞–Ω–¥—ã

### –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:
```bash
python manage.py create_user username email --role "–†–µ–∫—Ä—É—Ç–µ—Ä—ã"
python manage.py create_user john john@example.com --password "secure123" --role "–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã"
```

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–æ–ª—è–º–∏:
```bash
# –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ —Ä–æ–ª–∏
python manage.py assign_role username "–ò–Ω—Ç–µ—Ä–≤—å—é–µ—Ä—ã"

# –£–¥–∞–ª–µ–Ω–∏–µ —Ä–æ–ª–∏ (—á–µ—Ä–µ–∑ API)
python manage.py remove_role username "–ù–∞–±–ª—é–¥–∞—Ç–µ–ª–∏"
```

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:
```bash
# –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
python manage.py user_stats

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä–æ–ª–µ–π
python manage.py seed_roles --stats

# –í–∞–ª–∏–¥–∞—Ü–∏—è —Ä–æ–ª–µ–π
python manage.py seed_roles --validate
```

### –°–æ–∑–¥–∞–Ω–∏–µ —Ä–æ–ª–µ–π:
```bash
# –°–æ–∑–¥–∞–Ω–∏–µ –≤—Å–µ—Ö —Ä–æ–ª–µ–π
python manage.py seed_roles

# –° –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π
python manage.py seed_roles && python manage.py seed_roles --validate
```

---

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è:
- ‚úÖ **Django —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è** –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- ‚úÖ **Google OAuth 2.0** –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- ‚úÖ **JWT —Ç–æ–∫–µ–Ω—ã** (—á–µ—Ä–µ–∑ DRF)
- ‚úÖ **CSRF –∑–∞—â–∏—Ç–∞** –¥–ª—è –≤—Å–µ—Ö —Ñ–æ—Ä–º

### –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è:
- ‚úÖ **–°–∏—Å—Ç–µ–º–∞ —Ä–æ–ª–µ–π** –Ω–∞ –æ—Å–Ω–æ–≤–µ –≥—Ä—É–ø–ø Django
- ‚úÖ **–ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞** –Ω–∞ —É—Ä–æ–≤–Ω–µ –º–æ–¥–µ–ª–µ–π
- ‚úÖ **API permissions** —á–µ—Ä–µ–∑ DRF
- ‚úÖ **–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å** —Å –∫–∞—Å—Ç–æ–º–Ω—ã–º–∏ –ø—Ä–∞–≤–∞–º–∏

### –ó–∞—â–∏—Ç–∞ –¥–∞–Ω–Ω—ã—Ö:
- ‚úÖ **API –∫–ª—é—á–∏** –≤ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–º –≤–∏–¥–µ
- ‚úÖ **–ü–∞—Ä–æ–ª–∏** —Å —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º Django
- ‚úÖ **–í–∞–ª–∏–¥–∞—Ü–∏—è** –≤—Å–µ—Ö –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** –æ–ø–µ—Ä–∞—Ü–∏–π

### OAuth –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:
- ‚úÖ **State parameter** –¥–ª—è CSRF –∑–∞—â–∏—Ç—ã
- ‚úÖ **–í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–æ–≤** —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π —Å—Ä–æ–∫–∞
- ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ** —Ç–æ–∫–µ–Ω–æ–≤
- ‚úÖ **–ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ** credentials

---

## üöÄ –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:
```python
# requirements.txt
Django>=5.2.6
django-allauth>=0.57.0
djangorestframework>=3.14.0
requests>=2.31.0
pytz>=2025.2
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞:
```python
# settings.py
INSTALLED_APPS = [
    'apps.accounts',
    'allauth',
    'allauth.account',
    'allauth.socialaccount',
    'allauth.socialaccount.providers.google',
    'rest_framework',
]

AUTH_USER_MODEL = 'accounts.User'

# Google OAuth
SOCIALACCOUNT_PROVIDERS = {
    'google': {
        'SCOPE': ['profile', 'email'],
        'AUTH_PARAMS': {'access_type': 'online'}
    }
}

# DRF –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
REST_FRAMEWORK = {
    'DEFAULT_AUTHENTICATION_CLASSES': [
        'rest_framework.authentication.SessionAuthentication',
    ],
    'DEFAULT_PERMISSION_CLASSES': [
        'rest_framework.permissions.IsAuthenticated',
    ],
}
```

### –ú–∏–≥—Ä–∞—Ü–∏–∏:
```bash
python manage.py makemigrations accounts
python manage.py migrate
```

### –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è:
```bash
# –°–æ–∑–¥–∞–Ω–∏–µ —Ä–æ–ª–µ–π
python manage.py seed_roles

# –°–æ–∑–¥–∞–Ω–∏–µ —Å—É–ø–µ—Ä–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
python manage.py createsuperuser

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏—Å—Ç–µ–º—ã
python manage.py check
python manage.py seed_roles --validate
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:
```bash
# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
python manage.py user_stats

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–æ–ª–µ–π
python manage.py seed_roles --validate

# –õ–æ–≥–∏ —Å–∏—Å—Ç–µ–º—ã
tail -f logs/django.log
```

---

## üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

### –¢–µ–∫—É—â–∏–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏:
- **–û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞:** 2,128
- **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ñ–∞–π–ª–æ–≤:** 25
- **–ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏:** –ü–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è
- **–°–ª–æ–∂–Ω–æ—Å—Ç—å:** –°—Ä–µ–¥–Ω—è—è
- **–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –¥–æ–ª–≥:** –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:
- **–í—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:** < 100ms
- **–í—Ä–µ–º—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:** < 200ms
- **–í—Ä–µ–º—è OAuth callback:** < 500ms
- **API response time:** < 50ms

### –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å:
- **–ü–æ–¥–¥–µ—Ä–∂–∫–∞:** –î–æ 10,000 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- **API requests:** –î–æ 1,000 RPS
- **OAuth requests:** –î–æ 100 RPS
- **Database queries:** –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã

---

## üîß Troubleshooting

### –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:

#### 1. –û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ Google:
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ OAuth
python manage.py shell
>>> from django.conf import settings
>>> print(settings.SOCIALACCOUNT_PROVIDERS)
```

#### 2. API –∫–ª—é—á–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç:
```bash
# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API –∫–ª—é—á–µ–π
python manage.py shell
>>> from apps.accounts.models import User
>>> user = User.objects.get(username='testuser')
>>> # –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ views
```

#### 3. –†–æ–ª–∏ –Ω–µ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è:
```bash
# –ü–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏–µ —Ä–æ–ª–µ–π
python manage.py seed_roles
python manage.py seed_roles --validate
```

#### 4. OAuth —Ç–æ–∫–µ–Ω—ã –∏—Å—Ç–µ–∫–ª–∏:
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–æ–≤
python manage.py shell
>>> from apps.google_oauth.models import GoogleOAuthAccount
>>> for account in GoogleOAuthAccount.objects.all():
...     print(f"{account.user.username}: {account.is_token_valid()}")
```

### –õ–æ–≥–∏ –∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:
```bash
# Django –ª–æ–≥–∏
tail -f logs/django.log

# OAuth –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
curl http://localhost:8000/accounts/oauth-debug/

# API —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
curl -X POST http://localhost:8000/accounts/api/test-gemini/ \
  -H "Content-Type: application/json" \
  -d '{"api_key": "test_key"}'
```

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:
- [Django User Model](https://docs.djangoproject.com/en/stable/topics/auth/customizing/)
- [Django REST Framework](https://www.django-rest-framework.org/)
- [django-allauth](https://django-allauth.readthedocs.io/)
- [Google OAuth 2.0](https://developers.google.com/identity/protocols/oauth2)

### –°–≤—è–∑–∞–Ω–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:
- `apps.google_oauth` - Google —Å–µ—Ä–≤–∏—Å—ã
- `apps.huntflow` - Huntflow API
- `apps.gemini` - Gemini AI
- `apps.telegram` - Telegram –±–æ—Ç
- `apps.notion_int` - Notion –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

### –ö–æ–Ω—Ç–∞–∫—Ç—ã:
- **–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫:** AI Assistant
- **–í–µ—Ä—Å–∏—è:** 1.0.0
- **–î–∞—Ç–∞:** 2024-01-20
- **–°—Ç–∞—Ç—É—Å:** Production Ready ‚úÖ

---

## üéâ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ **Accounts** –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π –ø–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—É—é —Å–∏—Å—Ç–µ–º—É —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ —Å —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π, –≤–∫–ª—é—á–∞—é—â–µ–π:

- ‚úÖ **–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É** —Å —Å–µ—Ä–≤–∏—Å–Ω—ã–º —Å–ª–æ–µ–º
- ‚úÖ **–ü–æ–ª–Ω—É—é API —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—é** —Å REST endpoints
- ‚úÖ **–°–∏—Å—Ç–µ–º—É —Ä–æ–ª–µ–π** —Å –≥–∏–±–∫–∏–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º –ø—Ä–∞–≤–∞–º–∏
- ‚úÖ **OAuth –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é** —Å Google
- ‚úÖ **CLI –∫–æ–º–∞–Ω–¥—ã** –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è
- ‚úÖ **–í—ã—Å–æ–∫–∏–π —É—Ä–æ–≤–µ–Ω—å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏**
- ‚úÖ **–û—Ç–ª–∏—á–Ω—É—é –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é**

–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ production –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –∏ –ª–µ–≥–∫–æ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç—Å—è –¥–ª—è –±–æ–ª—å—à–∏—Ö –Ω–∞–≥—Ä—É–∑–æ–∫.
