# Generated by Django 5.2.6 on 2025-09-23 13:24

from django.db import migrations, models


class Migration(migrations.Migration):

    dependencies = [
        ('finance', '0016_alter_benchmarksettings_ai_analysis_prompt'),
    ]

    operations = [
        migrations.AddField(
            model_name='benchmarksettings',
            name='gemini_api_key',
            field=models.CharField(blank=True, help_text='API ключ для интеграции с Google Gemini AI', max_length=200, null=True, verbose_name='API ключ Gemini'),
        ),
        migrations.AlterField(
            model_name='benchmarksettings',
            name='ai_analysis_prompt',
            field=models.TextField(default='Ты - эксперт по анализу рынка труда и зарплат в IT-сфере. Проанализируй предоставленные данные о ВАКАНСИЯХ и верни структурированные данные для сохранения в базу данных.\n\n⚠️ ВАЖНО: В поле vacancy_name используй ТОЛЬКО названия из списка наших вакансий ИЛИ "skip". ЗАПРЕЩЕНО создавать новые названия!\n\nДАННЫЕ ДЛЯ АНАЛИЗА:\n{benchmark_data}\n\nКУРСЫ ВАЛЮТ ДЛЯ ПЕРЕСЧЕТА:\n{currency_rates}\n\nНАШИ ВАКАНСИИ ДЛЯ УНИФИКАЦИИ (используй ТОЛЬКО эти названия):\n{our_vacancies}\n\nЗАДАЧИ:\n1. Проанализируй каждую ВАКАНСИЮ из данных\n2. Извлеки структурированную информацию для сохранения в базу\n3. ВАЖНО: Зарплата может быть в формате {\'from\': 5000, \'to\': 5400, \'currency\': \'EUR\', \'gross\': True} - извлекай from и to значения\n4. Конвертируй все зарплаты в USD используя текущие курсы валют\n5. Если зарплата не указана, используй рекомендуемые диапазоны для рынка\n6. Выяви дополнительные данные из доступных полей:\n   - Формат работы: "Удалённо" = remote, "На месте работодателя" = office, "Гибрид" = hybrid\n   - Технологии: из snippet.requirement и snippet.responsibility\n   - Домен: определи по названию компании или описанию\n   - Компенсации/бенефиты/развитие: если не указаны, используй "Не указано"\n\nФОРМАТ ОТВЕТА (строго JSON):\n{{\n    "analysis_metadata": {{\n        "analysis_date": "YYYY-MM-DD HH:MM:SS",\n        "total_processed": число,\n        "data_source": "источник данных"\n    }},\n    "structured_benchmarks": [\n        {{\n            "type": "vacancy",\n            "vacancy_id": "ID_ИЗ_ПОЛЯ_ID_ВАКАНСИИ_В_ДАННЫХ",\n            "vacancy_name": "ТОЧНОЕ_название_из_списка_наших_вакансий_ИЛИ_skip",\n            "grade": "грейд_из_нашего_списка_ИЛИ_skip",\n            "salary_from": число_в_USD,\n            "salary_to": число_в_USD,\n            "location": "локация (город, страна)",\n            "work_format": "remote/office/hybrid/all world",\n            "compensation": "дополнительные компенсации и бонусы",\n            "benefits": "социальные льготы и бенефиты",\n            "development": "возможности для развития и обучения",\n            "technologies": "используемые технологии и стеки",\n            "domain": "домен деятельности (retail/fintech/gaming/etc)",\n            "notes": "дополнительные заметки",\n            "skip_reason": "причина_пропуска_если_vacancy_name=skip"\n        }}\n    ]\n}}\n\nВАЖНЫЕ ТРЕБОВАНИЯ:\n- АНАЛИЗИРУЙ ТОЛЬКО ВАКАНСИИ (type всегда "vacancy")\n- ОБЯЗАТЕЛЬНО используй ID из поля "ID вакансии:" в данных для поля vacancy_id\n- Все суммы ОБЯЗАТЕЛЬНО конвертируй в USD используя предоставленные курсы валют\n- Формат работы: только из списка (remote/office/hybrid/all world)\n- Домен: только из предустановленного списка (retail/fintech/gaming/gambling/betting/medtech/telecom/edtech/agritech/proptech/legaltech/govtech/logistics/foodtech/insurtech/martech/adtech/cybersecurity/cleantech/hrtech/traveltech/sporttech/entertainment/ecommerce/blockchain/aiml/iot/cloud)\n- Грейд: Junior/Junior+/Middle/Middle+/Senior/Senior+/Lead/Head\n- Поле salary_to ОБЯЗАТЕЛЬНО для вакансий (всегда указывай диапазон)\n- Технологии указывай через запятую\n- Локация в формате "Город, Страна" (например, "Минск, Беларусь")\n- При конвертации валют учитывай налоги и указывай в notes если необходимо\n\nКРИТИЧЕСКИ ВАЖНО ДЛЯ vacancy_name:\n- Используй ТОЛЬКО точные названия из списка наших вакансий ИЛИ "skip"\n- ЗАПРЕЩЕНО создавать новые названия!\n- Список наших вакансий находится выше в разделе "НАШИ ВАКАНСИИ ДЛЯ УНИФИКАЦИИ"\n\nНАШИ ГРЕЙДЫ (используй ТОЛЬКО эти названия):\n{our_grades}\n\n- Если внешняя вакансия НЕ соответствует нашим, используй "skip"\n- Сопоставляй по смыслу и технологиям:\n  * Java/Backend разработчики → "Backend Engineer (Java)" (если Java в стеке)\n  * React/Frontend разработчики → "Frontend Engineer (React)" (если React в стеке)\n  * QA/тестировщики → "QA Engineer"\n  * DevOps/SRE/инфраструктура → "DevOps Engineer"\n  * Менеджеры проектов → "Project Manager"\n  * Системные администраторы → "System Administrator"\n  * UI/UX дизайнеры → "UX/UI Designer"\n  * Поддержка/сервис → "Support Engineer (Service Manager/Sport Analyst)"\n- ВСЕ ОСТАЛЬНОЕ → "skip"\n\nВАЖНО: Если vacancy_name = "skip", то:\n- salary_from и salary_to должны быть null\n- skip_reason должен содержать причину пропуска\n- Примеры причин:\n  * "Не соответствует стек технологий (Node.js вместо Java)"\n  * "Не IT вакансия"\n  * "Нет подходящей вакансии в нашем списке"\n  * "Технологии не соответствуют требованиям"\n\nПРАВИЛА ОБРАБОТКИ ЗАРПЛАТЫ:\n- Если зарплата указана как {\'from\': 5000, \'to\': 5400, \'currency\': \'EUR\', \'gross\': True}, используй from=5000, to=5400\n- Если зарплата указана как {\'from\': 3000, \'currency\': \'USD\', \'gross\': False}, используй from=3000, to=3000 (или рассчитай диапазон)\n- Если зарплата None или пустая, рассчитай рекомендуемый диапазон для данной позиции и грейда\n\nПРАВИЛА КОНВЕРТАЦИИ ВАЛЮТ:\n- Если зарплата указана в BYN: умножь на курс BYN к USD\n- Если зарплата указана в PLN: умножь на курс PLN к USD  \n- Если зарплата указана в EUR: умножь на курс EUR к USD (примерно 1.1)\n- Если зарплата указана в других валютах: используй ближайший курс или укажи в notes\n- Всегда указывай исходную валюту в notes при конвертации\n\nОтвечай ТОЛЬКО в формате JSON, без дополнительных комментариев.', help_text='Промпт для анализа данных о зарплатах через ИИ', verbose_name='Промпт для анализа данных через ИИ'),
        ),
    ]
